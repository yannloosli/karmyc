# React Integration with Zustand

This document explains how Karmyc Core integrates with React using Zustand for state management.

## Accessing State and Actions

Components access Zustand stores directly using the hooks generated by each store (e.g., `useAreaStore`).

```typescript
import React from 'react';
import { useAreaStore } from '@gamesberry/karmyc-core/stores/areaStore';

function MyComponent({ areaId }: { areaId: string }) {
  // Select specific state parts from useAreaStore
  const area = useAreaStore((state) => state.areas[areaId]);
  const isActive = useAreaStore((state) => state.activeAreaId === areaId);

  // Select actions from useAreaStore
  const updateArea = useAreaStore((state) => state.updateArea);
  const setActiveArea = useAreaStore((state) => state.setActiveArea);

  const handleUpdate = () => {
    const updatedData = { id: areaId, state: { /* new state */ } };
    updateArea(updatedData);
  };

  const handleActivate = () => {
    setActiveArea(areaId);
  };

  if (!area) {
    return <div>Loading area...</div>;
  }

  return (
    <div
      onClick={handleActivate}
      style={{ border: isActive ? '2px solid blue' : '1px solid grey' }}
    >
      <h3>{area.type} (ID: {areaId})</h3>
      {/* Render area content based on area.state */}
      <button onClick={handleUpdate}>Update Area</button>
    </div>
  );
}
```

**Key Points:**

- **Direct Hook Usage:** Import and use the specific store hook needed (e.g., `useAreaStore`).
- **Selectors:** Use selector functions (`(state) => state.part`) to extract only the required state slices. Zustand automatically optimizes re-renders based on changes to the selected state.
  - For objects returned by selectors, consider using `shallow` from `zustand/shallow` as the equality function to prevent unnecessary re-renders if the object reference changes but its contents haven't relevantly.
- **Actions:** Actions are just functions returned by the store hook. Call them directly.
- **No Provider:** Zustand does not require a `<Provider>` component wrapping the application.

Refer to the [Zustand Store Architecture](./../architecture/store.md) document for a list of available stores and their details.

## Error Handling (`ErrorHandler`)

The `ErrorHandler` utility helps manage and report errors occurring within the Karmyc system. It allows centralizing error logic.

```typescript
import { ErrorHandler } from '@gamesberry/karmyc-core';

const myErrorHandler = new ErrorHandler({
  onError: (error, context) => {
    console.error('Karmyc Error:', error, 'Context:', context);
    // Send to logging service, etc.
  }
});

// Potentially pass it during initialization or make it accessible globally
```

The core principles of the `ErrorHandler` remain the same, but its integration is handled within the application logic. Errors generated during Zustand store actions or component lifecycle methods should be caught and reported to the `ErrorHandler` if necessary.
