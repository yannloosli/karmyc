"use strict";var e=require("react/jsx-runtime"),t=require("react"),r=require("@szhsin/react-menu");const a=e=>{let t;const r=new Set,a=(e,a)=>{const n="function"==typeof e?e(t):e;if(!Object.is(n,t)){const e=t;t=(null!=a?a:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach((r=>r(t,e)))}},n=()=>t,o={setState:a,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},s=t=e(a,n,o);return o};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,s={exports:{}},i={},c={exports:{}},l={};var d,u,p,f={};
/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function h(){return u||(u=1,"production"===process.env.NODE_ENV?c.exports=function(){if(o)return l;o=1;var e=t,r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=e.useState,n=e.useEffect,s=e.useLayoutEffect,i=e.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!r(e,a)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=a({inst:{value:r,getSnapshot:t}}),l=o[0].inst,d=o[1];return s((function(){l.value=r,l.getSnapshot=t,c(l)&&d({inst:l})}),[e,r,t]),n((function(){return c(l)&&d({inst:l}),e((function(){c(l)&&d({inst:l})}))}),[e]),i(r),r};return l.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:d,l}():c.exports=(d||(d=1,"production"!==process.env.NODE_ENV&&function(){function e(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=t,a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=r.useState,o=r.useEffect,s=r.useLayoutEffect,i=r.useDebugValue,c=!1,l=!1,d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(t,d){c||void 0===r.startTransition||(c=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var u=d();if(!l){var p=d();a(u,p)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),l=!0)}var f=(p=n({inst:{value:u,getSnapshot:d}}))[0].inst,h=p[1];return s((function(){f.value=u,f.getSnapshot=d,e(f)&&h({inst:f})}),[t,u,d]),o((function(){return e(f)&&h({inst:f}),t((function(){e(f)&&h({inst:f})}))}),[t]),i(u),u};f.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:d,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),f)),c.exports}
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y,g={};
/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"===process.env.NODE_ENV?s.exports=function(){if(p)return i;p=1;var e=t,r=h(),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=r.useSyncExternalStore,o=e.useRef,s=e.useEffect,c=e.useMemo,l=e.useDebugValue;return i.useSyncExternalStoreWithSelector=function(e,t,r,i,d){var u=o(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=c((function(){function e(e){if(!s){if(s=!0,n=e,e=i(e),void 0!==d&&p.hasValue){var t=p.value;if(d(t,e))return o=t}return o=e}if(t=o,a(n,e))return t;var r=i(e);return void 0!==d&&d(t,r)?(n=e,t):(n=e,o=r)}var n,o,s=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,r,i,d]);var f=n(e,u[0],u[1]);return s((function(){p.hasValue=!0,p.value=f}),[f]),l(f),f},i}():s.exports=(y||(y=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=t,r=h(),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=r.useSyncExternalStore,o=e.useRef,s=e.useEffect,i=e.useMemo,c=e.useDebugValue;g.useSyncExternalStoreWithSelector=function(e,t,r,l,d){var u=o(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=i((function(){function e(e){if(!s){if(s=!0,n=e,e=l(e),void 0!==d&&p.hasValue){var t=p.value;if(d(t,e))return o=t}return o=e}if(t=o,a(n,e))return t;var r=l(e);return void 0!==d&&d(t,r)?(n=e,t):(n=e,o=r)}var n,o,s=!1,i=void 0===r?null:r;return[function(){return e(t())},null===i?void 0:function(){return e(i())}]}),[t,r,l,d]);var f=n(e,u[0],u[1]);return s((function(){p.hasValue=!0,p.value=f}),[f]),c(f),f},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),g);var m=n(s.exports);const{useDebugValue:v}=t,{useSyncExternalStoreWithSelector:w}=m;let S=!1;const b=e=>e;const I=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?a(e):a)(e):e,r=(e,r)=>function(e,t=b,r){r&&!S&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),S=!0);const a=w(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return v(a),a}(t,e,r);return Object.assign(r,t),r},x=e=>e?I(e):I;var A=Symbol.for("immer-nothing"),_=Symbol.for("immer-draftable"),E=Symbol.for("immer-state"),k="production"!==process.env.NODE_ENV?[function(e){return`The plugin for '${e}' has not been loaded into Immer. To enable the plugin, import and call \`enable${e}()\` when initializing your application.`},function(e){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${e}'`},"This object has been frozen and should not be mutated",function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(e){return`'current' expects a draft, got: ${e}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(e){return`'original' expects a draft, got: ${e}`}]:[];function O(e,...t){if("production"!==process.env.NODE_ENV){const r=k[e],a="function"==typeof r?r.apply(null,t):r;throw new Error(`[Immer] ${a}`)}throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var z=Object.getPrototypeOf;function j(e){return!!e&&!!e[E]}function D(e){return!!e&&(C(e)||Array.isArray(e)||!!e[_]||!!e.constructor?.[_]||$(e)||P(e))}var M=Object.prototype.constructor.toString();function C(e){if(!e||"object"!=typeof e)return!1;const t=z(e);if(null===t)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===M}function T(e,t){0===R(e)?Reflect.ownKeys(e).forEach((r=>{t(r,e[r],e)})):e.forEach(((r,a)=>t(a,r,e)))}function R(e){const t=e[E];return t?t.type_:Array.isArray(e)?1:$(e)?2:P(e)?3:0}function L(e,t){return 2===R(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function N(e,t,r){const a=R(e);2===a?e.set(t,r):3===a?e.add(r):e[t]=r}function $(e){return e instanceof Map}function P(e){return e instanceof Set}function F(e){return e.copy_||e.base_}function V(e,t){if($(e))return new Map(e);if(P(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=C(e);if(!0===t||"class_only"===t&&!r){const t=Object.getOwnPropertyDescriptors(e);delete t[E];let r=Reflect.ownKeys(t);for(let a=0;a<r.length;a++){const n=r[a],o=t[n];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[n]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[n]})}return Object.create(z(e),t)}{const t=z(e);if(null!==t&&r)return{...e};const a=Object.create(t);return Object.assign(a,e)}}function U(e,t=!1){return B(e)||j(e)||!D(e)||(R(e)>1&&(e.set=e.add=e.clear=e.delete=H),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>U(t,!0)))),e}function H(){O(2)}function B(e){return Object.isFrozen(e)}var K,J={};function q(e){const t=J[e];return t||O(0,e),t}function W(){return K}function G(e,t){t&&(q("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function X(e){Y(e),e.drafts_.forEach(Q),e.drafts_=null}function Y(e){e===K&&(K=e.parent_)}function Z(e){return K={drafts_:[],parent_:K,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Q(e){const t=e[E];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function ee(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[E].modified_&&(X(t),O(4)),D(e)&&(e=te(t,e),t.parent_||ae(t,e)),t.patches_&&q("Patches").generateReplacementPatches_(r[E].base_,e,t.patches_,t.inversePatches_)):e=te(t,r,[]),X(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==A?e:void 0}function te(e,t,r){if(B(t))return t;const a=t[E];if(!a)return T(t,((n,o)=>re(e,a,t,n,o,r))),t;if(a.scope_!==e)return t;if(!a.modified_)return ae(e,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;const t=a.copy_;let n=t,o=!1;3===a.type_&&(n=new Set(t),t.clear(),o=!0),T(n,((n,s)=>re(e,a,t,n,s,r,o))),ae(e,t,!1),r&&e.patches_&&q("Patches").generatePatches_(a,r,e.patches_,e.inversePatches_)}return a.copy_}function re(e,t,r,a,n,o,s){if("production"!==process.env.NODE_ENV&&n===r&&O(5),j(n)){const s=te(e,n,o&&t&&3!==t.type_&&!L(t.assigned_,a)?o.concat(a):void 0);if(N(r,a,s),!j(s))return;e.canAutoFreeze_=!1}else s&&r.add(n);if(D(n)&&!B(n)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;te(e,n),t&&t.scope_.parent_||"symbol"==typeof a||!Object.prototype.propertyIsEnumerable.call(r,a)||ae(e,n)}}function ae(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&U(t,r)}var ne={get(e,t){if(t===E)return e;const r=F(e);if(!L(r,t))return function(e,t,r){const a=ie(t,r);return a?"value"in a?a.value:a.get?.call(e.draft_):void 0}(e,r,t);const a=r[t];return e.finalized_||!D(a)?a:a===se(e.base_,t)?(le(e),e.copy_[t]=de(a,e)):a},has:(e,t)=>t in F(e),ownKeys:e=>Reflect.ownKeys(F(e)),set(e,t,r){const a=ie(F(e),t);if(a?.set)return a.set.call(e.draft_,r),!0;if(!e.modified_){const a=se(F(e),t),s=a?.[E];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((n=r)===(o=a)?0!==n||1/n==1/o:n!=n&&o!=o)&&(void 0!==r||L(e.base_,t)))return!0;le(e),ce(e)}var n,o;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==se(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,le(e),ce(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=F(e),a=Reflect.getOwnPropertyDescriptor(r,t);return a?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:a.enumerable,value:r[t]}:a},defineProperty(){O(11)},getPrototypeOf:e=>z(e.base_),setPrototypeOf(){O(12)}},oe={};function se(e,t){const r=e[E];return(r?F(r):e)[t]}function ie(e,t){if(!(t in e))return;let r=z(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=z(r)}}function ce(e){e.modified_||(e.modified_=!0,e.parent_&&ce(e.parent_))}function le(e){e.copy_||(e.copy_=V(e.base_,e.scope_.immer_.useStrictShallowCopy_))}T(ne,((e,t)=>{oe[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),oe.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&O(13),oe.set.call(this,e,t,void 0)},oe.set=function(e,t,r){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&O(14),ne.set.call(this,e[0],t,r,e[0])};function de(e,t){const r=$(e)?q("MapSet").proxyMap_(e,t):P(e)?q("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),a={type_:r?1:0,scope_:t?t.scope_:W(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=a,o=ne;r&&(n=[a],o=oe);const{revoke:s,proxy:i}=Proxy.revocable(n,o);return a.draft_=i,a.revoke_=s,i}(e,t);return(t?t.scope_:W()).drafts_.push(r),r}function ue(e){if(!D(e)||B(e))return e;const t=e[E];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=V(e,t.scope_.immer_.useStrictShallowCopy_)}else r=V(e,!0);return T(r,((e,t)=>{N(r,e,ue(t))})),t&&(t.finalized_=!1),r}var pe=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if("function"==typeof e&&"function"!=typeof t){const r=t;t=e;const a=this;return function(e=r,...n){return a.produce(e,(e=>t.call(this,e,...n)))}}let a;if("function"!=typeof t&&O(6),void 0!==r&&"function"!=typeof r&&O(7),D(e)){const n=Z(this),o=de(e,void 0);let s=!0;try{a=t(o),s=!1}finally{s?X(n):Y(n)}return G(n,r),ee(a,n)}if(!e||"object"!=typeof e){if(a=t(e),void 0===a&&(a=e),a===A&&(a=void 0),this.autoFreeze_&&U(a,!0),r){const t=[],n=[];q("Patches").generateReplacementPatches_(e,a,t,n),r(t,n)}return a}O(1,e)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...r)=>this.produceWithPatches(t,(t=>e(t,...r)));let r,a;return[this.produce(e,t,((e,t)=>{r=e,a=t})),r,a]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){D(e)||O(8),j(e)&&(e=function(e){j(e)||O(10,e);return ue(e)}(e));const t=Z(this),r=de(e,void 0);return r[E].isManual_=!0,Y(t),r}finishDraft(e,t){const r=e&&e[E];r&&r.isManual_||O(9);const{scope_:a}=r;return G(a,t),ee(void 0,a)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const a=t[r];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}r>-1&&(t=t.slice(r+1));const a=q("Patches").applyPatches_;return j(e)?a(e,t):this.produce(e,(e=>a(e,t)))}},fe=pe.produce;pe.produceWithPatches.bind(pe),pe.setAutoFreeze.bind(pe),pe.setUseStrictShallowCopy.bind(pe),pe.applyPatches.bind(pe),pe.createDraft.bind(pe),pe.finishDraft.bind(pe);const he=e=>(t,r,a)=>(a.setState=(e,r,...a)=>{const n="function"==typeof e?fe(e):e;return t(n,r,...a)},e(a.setState,r,a)),ye=30,ge=32;let me=null,ve=0,we=0,Se=0;const be=()=>{const e={top:0,left:0,height:Math.floor(window.document.querySelector(".area-root")?.getBoundingClientRect().height||0),width:Math.floor(window.document.querySelector(".area-root")?.getBoundingClientRect().width||0)},t=Date.now();if(window.__AREA_RESIZING__){if(Se||(Se=t,me||(me={...e},ve=e.width,we=e.height)),me)return me}else Se&&t-Se>500&&(Se=0);const r=Math.abs(e.width-ve),a=Math.abs(e.height-we),n=r>5||a>5;return window.__AREA_RESIZING__||!n||Se||(me={...e},ve=e.width,we=e.height),me||e};let Ie={};const xe=(e,t,r)=>e*(1-r)+t*r,Ae=(e,t,r)=>Math.min(t,Math.max(e,r)),_e=e=>e instanceof Ee?e:"number"==typeof e.left?new Ee(e.left,e.top):new Ee(e.x,e.y);class Ee{static new(e,t){return"number"==typeof e?new Ee(e,t):"number"==typeof e.left?new Ee(e.left,e.top):new Ee(e.x,e.y)}static fromEvent(e){return new Ee(e.clientX,e.clientY)}static dot(e,t){const r=_e(e),a=_e(t);return r.x*a.x+r.y*a.y}constructor(e,t){"number"==typeof e?(this._x=e,this._y=t):(this._x=e.x,this._y=e.y),this.atOrigin=0===this.x&&0===this.y,this.apply=this.apply.bind(this)}set x(e){this._x=e,this.atOrigin=0===this.x&&0===this.y}get x(){return this._x}set y(e){this._y=e,this.atOrigin=0===this.x&&0===this.y}get y(){return this._y}add(e){const t=_e(e);return t.atOrigin?this:new Ee(this.x+t.x,this.y+t.y)}addX(e){return new Ee(this.x+e,this.y)}addY(e){return new Ee(this.x,this.y+e)}sub(e){const t=_e(e);return t.atOrigin?this:new Ee(this.x-t.x,this.y-t.y)}subX(e){return new Ee(this.x-e,this.y)}subY(e){return new Ee(this.x,this.y-e)}subXY(e,t){return new Ee(this.x-e,this.y-t)}scale(e,t=Ee.new(0,0)){if(1===e)return this;const r=_e(t);return new Ee(r.x+(this.x-r.x)*e,r.y+(this.y-r.y)*e)}scaleX(e,t=Ee.new(0,0)){if(1===e)return this;const r=_e(t);return new Ee(r.x+(this.x-r.x)*e,this.y)}scaleY(e,t=Ee.new(0,0)){if(1===e)return this;const r=_e(t);return new Ee(this.x,r.y+(this.y-r.y)*e)}scaleXY(e,t,r=Ee.new(0,0)){if(1===e&&1===t)return this;const a=_e(r);return new Ee(a.x+(this.x-a.x)*e,a.y+(this.y-a.y)*t)}rotate(e,t=Ee.new(0,0)){if(0===e)return this;const r=_e(t),a=this.x-r.x,n=this.y-r.y,o=Math.cos(e),s=Math.sin(e),i=a*s+n*o;return new Ee(a*o-n*s+r.x,i+r.y)}multiplyMat2(e,t=Ee.new(0,0)){const r=_e(t);return e.multiplyVec2(this.sub(r)).add(r)}copy(){return new Ee(this.x,this.y)}lerp(e,t){const r=_e(e);return new Ee(xe(this.x,r.x,t),xe(this.y,r.y,t))}round(){return Ee.new(Math.round(this.x),Math.round(this.y))}apply(e){return _e(e(this))}length(){return Math.hypot(this.x,this.y)}eq(e){const t=_e(e);return t.x===this.x&&t.y===this.y}toJSON(){return{x:this.x,y:this.y,__objectType:"vec2"}}}Ee.ORIGIN=Ee.new(0,0);const ke=t.createContext(""),Oe=(e,t)=>{const r={};if("area"===t[e].type)return{};return r[e]=function e(a){const n=t[a];if("area"===n.type)return{width:1,height:1};const o={height:0,width:0},s=n.areas.map((t=>e(t.id)));return"horizontal"===n.orientation?(o.width=s.reduce(((e,t)=>e+t.width),0),o.height=Math.max(...s.map((e=>e.height)))):(o.height=s.reduce(((e,t)=>e+t.height),0),o.width=Math.max(...s.map((e=>e.width)))),r[a]=o,o}(e),r};function ze(e){const t={};if(!e)return console.error("computeAreaToParentRow received null or undefined layout."),{};const r=Object.keys(e);for(let a=0;a<r.length;a+=1){const n=e[r[a]];if(!n||"area_row"!==n.type)continue;const o=n;if(o.areas&&Array.isArray(o.areas))for(let e=0;e<o.areas.length;e+=1)o.areas[e]&&o.areas[e].id&&(t[o.areas[e].id]=o.id)}return t}const je={lastCalculation:0,totalCalculations:0,failedIds:new Set,reportedProblems:new Set,reset(){this.failedIds.clear(),this.reportedProblems.clear()}};setInterval((()=>{Date.now()-je.lastCalculation>6e4&&je.reset()}),6e4);let De={width:0,height:0};const Me=(e,t,r)=>{if(!t)return{};const a=JSON.parse(JSON.stringify(e));if(je.lastCalculation=Date.now(),je.totalCalculations++,!r||r.width<=0||r.height<=0){if(console.error("Invalid viewport dimensions",r),!(De.width>0&&De.height>0))return{};console.warn("Using last valid viewport dimensions"),r={...r,width:De.width,height:De.height}}else De={width:r.width,height:r.height};if(!e||0===Object.keys(e).length)return console.error("Empty layout provided to computeAreaToViewport"),{};if(!t||!a[t])return console.error(`Invalid rootId: ${t} - not found in layout`,e),{};const n={},o=new Set,s=je.reportedProblems;function i(e,t){e&&t?o.has(e.id)||(e.type||(console.warn(`Area ${e.id} has no type, defaulting to 'area'`),e.type="area"),t.width<=0||t.height<=0?console.warn(`Area ${e.id} has invalid content area size: ${t.width}x${t.height}`):(o.add(e.id),n[e.id]={...t})):console.error("Invalid area or contentArea in computeArea",{area:e,contentArea:t})}Object.entries(a).forEach((([e,t])=>{t?"area_row"!==t.type||t.areas&&Array.isArray(t.areas)||console.error(`Area row ${e} has invalid areas property`,t):console.error(`Invalid area definition for id ${e}`,t)}));const c=a[t];"area"===c.type?i(c,r):"area_row"===c.type&&function e(t,r){if(!t||!r||o.has(t.id)){if(t&&o.has(t.id))return;if(!t)return void console.error("computeRow: Invalid row");if(!r)return void console.error("computeRow: Invalid contentArea for row",t.id)}if(o.add(t.id),t.areas&&Array.isArray(t.areas)||(console.error("Row without proper areas array in computeRow",{rowId:t.id,areas:t.areas}),t.areas=[]),(r.width<=0||r.height<=0)&&(console.error("ContentArea with invalid dimensions in computeRow",{rowId:t.id,contentArea:r}),r={...r,width:Math.max(r.width,10),height:Math.max(r.height,10)},console.warn("Corrected contentArea to minimum size for row",t.id,r)),0===t.areas.length)return console.warn("Row with empty areas array in computeRow, skipping children but assigning viewport",{rowId:t.id}),void(n[t.id]={...r});n[t.id]={...r};const c=t.areas.map((e=>e.id)).filter((e=>!a[e]));c.length>0&&c.forEach((e=>{s.has(`auto_creating_${e}`)||(console.warn(`Auto-creating area ${e} referenced in row ${t.id}`),s.add(`auto_creating_${e}`)),a[e]={type:"area",id:e}}));const l=.05;let d=0;t.areas.forEach(((e,r)=>{e.size>1&&(e.size=e.size/100),"number"!=typeof e.size||isNaN(e.size)||e.size<=0?(0===e.size&&d++,s.has(`${t.id}_${r}_size`)||(console.warn(`Invalid size for area ${e.id}: ${e.size}, defaulting to 1/${t.areas.length}`),s.add(`${t.id}_${r}_size`)),e.size=1/t.areas.length):e.size<l&&(s.has(`${t.id}_${r}_min_size`)||(console.warn(`Area ${e.id} has very small size: ${e.size}, setting to minimum 0.05`),s.add(`${t.id}_${r}_min_size`)),e.size=l)}));const u=t.areas.reduce(((e,t)=>e+(t.size||0)),0);if(0===u||d===t.areas.length){console.warn(`All areas in row ${t.id} have zero size, setting equal distribution`);const e=1/t.areas.length;t.areas.forEach((t=>{t.size=e}))}else if(Math.abs(u-1)>.001){const e=1/u;t.areas.forEach((t=>{t.size=t.size*e}))}const p=t.areas.reduce(((e,t)=>e+(t.size||0)),0);if(Math.abs(p-1)>.001){console.error(`Failed to normalize sizes in row ${t.id}: final total=${p}`);const e=1/t.areas.length;t.areas.forEach((t=>{t.size=e}))}let f=r.left,h=r.top,y=0,g=0;for(let n=0;n<t.areas.length;n++){const o=t.areas[n];if(!o||!o.id)continue;const s=o.id,c=a[s],l=n===t.areas.length-1;if(!c)continue;let d,u;"horizontal"===t.orientation?(u=r.height,l?d=Math.max(0,r.width-y):(d=Math.max(0,Math.floor(o.size*r.width)),y+=d)):(d=r.width,l?u=Math.max(0,r.height-g):(u=Math.max(0,Math.floor(o.size*r.height)),g+=u));const p={left:f,top:h,width:d,height:u};try{"area"===c.type?i(c,p):"area_row"===c.type&&e(c,p)}catch(e){console.error(`[computeRow RECURSE_ERROR ${n}] Error computing viewport for area ${s}:`,e)}"horizontal"===t.orientation?f+=d:h+=u}}(c,r);const l=Object.keys(a).filter((e=>!n[e]));return l.length>0&&l.forEach((e=>{n[e]||(je.failedIds.add(e),n[e]={left:0,top:0,width:100,height:100})})),n},Ce=(e,t,r,a)=>{const n=a?Ee.new(e.x+a.x/15,e.y+a.y/15):e;let o,s,i,c=1/0;return Object.entries(r).forEach((([e,r])=>{const a=t.layout[e];if(!a||"area"!==a.type&&("area_row"!==a.type||"stack"!==a.orientation))return;if(n.x>=r.left&&n.x<=r.left+r.width&&n.y>=r.top&&n.y<=r.top+r.height)return void("area_row"===a.type&&"stack"===a.orientation?o=e:"area"===a.type&&(s=e));const l=Math.abs(n.x-r.left),d=Math.abs(n.x-(r.left+r.width)),u=Math.abs(n.y-r.top),p=Math.abs(n.y-(r.top+r.height)),f=Math.min(l,d,u,p);f<c&&(c=f,i=e)})),o||s||i};function Te(e,t){const r=t.x-e.left,a=t.y-e.top,n=r,o=e.width-r,s=a,i=e.height-a,c=e.width/2,l=e.height/2,d=Math.abs(r-c),u=Math.abs(a-l),p=.3*e.width,f=.3*e.height;if(d<p&&u<f)return"stack";const h=Math.min(n,o,s,i);let y;return y=h===n?"left":h===o?"right":h===s?"top":"bottom",y}const Re=(e,t,r)=>{const a=t,n=a+r;if(a<0||a>=e.areas.length||n<0||n>=e.areas.length)throw new Error(`Invalid indices: source=${a}, target=${n}, length=${e.areas.length}, direction=${-1===r?"west":"east"}`);const o=e.areas[a],s=e.areas[n];if(!o||!s)throw new Error(`Missing areas: source=${o}, target=${s}`);const i=(o.size||1)+(s.size||1);if(2===e.areas.length){return{area:{type:"area",id:o.id},removedAreaId:s.id}}const c=[...e.areas];c[n]={id:o.id,size:i},c.splice(a,1);return{area:{...e,areas:c},removedAreaId:s.id}},Le=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Ne=e=>{const[,t,r,a]=Le.exec(e);return[t,r,a].map((e=>parseInt(e,16)))},$e=e=>{const[t,r,a]=Ne(e);return[t,r,a,1]},Pe=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Fe=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Ve={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var Ue;exports.ActionPriority=void 0,(Ue=exports.ActionPriority||(exports.ActionPriority={}))[Ue.CRITICAL=1e3]="CRITICAL",Ue[Ue.HIGH=800]="HIGH",Ue[Ue.NORMAL=500]="NORMAL",Ue[Ue.LOW=200]="LOW",Ue[Ue.BACKGROUND=100]="BACKGROUND";const He={LEAD:"LEAD",FOLLOW:"FOLLOW",SELF:"SELF"},Be=new Map,Ke={registerComponent:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,component:t})},registerInitialState:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,initialState:t})},registerDisplayName:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,displayName:t})},registerIcon:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,icon:t})},registerDefaultSize:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,defaultSize:t})},registerSupportedActions:(e,t)=>{const r=Be.get(e)||{};Be.set(e,{...r,supportedActions:t})},getComponent:e=>Be.get(e)?.component,getInitialState:e=>Be.get(e)?.initialState||{},getDisplayName:e=>Be.get(e)?.displayName||e,getIcon:e=>Be.get(e)?.icon,getDefaultSize:e=>Be.get(e)?.defaultSize,getSupportedActions:e=>Be.get(e)?.supportedActions,getRegisteredTypes:()=>new Set(Array.from(Be.keys())),unregisterAreaType:e=>{Be.delete(e)}},Je=e=>{const t=[];return e.id||t.push("Missing ID"),e.type||t.push("Missing type"),e.state||t.push("Missing state"),e.type&&!Ke.getRegisteredTypes().has(e.type)&&t.push(`Invalid area type: ${e.type}`),{isValid:0===t.length,errors:t}},qe=e=>{const t=[];return"number"!=typeof e.x&&t.push("Position X must be a number"),"number"!=typeof e.y&&t.push("Position Y must be a number"),isNaN(e.x)&&t.push("Position X is NaN"),isNaN(e.y)&&t.push("Position Y is NaN"),{isValid:0===t.length,errors:t}},We=e=>{const t=[];return e.id||t.push("Missing ID"),e.label||t.push("Missing label"),e.actionId||t.push("Missing actionId"),{isValid:0===t.length,errors:t}},Ge=new Map,Xe=e=>{const t=Ge.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},Ye=(e,t={})=>(r,a,n)=>{const{enabled:o,anonymousActionType:s,store:i,...c}=t;let l;try{l=(null==o||o)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!l)return o&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,a,n);const{connection:d,...u}=((e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};const a=Ge.get(r.name);if(a)return{type:"tracked",store:e,...a};const n={connection:t.connect(r),stores:{}};return Ge.set(r.name,n),{type:"tracked",store:e,...n}})(i,l,c);let p=!0;n.setState=(e,t,o)=>{const l=r(e,t);if(!p)return l;const u=void 0===o?{type:s||"anonymous"}:"string"==typeof o?{type:o}:o;return void 0===i?(null==d||d.send(u,a()),l):(null==d||d.send({...u,type:`${i}/${u.type}`},{...Xe(c.name),[i]:n.getState()}),l)};const f=(...e)=>{const t=p;p=!1,r(...e),p=t},h=e(n.setState,a,n);if("untracked"===u.type?null==d||d.init(h):(u.stores[u.store]=n,null==d||d.init(Object.fromEntries(Object.entries(u.stores).map((([e,t])=>[e,e===u.store?h:t.getState()]))))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1;const t=n.dispatch;n.dispatch=(...r)=>{"__setState"!==r[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...r)}}return d.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):Ze(e.payload,(e=>{if("__setState"!==e.type)n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e);else{if(void 0===i)return void f(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[i];if(null==t)return;JSON.stringify(n.getState())!==JSON.stringify(t)&&f(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return f(h),void 0===i?null==d?void 0:d.init(n.getState()):null==d?void 0:d.init(Xe(c.name));case"COMMIT":return void 0===i?void(null==d||d.init(n.getState())):null==d?void 0:d.init(Xe(c.name));case"ROLLBACK":return Ze(e.state,(e=>{if(void 0===i)return f(e),void(null==d||d.init(n.getState()));f(e[i]),null==d||d.init(Xe(c.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ze(e.state,(e=>{void 0!==i?JSON.stringify(n.getState())!==JSON.stringify(e[i])&&f(e[i]):f(e)}));case"IMPORT_STATE":{const{nextLiftedState:r}=e.payload,a=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return f(void 0===i?a:a[i]),void(null==d||d.send(null,r))}case"PAUSE_RECORDING":return p=!p}return}})),h},Ze=(e,t)=>{let r;try{r=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==r&&t(r)};function Qe(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=r.getItem(e))?t:null;return n instanceof Promise?n.then(a):a(n)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}const et=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then:e=>et(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>et(t)(e)}}},tt=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(r,a,n)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const i=new Set,c=new Set;let l;try{l=o.getStorage()}catch(e){}if(!l)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)}),a,n);const d=et(o.serialize),u=()=>{const e=o.partialize({...a()});let t;const r=d({state:e,version:o.version}).then((e=>l.setItem(o.name,e))).catch((e=>{t=e}));if(t)throw t;return r},p=n.setState;n.setState=(e,t)=>{p(e,t),u()};const f=e(((...e)=>{r(...e),u()}),a,n);let h;const y=()=>{var e;if(!l)return;s=!1,i.forEach((e=>e(a())));const t=(null==(e=o.onRehydrateStorage)?void 0:e.call(o,a()))||void 0;return et(l.getItem.bind(l))(o.name).then((e=>{if(e)return o.deserialize(e)})).then((e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return e.state;if(o.migrate)return o.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((e=>{var t;return h=o.merge(e,null!=(t=a())?t:f),r(h,!0),u()})).then((()=>{null==t||t(h,void 0),s=!0,c.forEach((e=>e(h)))})).catch((e=>{null==t||t(void 0,e)}))};return n.persist={setOptions:e=>{o={...o,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>y(),hasHydrated:()=>s,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},y(),h||f})(e,t)):((e,t)=>(r,a,n)=>{let o={storage:Qe((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const i=new Set,c=new Set;let l=o.storage;if(!l)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)}),a,n);const d=()=>{const e=o.partialize({...a()});return l.setItem(o.name,{state:e,version:o.version})},u=n.setState;n.setState=(e,t)=>{u(e,t),d()};const p=e(((...e)=>{r(...e),d()}),a,n);let f;n.getInitialState=()=>p;const h=()=>{var e,t;if(!l)return;s=!1,i.forEach((e=>{var t;return e(null!=(t=a())?t:p)}));const n=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=a())?e:p))||void 0;return et(l.getItem.bind(l))(o.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate)return[!0,o.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]})).then((e=>{var t;const[n,s]=e;if(f=o.merge(s,null!=(t=a())?t:p),r(f,!0),n)return d()})).then((()=>{null==n||n(f,void 0),f=a(),s=!0,c.forEach((e=>e(f)))})).catch((e=>{null==n||n(void 0,e)}))};return n.persist={setOptions:e=>{o={...o,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>h(),hasHydrated:()=>s,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},o.skipHydration||h(),f||p})(e,t),rt=[];for(let e=0;e<256;++e)rt.push((e+256).toString(16).slice(1));let at;const nt=new Uint8Array(16);var ot={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function st(e,t,r){if(ot.randomUUID&&!e)return ot.randomUUID();const a=(e=e||{}).random??e.rng?.()??function(){if(!at){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");at=crypto.getRandomValues.bind(crypto)}return at(nt)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(e,t=0){return(rt[e[t+0]]+rt[e[t+1]]+rt[e[t+2]]+rt[e[t+3]]+"-"+rt[e[t+4]]+rt[e[t+5]]+"-"+rt[e[t+6]]+rt[e[t+7]]+"-"+rt[e[t+8]]+rt[e[t+9]]+"-"+rt[e[t+10]]+rt[e[t+11]]+rt[e[t+12]]+rt[e[t+13]]+rt[e[t+14]]+rt[e[t+15]]).toLowerCase()}(a)}function it(e,t){let r={...e};return t.changes.forEach((e=>{let t=r;for(let r=0;r<e.path.length-1;r++)t=t[e.path[r]];t[e.path[e.path.length-1]]=e.oldValue})),r}const ct=he(((e,t)=>({spaces:{},activeSpaceId:null,openSpaceIds:[],errors:[],pilotMode:"AUTO",addSpace:r=>{if(!r.name)return e((e=>{e.errors=["Space name cannot be empty."]})),void console.error("Validation failed for space:",t().errors);const a=st(),n={id:a,name:r.name,description:r.description??"",sharedState:{color:r.sharedState?.color??"#ff0000",pastDiffs:[],futureDiffs:[],...r.sharedState||{}}};return e((e=>{e.spaces[a]=n,e.openSpaceIds.push(a),e.errors=[]})),a},removeSpace:t=>{e((e=>{delete e.spaces[t],e.activeSpaceId===t&&(e.activeSpaceId=null),e.openSpaceIds=e.openSpaceIds.filter((e=>e!==t)),e.errors=[]}))},setActiveSpace:t=>{e((e=>{null===t||e.spaces[t]?e.activeSpaceId=t:console.warn(`Attempted to set active space to non-existent ID: ${t}`),e.errors=[]}))},setPilotMode:t=>{e((e=>{e.pilotMode=t}))},openSpace:t=>{e((e=>{e.spaces[t]&&!e.openSpaceIds.includes(t)&&e.openSpaceIds.push(t)}))},closeSpace:t=>{e((e=>{e.openSpaceIds=e.openSpaceIds.filter((e=>e!==t)),e.activeSpaceId===t&&(e.activeSpaceId=e.openSpaceIds[e.openSpaceIds.length-1]||null)}))},updateSpace:t=>{e((e=>{const r=e.spaces[t.id];if(r){if(""===t.name)return e.errors=["Space name cannot be empty."],void console.error("Validation failed for space update:",e.errors);const{id:a,...n}=t;e.spaces[a]={...r,...n},e.errors=[]}else e.errors=[`Space with ID ${t.id} not found for update.`],console.error("Update failed:",e.errors)}))},updateSpaceGenericSharedState:r=>{const{spaceId:a,changes:n}=r,o=t().spaces[a];if(!o)return e((e=>{e.errors=[`Space with ID ${r.spaceId} not found for shared state update.`]})),void console.error("Shared state update failed: Space not found");const s=o.sharedState,i=n.actionType||"UPDATE_SHARED_STATE",c=n.payload||{};e((e=>{const t=e.spaces[a];if(t){const{actionType:r,payload:a,...o}=n;t.sharedState={...t.sharedState,...o},e.errors=[]}}));const l=t().spaces[a]?.sharedState;if(!l)return void console.error("Shared state update failed: Space disappeared after update?");const d=function(e,t){const r=[];return function e(t,a,n){if(a!==n)if(typeof a==typeof n)if("object"==typeof a&&null!==a&&null!==n){const o=a,s=n,i=Object.keys(o),c=Object.keys(s);i.forEach((e=>{c.includes(e)||r.push({path:[...t,e],oldValue:o[e],newValue:void 0})})),c.forEach((a=>{i.includes(a)?e([...t,a],o[a],s[a]):r.push({path:[...t,a],oldValue:void 0,newValue:s[a]})}))}else r.push({path:t,oldValue:a,newValue:n});else r.push({path:t,oldValue:a,newValue:n})}([],e,t),r}(s,l);Array.isArray(d)&&d.length>0&&e((e=>{const t=e.spaces[a];t&&(t.sharedState.pastDiffs||(t.sharedState.pastDiffs=[]),t.sharedState.pastDiffs.push({timestamp:Date.now(),actionType:i,payload:c,changes:d}),t.sharedState.futureDiffs=[])}))},clearErrors:()=>{e((e=>{e.errors=[]}))},undoSharedState:t=>{e((e=>{const r=e.spaces[t];if(!r?.sharedState?.pastDiffs?.length)return;const a=r.sharedState.pastDiffs.pop(),n=it(r.sharedState,a);r.sharedState=n,r.sharedState.futureDiffs||(r.sharedState.futureDiffs=[]),r.sharedState.futureDiffs.push(a)}))},redoSharedState:t=>{e((e=>{const r=e.spaces[t];if(!r?.sharedState?.futureDiffs?.length)return;const a=r.sharedState.futureDiffs.pop(),n=(o=a,{...o,changes:o.changes.map((e=>({...e,oldValue:e.newValue,newValue:e.oldValue})))});var o;const s=it(r.sharedState,n);r.sharedState=s,r.sharedState.pastDiffs||(r.sharedState.pastDiffs=[]),r.sharedState.pastDiffs.push(a)}))},getSpaceById:e=>t().spaces[e],getAllSpaces:()=>t().spaces,getActiveSpace:()=>{const e=t();return e.activeSpaceId?e.spaces[e.activeSpaceId]:null},getActiveSpaceId:()=>t().activeSpaceId,getOpenSpaces:()=>{const e=t();return e.openSpaceIds.map((t=>e.spaces[t])).filter((e=>void 0!==e))},getSpaceErrors:()=>t().errors,getPilotMode:()=>t().pilotMode}))),lt=tt(ct,{name:"space-storage",partialize:e=>{const t={};for(const r in e.spaces){const{sharedState:a,...n}=e.spaces[r],{pastDiffs:o,futureDiffs:s,...i}=a??{};t[r]={...n,sharedState:i}}const{activeSpaceId:r}=e;return{spaces:t,activeSpaceId:r}},merge:(e,t)=>{const r=e,a={},n=r?.spaces??{},o=t.spaces,s=new Set([...Object.keys(n),...Object.keys(o)]);for(const e of s){const t=n[e],r=o[e];if(!t&&!r)continue;const s=r?.sharedState??{},i=t?.sharedState??{};a[e]={id:t?.id??r?.id??e,name:t?.name??r?.name??`Space ${e}`,description:t?.description??r?.description??"",sharedState:{...s,...i,pastDiffs:[],futureDiffs:[]}},a[e].sharedState.color||(a[e].sharedState.color="#000000")}return{...t,activeSpaceId:r?.activeSpaceId??t.activeSpaceId,spaces:a,errors:[]}}}),dt=x()(Ye(lt,{name:"SpaceStore"}));const ut=new class{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}publish(e){this.listeners.forEach((t=>t(e)))}},pt={_id:0,rootId:null,updateLayout:()=>{},errors:[],activeAreaId:null,joinPreview:null,layout:{},areas:{},viewports:{},areaToOpen:null,lastSplitResultData:null,lastLeadAreaId:null,addArea:()=>"",removeArea:()=>{},setActiveArea:()=>{},updateArea:()=>{},setAreaToOpen:()=>{},updateAreaToOpenPosition:()=>{},finalizeAreaPlacement:()=>{},cleanupTemporaryStates:()=>{},setViewports:()=>{},setRowSizes:()=>{},splitArea:()=>null,setJoinPreview:()=>{},joinOrMoveArea:()=>{},getLastSplitResult:()=>null,getActiveArea:()=>null,getAreaById:()=>{},getAllAreas:()=>({}),getAreaErrors:()=>[],getLastLeadAreaId:()=>null},ft=()=>JSON.parse(JSON.stringify({areas:pt}));function ht(e,t,r){for(const a in e){const n=e[a];if("area_row"===n.type){const e=n,a=e.areas.findIndex((e=>e.id===t)),o=e.areas.findIndex((e=>e.id===r));if(-1!==a&&-1!==o&&1===Math.abs(a-o))return{parentRow:e,sourceIndex:a,targetIndex:o}}}return{parentRow:null,sourceIndex:-1,targetIndex:-1}}function yt(e,t){if(!t)return;const r=e.layout[t];if(!r||"area_row"!==r.type)return;const a=r;if(1!==a.areas.length)return;const n=a.areas[0],o=n.id,s=ze(e.layout)[t];if(s&&"area_row"===e.layout[s]?.type){const r=e.layout[s],a=r.areas.findIndex((e=>e.id===t));if(-1===a)return void console.error(`[simplifyLayoutNodeIfNeeded] Cleanup Error: Row ${t} not found in parent ${s}.`);{const e=r.areas[a].size??n.size??.5;r.areas[a]={id:o,size:e}}}else e.rootId===t?e.rootId=o:console.warn(`[simplifyLayoutNodeIfNeeded] Row ${t} has single child ${o} but no parent and is not root. Removing row.`);delete e.layout[t]}function gt(e,t){const r=e[t];return r?"area"===r.type?t:"area_row"===r.type?0===r.areas.length?null:gt(e,r.areas[0].id):null:null}const mt=(e,t)=>({...pt,addArea:t=>{let r="";return e((e=>{console.log("state",e);const a=e.screens[e.activeScreenId]?.areas;if(console.log("activeScreenAreas",a),!a)return;const n=t.id||st();let o;if(t.type){o=(Ke._roleMap||{})[t.type]}const s={...t,id:n,role:o};if(o===He.LEAD&&!s.spaceId){const e=dt.getState().spaces,r=Object.keys(e);if(r.length>0){const e=dt.getState().activeSpaceId;s.spaceId=e||r[0]}else{const e=dt.getState().addSpace({name:`Space for ${t.type}`,sharedState:{}});e&&(s.spaceId=e)}}console.log("areaWithId",s);const i=Je(s);i.isValid?(a.areas[n]=s,a._id+=1,a.errors=[],r=n,e.lastUpdated=Date.now()):(a.errors=i.errors,console.error("Validation failed for area:",i.errors))})),console.log("generatedAreaId",r),r},removeArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;if(Object.keys(r.areas).length<=1)console.warn("Cannot remove the last area of a screen");else{delete r.areas[t],delete r.layout[t];for(const e in r.layout){const a=r.layout[e];if("area_row"===a.type){const n=a,o=n.areas.findIndex((e=>e.id===t));if(-1!==o)if(n.areas.splice(o,1),"stack"===n.orientation){if(n.activeTabId===t&&(n.activeTabId=n.areas[0]?.id||void 0),0===n.areas.length)delete r.layout[e];else if(1===n.areas.length){const t=Object.keys(r.layout).find((t=>{const a=r.layout[t];return"area_row"===a.type&&a.areas.some((t=>t.id===e))}));if(t){const a=r.layout[t],o=a.areas.findIndex((t=>t.id===e));-1!==o&&(a.areas[o]={...n.areas[0]}),delete r.layout[e]}else r.rootId===e&&(r.rootId=n.areas[0].id,delete r.layout[e])}}else 0===n.areas.length&&delete r.layout[e]}}r.rootId===t&&(r.rootId=null),r.activeAreaId===t&&(r.activeAreaId=null),r.errors=[],e.lastUpdated=Date.now(),ut.publish({type:"cleanup",areaId:t})}})),setActiveArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&(null===t||r.areas[t])&&r.activeAreaId!==t&&(r.activeAreaId=t,t&&r.areas[t]?.role===He.LEAD&&(r.lastLeadAreaId=t),r.errors=[],e.lastUpdated=Date.now())})),updateArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.areas[t.id];if(a){const e=t.role;e&&e!==a.role&&ut.publish({type:"cleanup",areaId:a.id}),Object.assign(a,t,{role:e})}})),updateLayout:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.layout[t.id];if(a&&"area_row"===a.type){const n=JSON.stringify(a);void 0!==t.activeTabId&&(a.activeTabId=t.activeTabId),void 0!==t.areas&&(a.areas=t.areas);n!==JSON.stringify(a)&&(r.errors=[],e.lastUpdated=Date.now())}else r.errors=[`Layout with ID ${t.id} not found or not a row.`]})),setAreaToOpen:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&r.areaToOpen!==t&&(r.areaToOpen=t,e.lastUpdated=Date.now())})),updateAreaToOpenPosition:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;!r?.areaToOpen||r.areaToOpen.position.x===t.x&&r.areaToOpen.position.y===t.y||(r.areaToOpen.position=t)})),finalizeAreaPlacement:r=>e((e=>{const a=e.screens[e.activeScreenId]?.areas;if(!a)return;const n=a.areaToOpen;if(n)try{const{position:o,area:s}=n,i=s.state?.sourceId,c=i||st(),l=new Ee(o.x,o.y);if(!i){if(a.areas[c])return console.error(`finalizeAreaPlacement: ID conflict for new area ${c}`),void(a.areaToOpen=null);a.areas[c]={id:c,type:s.type,state:s.state},a._id+=1}const d=be(),u=Me(a.layout,a.rootId||"",d);let p=r?.targetId,f=r?.placement;if(!p){const e=new Ee(300,200);p=Ce(l,a,u,e)}if(!p)return i||delete a.areas[c],void(a.areaToOpen=null);const h=u[p];if(!h)return console.error(`[areaStore] finalizeAreaPlacement: Viewport not found for target ${p}. Bailing out.`),i||delete a.areas[c],void(a.areaToOpen=null);f||(f=Te(h,l)),a.areaToOpen=null;let y=null,g=null;if(i){const e=ze(a.layout),t=e[i];if(y=t,t&&"area_row"===a.layout[t]?.type){const r=a.layout[t],n=r.areas.findIndex((e=>e.id===i));if(-1!==n)if(r.areas.splice(n,1),0===r.areas.length){delete a.layout[t];yt(a,e[t])}else{const e=r.areas.reduce(((e,t)=>e+(t.size||0)),0);if(e>0){const t=1/e;r.areas.forEach((e=>{e.size=(e.size||0)*t}))}1===r.areas.length&&(g=r.areas[0].id),yt(a,t)}}else a.layout[i]&&delete a.layout[i];i!==c&&delete a.areas[i],a.rootId===i&&(a.rootId=null)}p&&p===y&&g&&!a.layout[p]&&(p=g);let m="stack"===f?"horizontal":"top"===f||"bottom"===f?"vertical":"horizontal";if("stack"===f){let e=p,r=a.areas[e];if("area_row"===a.layout[e]?.type&&"stack"===a.layout[e].orientation)r=a.areas[e];else if(!r&&"area_row"===a.layout[e]?.type){const t=gt(a.layout,e);t&&(e=t,r=a.areas[e])}const n=a.areas[c];if(!n||!r)return void console.error("[finalizeAreaPlacement] Stack creation failed: Source or target area not found.");if(!(!1!==t().options?.allowStackMixedRoles)){const e=n.role||n.type&&Ke._roleMap?.[n.type],t=r.role||r.type&&Ke._roleMap?.[r.type];if(e&&t&&e!==t)return void(a.errors=["Impossible de stacker des areas de rôles différents (option de configuration)"])}const o=`row-${a._id+1}`;a._id+=1;const s={type:"area_row",id:o,orientation:"stack",areas:[{id:e,size:.5},{id:c,size:.5}],activeTabId:e},i=ze(a.layout)[e];if(i&&"area_row"===a.layout[i]?.type){const t=a.layout[i],r=t.areas.findIndex((t=>t.id===e));if(-1!==r){const e=t.areas[r].size;t.areas[r]={id:o,size:e}}}else a.rootId===e&&(a.rootId=o);a.layout[o]=s,a.activeAreaId=e}else{const e=ze(a.layout)[p],t=e?a.layout[e]:null,r=st();if(a.layout[c]||(a.layout[c]={type:"area",id:c}),t&&"area_row"===t.type){const n=t.areas.findIndex((e=>e.id===p));if(-1===n)return void console.error(`[finalizeAreaPlacement] Target ${p} not found in parent ${e}`);if(t.orientation===m){const e=n+("bottom"===f||"right"===f?1:0);let r=[];r=0===e?[t.areas[0]]:e===t.areas.length?[t.areas[t.areas.length-1]]:[t.areas[e-1],t.areas[e]];const a=r.reduce(((e,t)=>e+(t.size||0)),0),o=a/(r.length+1);r.forEach((e=>e.size=o)),t.areas.splice(e,0,{id:c,size:o})}else{a._id+=1;const e={type:"area_row",id:r,orientation:m,areas:"bottom"===f||"right"===f?[{id:p,size:.5},{id:c,size:.5}]:[{id:c,size:.5},{id:p,size:.5}]};a.layout[r]=e,t.areas[n]={id:r,size:t.areas[n].size}}}else{a._id+=1;const e={type:"area_row",id:r,orientation:m,areas:"bottom"===f||"right"===f?[{id:p,size:.5},{id:c,size:.5}]:[{id:c,size:.5},{id:p,size:.5}]};a.layout[r]=e,a.rootId=r,a.layout[p]||(a.layout[p]={type:"area",id:p})}}if(a.areas[c]&&(e.screens[e.activeScreenId].areas.activeAreaId=c,a.areas[c].role===He.LEAD&&(e.screens[e.activeScreenId].areas.lastLeadAreaId=c)),a.rootId&&d&&d.width>0&&d.height>0){const e=Me(a.layout,a.rootId,d);a.viewports=e}else a.viewports={};e.lastUpdated=Date.now()}catch(e){a&&(a.areaToOpen=null),a.errors=[`Error finalizing area placement: ${e}`]}else a.errors=["No area to open"]})),cleanupTemporaryStates:()=>e((e=>{const t=e.screens[e.activeScreenId]?.areas;t&&(t.joinPreview||t.areaToOpen||t.lastSplitResultData)&&(t.joinPreview=null,t.areaToOpen=null,t.lastSplitResultData=null,e.lastUpdated=Date.now())})),setViewports:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&(r.viewports=t)})),setRowSizes:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.layout[t.rowId];if(a&&"area_row"===a.type){const r=a;if(r.areas.length===t.sizes.length){let a=t.sizes.reduce(((e,t)=>e+t),0);if(Math.abs(a-1)>.001&&a>0){const e=1/a;r.areas.forEach(((r,a)=>{r&&(r.size=t.sizes[a]*e)}))}else r.areas.forEach(((e,r)=>{e&&(e.size=t.sizes[r])}));e.lastUpdated=Date.now()}}})),splitArea:t=>{let r=null;return e((e=>{const a=e.screens[e.activeScreenId]?.areas;if(!a)return;const{areaIdToSplit:n,parentRowId:o,horizontal:s}=t,i=a.layout[n];if("area_row"===i.type&&"stack"===i.orientation){const e=i.areas,t=[];for(const r of e){const e=a.areas[r.id];if(!e)continue;const n=`area-${a._id+1}`;a._id+=1,a.areas[n]={id:n,type:e.type,state:{...e.state}},a.layout[n]={type:"area",id:n},t.push({id:n,size:r.size})}const c=`row-${a._id+1}`;a._id+=1;const l={id:c,type:"area_row",orientation:"stack",areas:t,activeTabId:t[0]?.id};a.layout[c]=l;const d=`row-${a._id+1}`;a._id+=1;const u={id:d,type:"area_row",orientation:s?"horizontal":"vertical",areas:[{id:n,size:.5},{id:c,size:.5}]};if(a.layout[d]=u,o){const e=a.layout[o];if("area_row"===e?.type){const t=e.areas.findIndex((e=>e.id===n));if(-1!==t){const r=e.areas[t].size??.5;e.areas[t]={id:d,size:r}}}}else a.rootId=d;return void(r={newRowId:d,separatorIndex:1})}a._id+=1;const c=a._id,l=`area-${c}`,d=`row-${c+1}`;if(a.areas[l]||a.layout[l])return void console.error(`splitArea: ID conflict for new area ${l}`);const u=a.areas[n];if(a.areas[l]={id:l,type:u?.type||i.type,state:{...u?.state},spaceId:u?.spaceId},a.layout[l]={type:"area",id:l},a.layout[d])return void console.error(`splitArea: ID conflict for new row ${d}`);const p={id:d,type:"area_row",orientation:s?"horizontal":"vertical",areas:[{id:n,size:.5},{id:l,size:.5}]};a.layout[d]=p;let f=.5;if(o){const e=a.layout[o];if("area_row"===e?.type){const t=e.areas.findIndex((e=>e.id===n));if(-1!==t)if(f=e.areas[t].size??.5,e.orientation===p.orientation){const a=p.areas.map((e=>({id:e.id,size:(e.size??.5)*f})));e.areas.splice(t,1,...a),r={newRowId:o,separatorIndex:t+1}}else e.areas[t]={id:d,size:f},r={newRowId:d,separatorIndex:1};else console.error(`splitArea Error: Area ${n} not in parent ${o}.`)}else console.error(`splitArea Error: Parent ${o} not found or not row.`)}else a.rootId===n?(a.rootId=d,r={newRowId:d,separatorIndex:1}):console.error(`splitArea Error: Area ${n} has no parent and is not root.`);a._id=c+2,a.lastSplitResultData=r,function(e){if(!e)return;let t=e;for(;t;){const e=a.layout[t];yt(a,t);if(t=ze(a.layout)[t],!e||a.layout[e.id])break}}(o),function e(t,r=null){if(!t)return;const n=a.layout[t];if(!n||"area_row"!==n.type)return;let o=!1;for(let e=0;e<n.areas.length;){const t=n.areas[e].id,r=a.layout[t];if(r&&"area_row"===r.type&&r.orientation===n.orientation){const s=r,i=n.areas[e].size??1/n.areas.length,c=s.areas.reduce(((e,t)=>e+(t.size??0)),0)||1,l=s.areas.map((e=>({id:e.id,size:(e.size??1/s.areas.length)*i/c})));n.areas.splice(e,1,...l.filter((e=>!n.areas.some((t=>t.id===e.id))))),delete a.layout[t],o=!0}else e++}for(const r of n.areas)e(r.id,t);o&&e(t,r)}(a.rootId),function(){const e=new Set;!function t(r){if(!r||e.has(r))return;e.add(r);const n=a.layout[r];if(n&&"area_row"===n.type)for(const e of n.areas)t(e.id)}(a.rootId);for(const t in a.layout){const r=a.layout[t];r&&"area_row"===r.type&&!e.has(t)&&delete a.layout[t]}}(),e.lastUpdated=Date.now()})),r},setJoinPreview:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&r.joinPreview!==t&&(r.joinPreview=t,e.lastUpdated=Date.now())})),joinOrMoveArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const{sourceAreaId:a,targetAreaId:n}=t,{parentRow:o,sourceIndex:s,targetIndex:i}=ht(r.layout,a,n);if(!o||"area_row"!==o.type)return r.errors=[`Could not find adjacent areas ${a}/${n} in the same row.`],void(r.joinPreview=null);const c=o.id,l=ze(r.layout)[c],d=JSON.parse(JSON.stringify(o)),u=i>s?1:-1,p=s;try{const e=Re(d,p,u),{area:t,removedAreaId:a}=e,n=function(e,t){const r=new Set,a=[t],n=new Set;for(;a.length>0;){const t=a.shift();if(n.has(t))continue;n.add(t);const o=e[t];if(o)if("area"===o.type)r.add(t);else if("area_row"===o.type){const e=o;e.areas&&Array.isArray(e.areas)&&e.areas.forEach((e=>{e&&e.id&&a.push(e.id)}))}}return"area"===e[t]?.type&&r.add(t),r}(r.layout,a);if(n.add(a),n.forEach((e=>{delete r.areas[e],delete r.layout[e]})),t.id===c&&"area_row"===t.type){const e=t;if(r.layout[c]=e,e.areas){const t=e.areas.reduce(((e,t)=>e+(t.size||0)),0);if(t>0){const r=1/t;e.areas.forEach((e=>{e.size=(e.size||0)*r}))}}1===e.areas?.length&&yt(r,c)}else if(delete r.layout[c],r.layout[t.id]||"area_row"!==t.type&&(r.layout[t.id]={type:"area",id:t.id}),l&&"area_row"===r.layout[l]?.type){const e=r.layout[l],a=e.areas.findIndex((e=>e.id===c));if(-1!==a){const r=e.areas[a].size??.5;e.areas[a]={id:t.id,size:r}}else console.error(`[joinOrMoveArea] Cleanup Error: Row ${c} not found in grandparent ${l}.`)}else r.rootId===c&&(r.rootId=t.id);r.activeAreaId&&n.has(r.activeAreaId)&&("area"===t.type?r.activeAreaId=t.id:r.activeAreaId=null),r.errors=[],r.joinPreview=null}catch(e){console.error("Error during joinOrMoveArea:",e),r.errors=[e instanceof Error?e.message:String(e)],r.joinPreview=null}e.lastUpdated=Date.now()})),getLastSplitResult:()=>{const e=t().screens[t().activeScreenId]?.areas;return e?e.lastSplitResultData:null},getActiveArea:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r&&r.activeAreaId?r.areas[r.activeAreaId]:null},getAreaById:e=>{const r=t(),a=r.screens[r.activeScreenId]?.areas;return a?a.areas[e]:void 0},getAllAreas:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?r.areas:{}},getAreaErrors:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?r.errors:[]},getLastLeadAreaId:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?.lastLeadAreaId||null},findParentRowAndIndices:ht}),vt=Math.random().toString(36).slice(2),wt=x()(he(tt(Ye(((e,t)=>{const r=mt(e,t);return{screens:{1:ft()},activeScreenId:"1",nextScreenId:2,options:{allowStackMixedRoles:!0},lastUpdated:Date.now(),layout_preset:[],addScreen:()=>e((e=>{const t=e.nextScreenId.toString();e.screens[t]=ft();const r=`area-default-${t}-0`,a=e.screens[t].areas;a.areas[r]={id:r,type:"text-note",state:{content:"New Screen"}},a.layout={[r]:{type:"area",id:r}},a.rootId=r,a._id=1,a.activeAreaId=r,e.nextScreenId+=1,e.activeScreenId=t,e.lastUpdated=Date.now()})),switchScreen:t=>e((e=>{e.screens[t]&&e.activeScreenId!==t?(e.activeScreenId=t,e.lastUpdated=Date.now()):e.screens[t]||console.warn(`Attempted to switch to non-existent screen ID: ${t}`)})),removeScreen:t=>e((e=>{if(Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).length<=1&&!e.screens[t]?.isDetached)return void console.warn("Cannot remove the last classic screen");if(!e.screens[t])return void console.warn(`Attempted to remove non-existent screen ID: ${t}`);delete e.screens[t];const r=Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).reduce(((e,t)=>Math.max(e,parseInt(t))),0);if(e.nextScreenId=r+1,e.activeScreenId===t){const t=Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).sort(((e,t)=>parseInt(e)-parseInt(t)));e.activeScreenId=t[0]||Object.keys(e.screens)[0]||"1"}const a=new URL(window.location.href);a.searchParams.get("screen")===t&&(a.searchParams.delete("screen"),window.history.replaceState({},"",a.toString())),e.lastUpdated=Date.now()})),duplicateScreen:t=>e((e=>{if(!e.screens[t])return void console.warn(`Attempted to duplicate non-existent screen ID: ${t}`);const r=e.nextScreenId.toString(),a=e.screens[t];e.screens[r]=JSON.parse(JSON.stringify(a)),e.nextScreenId+=1,e.activeScreenId=r,e.lastUpdated=Date.now()})),detachArea:t=>e((e=>{const r=e.getAreaById(t);if(!r)return void console.warn(`Area ${t} not found`);const a=`detached-${e.nextScreenId}`;e.nextScreenId+=1,e.screens[a]={...ft(),areas:{...ft().areas},isDetached:!0,detachedFromAreaId:t};const n=e.screens[a].areas;n.areas[t]={...r},n.layout={[t]:{type:"area",id:t}},n.rootId=t,n.activeAreaId=t;const o=e.screens[e.activeScreenId];if(o){delete o.areas.areas[t];for(const e in o.areas.layout){const r=o.areas.layout[e];"area_row"===r.type&&(r.areas=r.areas.filter((e=>e.id!==t)))}delete o.areas.layout[t],o.areas.rootId===t&&(o.areas.rootId=null);for(const e in o.areas.layout){const t=o.areas.layout[e];"area_row"===t.type&&1===t.areas.length&&yt(o.areas,e)}}const s=["width=800","height=600","menubar=no","toolbar=no","location=no","status=no","scrollbars=yes","resizable=yes"].join(",");window.open(`?screen=${a}`,a,s),e.lastUpdated=Date.now()})),addArea:r.addArea,removeArea:r.removeArea,setActiveArea:r.setActiveArea,updateArea:r.updateArea,updateLayout:r.updateLayout,setAreaToOpen:r.setAreaToOpen,updateAreaToOpenPosition:r.updateAreaToOpenPosition,finalizeAreaPlacement:r.finalizeAreaPlacement,cleanupTemporaryStates:r.cleanupTemporaryStates,setViewports:r.setViewports,setRowSizes:r.setRowSizes,splitArea:r.splitArea,setJoinPreview:r.setJoinPreview,joinOrMoveArea:r.joinOrMoveArea,getLastSplitResult:r.getLastSplitResult,getActiveArea:r.getActiveArea,getAreaById:r.getAreaById,getAllAreas:r.getAllAreas,getAreaErrors:r.getAreaErrors,findParentRowAndIndices:ht}}),{name:"KarmycRootStore"}),{name:"karmycRootState",partialize:e=>({screens:e.screens,activeScreenId:e.activeScreenId,nextScreenId:e.nextScreenId,lastUpdated:e.lastUpdated,options:e.options,layout_preset:e.layout_preset}),storage:Qe((()=>localStorage)),skipHydration:!1,onRehydrateStorage:()=>e=>{e||(console.warn("[KarmycStore] État invalide après hydratation, réinitialisation..."),wt.setState({screens:{1:ft()},activeScreenId:"1",nextScreenId:2,lastUpdated:Date.now(),options:{allowStackMixedRoles:!0}}))}}))),St=(e={})=>{const t=wt.getState(),r={...t.options,...e};t.screens&&0!==Object.keys(t.screens).length?wt.setState({options:r}):wt.setState({screens:{1:ft()},activeScreenId:"1",nextScreenId:2,lastUpdated:Date.now(),options:r})};if("undefined"!=typeof window){let e=null;const t=50;window.addEventListener("storage",(r=>{if("karmycRootState"===r.key){const r=localStorage.getItem("karmycRootState");if(!r)return;const a=JSON.parse(r);if(a?.state?.windowId===vt)return;const n=wt.getState(),o=a?.state?.screens||{},s=a?.state?.lastUpdated||0,i=n.lastUpdated||0,c=Object.keys(o).some((e=>{const t=o[e],r=n.screens[e];return!r||JSON.stringify(t)!==JSON.stringify(r)}));e&&clearTimeout(e),e=setTimeout((()=>{c&&s>i&&wt.setState((e=>({...e,screens:o,lastUpdated:s}))),e=null}),t)}}))}const bt={isVisible:!1,position:{x:0,y:0},items:[],errors:[],targetId:void 0,metadata:void 0,menuClassName:"menu",customContextMenuContent:null,menuType:void 0},It=x()(he((e=>({...bt,openContextMenu:t=>e((e=>{const{position:r,items:a,targetId:n,metadata:o}=t,s=t.menuClassName,i=qe(r);if(!i.isValid)return console.warn("Position validation failed:",i.errors),void(e.errors=i.errors);const c=a.map((e=>We(e))).filter((e=>!e.isValid));if(c.length>0)return console.warn("Items validation failed:",c),void(e.errors=c.flatMap((e=>e.errors||["Unknown item validation error"])));e.isVisible=!0,e.position=r,e.items=a,e.targetId=n,e.metadata=o,e.menuClassName=s||e.menuClassName||"menu",e.errors=[],e.menuType="default"})),openCustomContextMenu:t=>e((e=>{const{position:r,targetId:a,metadata:n,component:o}=t,s=t.menuClassName;if(!r)return console.warn("Aucune position fournie à openCustomContextMenu"),void(e.errors=["Aucune position fournie au menu contextuel"]);const i=qe(r);if(!i.isValid)return console.warn("Position validation failed:",i.errors),void(e.errors=i.errors);e.isVisible=!0,e.position=r,e.targetId=a,e.metadata=n,e.errors=[],e.menuClassName=s+" menu",e.customContextMenuContent=o,e.menuType="custom"})),closeContextMenu:()=>e((e=>{Object.assign(e,bt),e.menuType=void 0})),updateContextMenuPosition:t=>e((e=>{const r=qe(t);r.isValid?(e.position=t,e.errors=[]):e.errors=r.errors})),updateContextMenuItems:t=>e((e=>{const r=t.map((e=>We(e))).filter((e=>!e.isValid));r.length>0?e.errors=r.flatMap((e=>e.errors||["Unknown item validation error"])):(e.items=t,e.errors=[])})),clearErrors:()=>e((e=>{e.errors=[]}))}))));class xt{constructor(e={}){this.plugins=new Map,this.validators=new Map,this.actionHandlers=new Map,this.menuActionsByType=new Map,this.options={...e},e.defaultValidators&&(this.validators=new Map(Object.entries(e.defaultValidators)))}registerPlugin(e){this.plugins.set(e.id,e),e.onRegister&&e.onRegister()}unregisterPlugin(e){const t=this.plugins.get(e);t?.onUnregister&&t.onUnregister(),this.plugins.delete(e)}registerValidator(e,t){const r=this.validators.get(e)||[];this.validators.set(e,[...r,t])}unregisterValidators(e){this.validators.delete(e)}registerActionHandler(e,t,r){if(this.actionHandlers.set(e,{handler:t,metadata:r}),r?.menuType){const t=this.menuActionsByType.get(r.menuType)||new Set;t.add(e),this.menuActionsByType.set(r.menuType,t)}}unregisterActionHandler(e){const t=this.actionHandlers.get(e);if(t?.metadata?.menuType){const r=this.menuActionsByType.get(t.metadata.menuType);r&&(r.delete(e),0===r.size&&this.menuActionsByType.delete(t.metadata.menuType))}this.actionHandlers.delete(e)}validateAction(e){const t=this.validators.get(e.type)||[];for(const r of t){const t=r(e);if(!t.valid)return t}return{valid:!0}}handleAction(e){const t=this.validateAction(e);if(!t.valid)return void console.warn(`Invalid action: ${t.message}`);const r=Array.from(this.plugins.values()).sort(((e,t)=>t.priority-e.priority));for(const t of r)if(null===t.actionTypes||t.actionTypes.includes(e.type))try{t.handler(e)}catch(e){console.error(`Error in plugin ${t.id}:`,e)}}executeAction(e,t){const r=this.actionHandlers.get(e);return!!r?.handler&&(r.handler(t),!0)}getMenuActions(e){const t=this.menuActionsByType.get(e)||new Set;return Array.from(t).map((e=>{const t=this.actionHandlers.get(e);return t?{id:e,...t}:null})).filter((e=>null!==e&&void 0!==e.metadata)).sort(((e,t)=>(e.order||0)-(t.order||0)))}}const At=new xt,_t={initialize:e=>{e.actions.plugins.forEach((e=>{At.registerPlugin(e)})),e.actions.validators.forEach((({actionType:e,validator:t})=>{At.registerValidator(e,t)}))}},Et=e=>{const r=wt((e=>e.setAreaToOpen)),a=wt((e=>e.updateAreaToOpenPosition)),n=wt((e=>e.finalizeAreaPlacement)),o=wt((e=>e.cleanupTemporaryStates)),s=wt((e=>e.updateLayout)),i=wt((e=>e.screens[e.activeScreenId]?.areas.layout)),c=wt((e=>e.screens[e.activeScreenId]?.areas.rootId)),l=wt((e=>e.screens[e.activeScreenId]?.areas.areas)),d=wt((e=>e.screens[e.activeScreenId]?.areas.areaToOpen)),u=wt((e=>e.screens[e.activeScreenId]?.areas.viewports)),p=t.useRef(null),f=t.useRef(performance.now()),h=t.useRef(void 0),y=t.useRef(!1),g=t.useMemo((()=>Ee.new(300,200)),[]),m=t.useMemo((()=>{if(!d||!c||!u||0===Object.keys(u).length)return null;const e=Ee.new(d.position.x,d.position.y);return Ce(e,{layout:i},u,g)}),[d?.position.x,d?.position.y,i,c,l,u,g]),v=t.useMemo((()=>m?u[m]:null),[m,u]),w=t.useMemo((()=>{if(!d||!v)return"stack";const e=Ee.new(d.position.x,d.position.y);return Te(v,e)}),[v,d?.position.x,d?.position.y,d]),S=t.useCallback(((e,t)=>{y.current||(y.current=!0,h.current=requestAnimationFrame((()=>{a({x:e,y:t}),y.current=!1})))}),[a]),b=t.useCallback((e=>{e.preventDefault(),S(e.clientX,e.clientY)}),[S]),I=t.useCallback((t=>{if(!e?.type||!e?.id||!e?.state)return void console.warn("useAreaDragAndDrop - Missing required params for handleDragStart");const{type:a,id:n,state:o}=e;document.body.style.userSelect="none";const s=t.currentTarget.getBoundingClientRect();p.current={startX:t.clientX-s.left,startY:t.clientY-s.top,sourceId:n},f.current=performance.now();const i=document.createElement("div");i.style.width="1px",i.style.height="1px",i.style.position="fixed",i.style.top="-1px",i.style.left="-1px",i.style.opacity="0.01",i.style.pointerEvents="none",document.body.appendChild(i),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",JSON.stringify({type:"menubar",areaType:a,areaId:n})),t.dataTransfer.setDragImage(i,0,0),requestAnimationFrame((()=>{document.body.contains(i)&&document.body.removeChild(i),r({position:{x:t.clientX,y:t.clientY},area:{type:a,state:{...o,sourceId:n}}})})),document.addEventListener("dragover",b)}),[e,r,b]),x=t.useCallback((e=>{e.dataTransfer.types.includes("karmyc/tab-drag-source")||(e.preventDefault(),e.dataTransfer.dropEffect="move")}),[]),A=t.useCallback((e=>{let t;try{const r=e.dataTransfer.getData("text/plain");r&&(t=JSON.parse(r))}catch(e){return console.warn("[DropZone] handleDrop - Could not parse drag data",e),void o()}if(t&&"tab"===t.type)return console.warn('[DropZone] handleDrop - Received "tab" type drag, assuming handled by AreaTabs. Aborting here.'),void o();if(e.preventDefault(),e.stopPropagation(),!t)return console.warn("[DropZone] handleDrop - Invalid or missing source data type after tab check"),void o();const r=t.areaId;let a=null;const c=document.elementsFromPoint(e.clientX,e.clientY);for(const e of c){if(e.classList.contains("global-drag-overlay")||e.classList.contains("areaToOpenContainer"))continue;const t=e.closest("[data-areaid]");if(t){const e=t.dataset.areaid;if(e&&"-1"!==e&&e!==r){if(!Object.values(i).some((t=>"area_row"===t.type&&"stack"===t.orientation&&t.areas.some((t=>t.id===e))))){a=e;break}}}}if(!a)return console.warn("[DropZone] handleDrop: no targetAreaId found"),void o();try{S(e.clientX,e.clientY);if(Object.values(i).some((e=>"area_row"===e.type&&"stack"===e.orientation&&e.id===a))&&"stack"===w){const e=Object.values(i).find((e=>"area_row"===e.type&&"stack"===e.orientation&&e.id===a));if(e){const t=Object.values(i).find((e=>"area_row"===e.type&&e.areas.some((e=>e.id===r))));if(t){const e=t.areas.filter((e=>e.id!==r)),a=e.reduce(((e,t)=>e+t.size),0),n=e.map((t=>({...t,size:a>0?t.size/a:1/e.length})));s({...t,areas:n})}const a={...e,areas:[...e.areas,{id:r,size:1}]};s(a),wt.getState().updateArea({id:r,isLocked:!0}),o()}}else"stack"===w&&(wt.getState().updateArea({id:r,isLocked:!0}),wt.getState().updateArea({id:a,isLocked:!0})),n({targetId:a,placement:w}),o()}catch(e){console.error("[DropZone] handleDrop - Error during finalization:",e),o()}}),[o,n,S,w,i,s]),_=t.useCallback((()=>{if(document.body.style.userSelect="",!p.current)return;h.current&&cancelAnimationFrame(h.current);performance.now()-f.current<100||(p.current=null,o(),document.removeEventListener("dragover",b))}),[o,b]);return t.useEffect((()=>()=>{h.current&&cancelAnimationFrame(h.current)}),[]),{handleDragStart:I,handleDragOver:x,handleDragEnd:_,handleDrop:A,areaToOpenTargetId:m,areaToOpenTargetViewport:v,calculatedPlacement:w}},kt=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,t,r)=>r?r.toUpperCase():t.toLowerCase())))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ot=(...e)=>e.filter(((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t)).join(" ").trim(),zt=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var jt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=t.forwardRef((({color:e="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:n,className:o="",children:s,iconNode:i,...c},l)=>t.createElement("svg",{ref:l,...jt,width:r,height:r,stroke:e,strokeWidth:n?24*Number(a)/Number(r):a,className:Ot("lucide",o),...!s&&!zt(c)&&{"aria-hidden":"true"},...c},[...i.map((([e,r])=>t.createElement(e,r))),...Array.isArray(s)?s:[s]]))),Mt=(e,r)=>{const a=t.forwardRef((({className:a,...n},o)=>{return t.createElement(Dt,{ref:o,iconNode:r,className:Ot(`lucide-${s=kt(e),s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...n});var s}));return a.displayName=kt(e),a},Ct=Mt("app-window",[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]]),Tt=Mt("arrow-big-down",[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]]),Rt=Mt("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Lt=Mt("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Nt=Mt("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),$t=Mt("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Pt=Mt("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),Ft=Mt("file-up",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),Vt=Mt("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),Ut=Mt("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Ht=Mt("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Bt=Mt("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Kt=Mt("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),Jt=Mt("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),qt=Mt("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Wt=Mt("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Gt=Mt("trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),Xt=Mt("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Yt(e,r,a){t.useEffect((()=>(At.registerActionHandler(e,r,a),()=>{At.unregisterActionHandler(e)})),[e,r,a])}const Zt=x((e=>({t:null,setTranslationFunction:t=>e({t:t})}))),Qt=()=>{const{t:e}=Zt();return{t:(t,r)=>e?e(t,r):r}},er=()=>{const{t:t}=Qt(),a=It((e=>e.isVisible&&"custom"===e.menuType)),n=It((e=>e.position)),o=It((e=>e.closeContextMenu)),s=It((e=>e.targetId))||"",i=Ke._roleMap||{},c=Array.from(Ke.getRegisteredTypes()),l=dt((e=>e.spaces)),d=dt((e=>e.activeSpaceId)),u=[{role:He.LEAD,title:t("area.role.lead","LEAD"),items:[]},{role:He.FOLLOW,title:t("area.role.follow","FOLLOW"),items:[]},{role:He.SELF,title:t("area.role.self","SELF"),items:[]}];c.forEach((e=>{const t=i[e]||He.SELF,r=u.find((e=>e.role===t));r&&r.items.push(e)}));return Yt("switch-area-type",(e=>{e?.areaId&&e?.newType&&console.log(t("area.switch.log",`Switching area ${e.areaId} to type ${e.newType}`))})),e.jsx(r.ControlledMenu,{anchorPoint:n,state:a?"open":"closed",onClose:o,transition:!0,direction:"right",menuClassName:"switch-area-type-context-menu",children:u.map((r=>e.jsxs("div",{style:{flex:1,margin:"0 8px",width:"250px"},children:[e.jsx("div",{style:{padding:"4px 0 16px",marginBottom:8,textAlign:"left",borderBottom:"2px ridge #444",paddingBottom:4},children:r.title}),r.items.map((r=>{const a=Ke.getIcon(r);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:4},onClick:()=>{return e=r,wt.getState().updateArea({id:s,type:e}),void(o&&o());var e},onMouseDown:e=>e.preventDefault(),children:[e.jsx(a,{style:{width:16,height:16}}),t(`area.type.${r}`,Ke.getDisplayName(r))]},r)})),r.role===He.LEAD&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"4px 0 16px",marginTop:16,marginBottom:8,textAlign:"left",borderBottom:"2px ridge #444",paddingBottom:4},children:t("area.spaces.title","SPACES")}),Object.entries(l).map((([r,a])=>e.jsxs("div",{"data-testid":"space-switch-button",style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:4,backgroundColor:r===d?"rgba(255, 255, 255, 0.1)":"transparent",padding:"4px 8px",borderRadius:4},onClick:()=>(e=>{wt.getState().updateArea({id:s,spaceId:e}),o&&o()})(r),onMouseDown:e=>e.preventDefault(),children:[e.jsx("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:a.sharedState?.color||"#666"}}),t(`space.${r}.name`,a.name)]},r)))]})]},r.role)))})},tr=({state:r,type:a,id:n,style:o})=>{const{t:s}=Qt(),[i,c]=t.useState(!1),l=wt((e=>e.updateArea)),d=wt((e=>e.getAreaById(n)?.isLocked||!1)),u=wt((e=>e.options?.manageableAreas??!0)),p=wt((e=>e.getAreaById(n))),f=p?.enableFullscreen??!1,h=Ke._supportFullscreenMap?.[a]??!1,{handleDragStart:y,handleDragOver:g,handleDrop:m,handleDragEnd:v}=Et({type:a,id:n,state:r}),w=It((e=>e.openCustomContextMenu)),S=t.useRef(null),b=dt((e=>e.getSpaceById(p?.spaceId||"")));let I=b?.sharedState?.color||"#0000ff";if("FOLLOW"===p?.role){const e=wt.getState().activeScreenId,t=wt.getState().screens[e]?.areas.lastLeadAreaId,r=wt.getState().screens[e]?.areas.areas||{},a=t?r[t]:null,n=a?.spaceId;if(n){const e=dt.getState().spaces[n];e&&e.sharedState?.color&&(I=e.sharedState.color)}}return e.jsxs("div",{className:"select-area-button",draggable:u&&!d&&!f,title:s("area.drag","Move area"),onDragStart:e=>{u&&!f&&(c(!0),y(e),requestAnimationFrame((()=>{S.current&&(S.current.style.pointerEvents="none",S.current.style.opacity="0.5")})))},onDragOver:e=>{u&&!f&&g(e)},onDrop:e=>{u&&!f&&(i||m(e))},onDragEnd:()=>{u&&!f&&(c(!1),S.current.style.pointerEvents="auto",S.current.style.opacity="1",v())},onContextMenu:t=>{u&&!f&&(t.preventDefault(),(()=>{if(u&&S.current){const t=S.current.getBoundingClientRect();w({targetId:n,position:{x:t.left,y:t.top},component:e.jsx(er,{})})}})())},style:{cursor:!u||f||d?"default":i?"grabbing":"grab","--space-color":I,pointerEvents:"auto",height:"30px",...o},ref:S,children:[e.jsxs("div",{className:"select-area-button__main",children:[t.createElement(Ke.getIcon(a),{className:"select-area-button__icon",style:{color:I}}),Ke.getDisplayName(a)]}),e.jsxs("div",{className:"select-area-button__action-icons",children:[u&&!d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"select-area-icons select-area-button__detach",onClick:e=>{u&&(e.stopPropagation(),wt.getState().detachArea(n))},title:s("area.detach","Detach area"),children:e.jsx(Rt,{})}),e.jsx("button",{className:"select-area-icons select-area-button__close",onClick:e=>{u&&(e.stopPropagation(),wt.getState().removeArea(n))},title:s("area.close","Close area"),children:e.jsx(Xt,{})})]}),u&&e.jsxs(e.Fragment,{children:[h&&e.jsx("button",{className:"select-area-icons select-area-button__fullscreen",onClick:e=>{if(!u)return;e.stopPropagation();const t=document.querySelector(`[data-areaid="${n}"]`);if(t)if(f)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),l({id:n,enableFullscreen:!1,previousLayout:void 0,previousRootId:void 0});else{const e=wt.getState().screens[wt.getState().activeScreenId]?.areas.layout,r=wt.getState().screens[wt.getState().activeScreenId]?.areas.rootId;l({id:n,enableFullscreen:!0,previousLayout:e,previousRootId:r}),t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen();const a=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||(l({id:n,enableFullscreen:!1,previousLayout:void 0,previousRootId:void 0}),document.removeEventListener("fullscreenchange",a),document.removeEventListener("webkitfullscreenchange",a),document.removeEventListener("msfullscreenchange",a))};document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("msfullscreenchange",a)}},title:s("area.fullscreen","Toggle fullscreen"),children:f?e.jsx(Jt,{}):e.jsx(Kt,{})}),e.jsx("button",{className:"select-area-icons select-area-button__lock-icon "+(d?"locked":""),onClick:e=>{e.stopPropagation(),l({id:n,isLocked:!d})},title:s("area.lock","Lock/Unlock area"),children:d?e.jsx(Bt,{}):e.jsx(Ht,{})})]})]})]})},rr=t.memo((({rowId:r,row:a,areas:n})=>{const o=wt((e=>e.updateLayout)),s=wt((e=>e.setActiveArea)),[i,c]=t.useState({targetId:null,position:null}),[l,d]=t.useState(null),u=()=>{d(null),c({targetId:null,position:null})};return e.jsx("div",{className:"area-tabs",onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||c({targetId:null,position:null})},children:a.areas.map((({id:t})=>{const p=n[t];if(!p)return null;const f=a.activeTabId===t,h=i.targetId===t?`drop-indicator-${i.position}`:"",y=l===t;return e.jsx("div",{className:`area-tab ${f?"area-tab--active":""} ${h} ${y?"is-dragging-source":""}`,onClick:()=>(e=>{const t=n[e];t&&(o({id:r,activeTabId:e}),s(e),t.spaceId&&dt.getState().setActiveSpace(t.spaceId))})(t),draggable:p.isLocked,onDragStart:e=>p.isLocked?((e,t)=>{e.stopPropagation(),d(t),e.dataTransfer.setData("text/plain",JSON.stringify({type:"tab",areaId:t,sourceRowId:r})),e.dataTransfer.setData("karmyc/tab-drag-source","true"),e.dataTransfer.effectAllowed="move"})(e,t):void 0,onDragOver:e=>((e,t)=>{if(e.dataTransfer.types.includes("karmyc/tab-drag-source")){e.preventDefault(),e.dataTransfer.dropEffect="move";const r=e.currentTarget.getBoundingClientRect(),a=r.left+r.width/2,n=e.clientX<a?"before":"after";i.targetId===t&&i.position===n||c({targetId:t,position:n})}})(e,t),onDrop:e=>((e,t)=>{try{const n=e.dataTransfer.getData("text/plain");if(!n)return void c({targetId:null,position:null});const s=JSON.parse(n);if("tab"===s.type&&s.sourceRowId===r){e.preventDefault(),e.stopPropagation();const n=s.areaId,{targetId:l,position:d}=i;if(n===t&&l!==t)return void c({targetId:null,position:null});if(n===t&&l===t&&null===d)return void c({targetId:null,position:null});const u=[...a.areas],p=u.findIndex((e=>e.id===n)),f=a.areas.findIndex((e=>e.id===t));if(-1===p||-1===f)return void c({targetId:null,position:null});const[h]=u.splice(p,1);let y=f;p<f&&y--,n===t&&(y=p);let g=y;l===t&&"after"===d&&(g=y+1),u.splice(g,0,h),o({id:r,areas:u,activeTabId:a.activeTabId})}}catch(e){console.error("Error handling tab drop:",e)}c({targetId:null,position:null}),d(null)})(e,t),onDragEnd:u,"data-areaid":t,children:e.jsx(tr,{id:t,state:p.state,type:p.type})},t)}))})}));const ar=(e,t,r,a,n,o)=>{const s=wt.getState().screens[wt.getState().activeScreenId]?.areas.isDetached;if(s)return;e.preventDefault();const i=Ee.fromEvent(e);let c=i,l=null,d=null;const u=()=>{const e=wt.getState();return e.screens[e.activeScreenId]?.areas},p=u();if(!p)return void console.error("handleAreaDragFromCorner: Could not get active screen state.");const f=p.layout,h=p.rootId;if(!h||!f||!f[h])return void console.error("handleAreaDragFromCorner: Invalid initial active screen state (rootId or layout missing/invalid)");const y=ze(f)[r];function g(e){if((e?a.width:a.height)<64)return m(),void(l&&l(c));const o=wt.getState().getAreaById(r);if(!o)return void console.error("Source area data not found");const s=wt.getState().splitArea({areaIdToSplit:r,parentRowId:y,horizontal:e,corner:t});if(!s||!s.newRowId||void 0===s.separatorIndex)return console.error("Failed to split area or get split result info. Switching to join/move."),m(),void(l&&l(c));const{newRowId:i,separatorIndex:p}=s;setTimeout((()=>{const e=u();if(!e)return void console.error("Failed to get active screen state after split");const t=e.layout[i];if(!t||"area_row"!==t.type)return void console.error(`Split seemed successful but row ${i} not found or not a row in active screen state.`);if(!t.areas.every((e=>e.size>=.1)))return void console.error("Invalid sizes detected in new row layout");const r=t.areas[p].id;wt.getState().updateArea({id:r,type:o.type,state:{...o.state}});const a=t.areas.map((()=>1/t.areas.length));wt.getState().setRowSizes({rowId:i,sizes:a}),function(e,t,r){const a="horizontal"===e.orientation,n=e.areas[t-1]?.id,o=e.areas[t]?.id;if(!n||!o)return console.error("Cannot set up resize handlers: invalid separator index or missing areas.",{rowToResize:e,sepIndex:t}),l=null,void(d=()=>{});const s=e.areas.map((e=>e.size)),i=s[t-1]+s[t];if(i<=0)return console.error("Invalid total size for resize operation"),l=null,void(d=()=>{});let c=null;const p=75;let f=.5;const h=t=>{const r=.1;if(t.some((e=>e<r))){console.warn("Invalid sizes detected, adjusting to minimum values");const a=t.map((e=>Math.max(e,r))),n=a.reduce(((e,t)=>e+t),0),o=a.map((e=>e/n));wt.getState().setRowSizes({rowId:e.id,sizes:o})}else wt.getState().setRowSizes({rowId:e.id,sizes:t})},y=e=>{null!==c&&clearTimeout(c),c=setTimeout((()=>{c=null,h(e)}),p)},g=()=>{null!==c&&(clearTimeout(c),c=null)};l=s=>{const c=u();if(!c)return;const l=c.layout,d=l[e.id],p=c.rootId;if(!d||!p||"area_row"!==d.type)return void console.warn("Resize handler: Row or rootId not found/invalid in current active screen state.");const h=Me(l,p,be()),g=h[n],m=h[o];if(!g||!m)return void console.warn("Resize handler: Viewports for adjacent areas not found.");const v=a?{left:g.left,top:g.top,width:g.width+m.width,height:g.height}:{left:g.left,top:g.top,width:g.width,height:g.height+m.height},w=a?v.width:v.height;if(w<=0)return void console.warn("Resize handler: Shared viewport size is zero or negative.");const S=Math.max(.1,ge/w),b=a?v.left:v.top,I=b+w,x=a?s.x:s.y,A=Ae(S,1-S,(x-b)/(I-b));f=A,r({rowId:e.id,separatorIndex:t,t:A});const _=A*i,E=(1-A)*i,k=d.areas.map(((e,r)=>r===t-1?_:r===t?E:e.size)),O=.1;if(k.some((e=>e<O))){console.warn("Invalid sizes detected in preview, adjusting to minimum values");const e=k.map((e=>Math.max(e,O))),t=e.reduce(((e,t)=>e+t),0),r=e.map((e=>e/t));y(r)}else{const e=k.reduce(((e,t)=>e+t),0);if(e>0){const t=k.map((t=>t/e));y(t)}else console.warn("Resize handler: Debounce skipped, zero total size.")}},d=()=>{g();const a=f*i,n=(1-f)*i,o=u()?.layout[e.id];if(!o||"area_row"!==o.type)return console.error("Resize mouseup: Cannot find final row state."),r(null),l=null,void(d=null);const s=o.areas.map(((e,r)=>r===t-1?a:r===t?n:e.size)),c=s.reduce(((e,t)=>e+t),0);let p=s;if(c>0)p=s.map((e=>e/c));else{console.error("Resize mouseup: Final total size is zero, cannot normalize. Using equal distribution as fallback.");const e=o.areas.length;p=Array(e).fill(1/e)}h(p),setTimeout((()=>r(null)),0),l=null,d=null}}(t,p,n),l&&l(c)}),0)}function m(){const e=y?f[y]:null;if(!e||"area_row"!==e.type)return console.error("Join/Move setup: Source area does not have a valid parent row. Cannot determine siblings."),l=null,void(d=()=>{wt.getState().setJoinPreview(null)});const t=e.areas.findIndex((e=>e.id===r));if(-1===t)return console.error(`Join/Move setup: Source area ${r} not found within its supposed parent row ${y}.`),l=null,void(d=()=>{wt.getState().setJoinPreview(null)});const a=e.areas.filter(((e,r)=>r!==t)).map((e=>e.id)),n=[t>0?e.areas[t-1].id:null,t<e.areas.length-1?e.areas[t+1].id:null].filter((e=>null!==e));l=t=>{const o=u();if(!o)return;const s=o.layout,i=o.rootId;if(!i)return;const c=Me(s,i,be());let l=null,d=null;for(const a of n){const n=c[a];if(n&&t.x>=n.left&&t.x<=n.left+n.width&&t.y>=n.top&&t.y<=n.top+n.height){l=a;const t=c[r];if(t){const r=n,a=r.left+r.width/2-(t.left+t.width/2),o=r.top+r.height/2-(t.top+t.height/2);d="horizontal"===e.orientation?a>0?"e":"w":o>0?"s":"n"}break}}l&&d?wt.getState().setJoinPreview({areaId:l,movingInDirection:d,eligibleAreaIds:a}):null!==u()?.joinPreview&&wt.getState().setJoinPreview(null)},d=()=>{const e=u(),t=e?.joinPreview;t&&t.areaId&&t.movingInDirection&&n.includes(t.areaId)&&wt.getState().joinOrMoveArea({sourceAreaId:r,targetAreaId:t.areaId,direction:t.movingInDirection}),null!==u()?.joinPreview&&wt.getState().setJoinPreview(null),l=null,d=null}}let v=!1;const w=e=>{const r=new Ee(e.x-i.x,e.y-i.y);if(r.length()<10)return;window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",b);const a=function(e,t){const r=Math.abs(t.x),a=Math.abs(t.y),n=a>r;if(r>a)switch(e){case"ne":case"se":return t.x<0;case"nw":case"sw":return t.x>0}else if(n)switch(e){case"ne":case"nw":return t.y>0;case"se":case"sw":return t.y<0}switch(e){case"ne":return t.x<0&&t.y>0;case"nw":return t.x>0&&t.y>0;case"se":return t.x<0&&t.y<0;case"sw":return t.x>0&&t.y<0;default:return console.warn("Unknown corner direction in determineIfMovingInwards:",e),!1}}(t,r),n=Math.abs(r.x),o=Math.abs(r.y);a?g(n>o):m(),v=!0,l&&l(e)},S=e=>{const t=Ee.fromEvent(e);c=t,v?l&&l(t):w(t)},b=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",b),v?d?d():console.warn("Mouse up, direction determined but no final handler set."):null!==u()?.joinPreview&&wt.getState().setJoinPreview(null)};document.addEventListener("mousemove",S),document.addEventListener("mouseup",b)},nr=({viewport:t,error:r})=>{const{t:a}=Qt();return e.jsxs("div",{style:{position:"absolute",left:t.left,top:t.top,width:t.width,height:t.height,backgroundColor:"#fff5f5",border:"1px solid #feb2b2",borderRadius:"4px",padding:"16px",color:"#c53030"},children:[e.jsx("h3",{children:a("area.error.title","An error occurred in the area")}),e.jsx("p",{children:r?.message})]})};class or extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Area error:",e,t)}render(){if(this.state.hasError)return e.jsx(nr,{viewport:this.props.viewport,error:this.state.error});const t=this.props.component;return e.jsx(t,{id:this.props.areaId,state:this.props.areaState,type:this.props.type,viewport:this.props.viewport,Component:t})}}const sr=()=>{const e=It((e=>e.isVisible)),r=It((e=>e.position)),a=It((e=>e.openContextMenu)),n=It((e=>e.closeContextMenu));return{isVisible:e,position:r,open:t.useCallback((e=>{a(e)}),[a]),close:t.useCallback((()=>{n()}),[n])}};const ir=()=>{const{t:t}=Qt(),{screens:r,activeScreenId:a,switchScreen:n,addScreen:o,removeScreen:s,duplicateScreen:i}={screens:wt((e=>e.screens)),activeScreenId:wt((e=>e.activeScreenId)),switchScreen:wt((e=>e.switchScreen)),addScreen:wt((e=>e.addScreen)),removeScreen:wt((e=>e.removeScreen)),duplicateScreen:wt((e=>e.duplicateScreen))},{open:c}=sr();Yt("open-new-window",(e=>{e?.screenId&&window.open(`?screen=${e.screenId}`,"_blank","noopener,noreferrer")})),Yt("open-new-tab",(e=>{e?.screenId&&window.open(`?screen=${e.screenId}`,"_blank")})),Yt("delete-screen",(e=>{e?.screenId&&(Object.keys(r).length>1?s(e.screenId):console.warn("Cannot remove the last screen"))})),Yt("duplicate-screen",(e=>{e?.screenId&&i(e.screenId)})),Yt("add-screen",(()=>{o()}));const l=Object.keys(r).filter((e=>!r[e]?.isDetached)).sort(((e,t)=>parseInt(e)-parseInt(t)));return e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"5px",padding:"0 10px"},children:l.map(((o,s)=>e.jsx("button",{onClick:()=>n(o),onContextMenu:e=>((e,a)=>{e.preventDefault(),c({position:{x:e.clientX,y:e.clientY},menuClassName:"screen-switcher-menu",items:[{id:"add",label:t("screen.menu.add","Add"),icon:qt,actionId:"add-screen",metadata:{}},{id:"duplicate",label:t("screen.menu.duplicate","Duplicate"),icon:Rt,actionId:"duplicate-screen",metadata:{screenId:a}},{id:"open-new-window",label:t("screen.menu.openNewWindow","Open in new window"),icon:Ct,actionId:"open-new-window",metadata:{screenId:a}},{id:"open-new-tab",label:t("screen.menu.openNewTab","Open in new tab"),icon:$t,actionId:"open-new-tab",metadata:{screenId:a}},{id:"delete",label:t("screen.menu.delete","Delete"),icon:Gt,actionId:"delete-screen",metadata:{screenId:a},disabled:Object.keys(r).length<=1}],targetId:a})})(e,o),title:t("screen.switch",`Switch to screen ${s+1}`),style:{padding:"2px 8px",border:"1px solid #555",borderRadius:"3px",background:a===o?"#444":"#2a2a2a",color:a===o?"#eee":"#aaa",cursor:"pointer",minWidth:"25px",textAlign:"center"},disabled:a===o,children:s+1},o)))})},cr={},lr=new Set;function dr(e){["top-outer","top-inner","bottom-outer","bottom-inner"].forEach((t=>{const r=`${e}:${t}`;cr[r]&&delete cr[r]})),lr.forEach((e=>e()))}const ur=new Set;function pr(e,r){const a=`${e}:${r}`;return{registerComponent:t.useCallback(((e,t,r={})=>{const{order:n=0,alignment:o="left",width:s,allowedLayerTypes:i,callback:c}=r;cr[a]?cr[a]=cr[a].filter((e=>!(e.identifier.name===t.name&&e.identifier.type===t.type))):cr[a]=[];const l=Math.random().toString(36).substr(2,9);return cr[a].push({component:e,order:n,alignment:o,width:s,identifier:t,allowedLayerTypes:i,callback:c}),cr[a].sort(((e,t)=>e.order-t.order)),ur.forEach((e=>e())),l}),[a]),getComponents:t.useCallback((()=>cr[a]||[]),[a])}}function fr(){const[,e]=t.useReducer((e=>e+1),0);t.useEffect((()=>{return t=e,lr.add(t),()=>{lr.delete(t)};var t}),[])}const hr=({areaId:r,areaType:a="app",areaState:n={},children:o,viewport:s={top:0,left:0,width:"100%",height:"100%"}})=>{fr(),t.useEffect((()=>ut.subscribe((e=>{"cleanup"===e.type&&dr(e.areaId)}))),[]);const i=(...e)=>{const t=new Map;return e.flat().forEach((e=>{const r=`${e.identifier.name}:${e.identifier.type}`;t.has(r)||t.set(r,e)})),Array.from(t.values()).sort(((e,t)=>e.order-t.order))},{getComponents:c}=pr(r||"","top-outer"),{getComponents:l}=pr(a,"top-outer"),d=i(c(),l()),{getComponents:u}=pr(r||"","bottom-outer"),{getComponents:p}=pr(a,"bottom-outer"),f=i(u(),p()),{getComponents:h}=pr(r||"","top-inner"),{getComponents:y}=pr(a,"top-inner"),g=i(h(),y()),{getComponents:m}=pr(r||"","bottom-inner"),{getComponents:v}=pr(a,"bottom-inner"),w=i(m(),v()),{handleFocus:S}=(e=>{const r=wt((e=>e.activeScreenId)),a=wt((e=>e.screens[r]?.isDetached))||!1,n=wt((e=>e.options.multiScreen))||!1,o=wt((t=>{const r=t.screens[t.activeScreenId]?.areas;if(r)return e?Object.values(r.areas).find((t=>t.id===e)):void 0})),s=o?.spaceId,i=t.useCallback((()=>{s&&dt.getState().setActiveSpace(s)}),[s]);return{activeScreenId:r,isDetached:a,multiScreen:n,currentArea:o,currentSpaceId:s,handleFocus:i,isFullscreen:o?.enableFullscreen??!1}})(r),{isDetached:b,multiScreen:I}=(()=>{const e=wt((e=>e.activeScreenId)),t=wt((t=>t.screens[e]?.isDetached))||!1,r=wt((e=>e.options.multiScreen))||!1;return{activeScreenId:e,isDetached:t,multiScreen:r}})(),x=d.length>0,A=f.length>0,_=g.length>0,E=w.length>0,k=x?ye:0,O=A?ye:0,z=(t,r)=>{const o=t.filter((e=>"left"===e.alignment)),s=t.filter((e=>"center"===e.alignment)),i=t.filter((e=>"right"===e.alignment));return 0===o.length&&0===s.length&&0===i.length?null:r.includes("inner")||!b&&r.includes("outer")?e.jsxs("div",{className:`tools-bar tools-bar-${r}`,style:{height:ye,minHeight:ye,position:r.includes("outer")?"absolute":"relative",left:0,right:0,...r.includes("bottom")?{bottom:0}:{top:0}},onFocusCapture:S,tabIndex:0,"data-testid":`tools-bar-${r}`,children:[e.jsx("div",{className:"tools-bar-section tools-bar-section--left",style:{display:o.length>0?"flex":"none"},children:o.map(((t,r)=>{const a=t.component;return e.jsx(a,{areaState:n,onFocusCapture:S},`${t.identifier.type}-${t.identifier.name}-${r}`)}))}),e.jsx("div",{className:"tools-bar-section tools-bar-section--center",style:{display:s.length>0?"flex":"none"},children:s.map(((t,r)=>{const a=t.component;return e.jsx(a,{areaState:n,onFocusCapture:S},`${t.identifier.type}-${t.identifier.name}-${r}`)}))}),e.jsxs("div",{className:"tools-bar-section tools-bar-section--right",style:{display:i.length>0?"flex":"none"},children:[i.map(((t,r)=>{const a=t.component;return e.jsx(a,{areaState:n,onFocusCapture:S},`${t.identifier.type}-${t.identifier.name}-${r}`)})),I&&"app"===a&&"bottom-outer"===r&&e.jsx(ir,{})]})]}):null};return e.jsxs("div",{className:"tools-container",style:{position:"relative",width:s.width,height:b?"100%":"calc(100%)",overflow:"hidden"},"data-testid":"tools-container",children:[e.jsx("div",{className:"tools-content",style:{position:"absolute",top:k,left:0,right:0,bottom:O,overflow:"hidden",display:"flex",flexDirection:"column"},"data-testid":"tools-content",children:e.jsx("div",{style:{flex:1,overflow:"hidden"},children:o})}),x&&z(d,"top-outer"),A&&z(f,"bottom-outer"),_&&z(g,"top-inner"),E&&z(w,"bottom-inner")]})},yr=({id:r,Component:a,state:n,type:o,viewport:s,raised:i,isChildOfStack:c=!1,setResizePreview:l})=>{s||(console.warn(`No viewport found for area ${r}, using default viewport`),s={left:0,top:0,width:100,height:100});const d=wt((e=>e.screens[e.activeScreenId]?.areas.activeAreaId===r)),u=wt((e=>e.setActiveArea)),p=t.useRef(null),f=wt((e=>e.getAreaById(r))),h=dt((e=>e.setActiveSpace)),y=dt((e=>e.activeSpaceId)),g=dt((e=>e.pilotMode)),m=dt((e=>e.spaces)),v=wt((e=>e.options?.resizableAreas??!0)),w=wt((e=>e.options?.manageableAreas??!0));t.useEffect((()=>{if(y)if("AUTO"===g&&f?.role===He.FOLLOW){const e=wt.getState().activeScreenId,t=wt.getState().screens[e]?.areas.lastLeadAreaId,r=wt.getState().screens[e]?.areas.areas||{},a=t?r[t]:null;a&&a.spaceId===y&&u(a.id)}else"MANUAL"===g&&f?.spaceId!==y&&wt.getState().updateArea({id:r,spaceId:y})}),[y,f?.role,g]);const S=wt((e=>e.activeScreenId)),b=wt((e=>e.screens[S]?.isDetached))||!1;return e.jsxs(ke.Provider,{value:r,children:[!b&&!c&&e.jsx(tr,{id:r,state:n,type:o}),e.jsx(hr,{areaId:r,areaType:o,areaState:n,viewport:s,children:e.jsxs("div",{ref:p,"data-areaid":r,"data-testid":`area-${r}`,"data-testid-resize-handle":`area-${r}-resize-handle`,className:"area "+(i?"active":""),style:{width:"100%",height:b||f?.enableFullscreen?"100%":`calc(${"string"==typeof s.height?s.height:s.height+"px"} - 30px)`},onClick:()=>{if(!d&&(u(r),f?.role===He.LEAD&&"MANUAL"!==g))if(f.spaceId)h(f.spaceId);else{const e=Object.keys(m);if(e.length>0){const t=y||e[0];wt.getState().updateArea({id:r,spaceId:t}),h(t)}else{const e=dt.getState().addSpace({name:`Space for ${f.type}`,sharedState:{}});e&&(wt.getState().updateArea({id:r,spaceId:e}),h(e))}}},children:[!b&&!c&&v&&w&&["ne","nw","se","sw"].map((t=>e.jsx("div",{className:`area__corner area__corner--${t}`,"data-testid":`area-${r}-resize-handle`,onMouseDown:e=>ar(e.nativeEvent,t,r,s,l)},t))),e.jsx("div",{className:`area-main-content-wrapper ${o}`,"data-areatype":o,"data-testid":`area-${r}-role-button`,style:{opacity:d?1:.9,height:"100%",width:f?.enableFullscreen?"100vw":"100%",top:f?.enableFullscreen?0:"auto",left:f?.enableFullscreen?0:"auto",zIndex:f?.enableFullscreen?9999:"auto",overflow:"hidden"},children:a?e.jsx(or,{component:a,areaId:r,areaState:n,type:o,viewport:{left:0,top:0,width:f?.enableFullscreen?window.innerWidth:s.width,height:f?.enableFullscreen?window.innerHeight:s.height-(b?0:ye)}}):e.jsxs("div",{style:{position:"absolute",left:0,top:0,width:f?.enableFullscreen?window.innerWidth:s.width,height:f?.enableFullscreen?window.innerHeight:s.height-(b?0:ye),backgroundColor:"#fff5f5",border:"1px solid #feb2b2",borderRadius:"4px",padding:"16px",color:"#c53030"},children:[e.jsxs("h3",{children:["Invalid area type: ",o]}),e.jsx("p",{children:"This area type is not registered in the area registry."})]})})]})})]})},gr=t.memo((({id:r,layout:a,areas:n,viewport:o,setResizePreview:s})=>{const i=a.activeTabId||a.areas[0]?.id,c=i?n[i]:null,[l,d]=t.useState(!1);t.useEffect((()=>{if(c?.type){const e=()=>{Ke.getComponent(c.type)?d(!0):setTimeout(e,25)};e()}}),[c?.type]);const u=c?.type?Ke.getComponent(c.type):null;return u&&l?e.jsxs("div",{className:"area-stack",style:{left:o.left,top:o.top,width:o.width,height:o.height+ye},"data-areaid":r,children:[e.jsx(rr,{rowId:a.id,row:a,areas:n}),e.jsx("div",{className:"area-stack__content",children:e.jsx(yr,{isChildOfStack:!0,id:i,Component:u,state:c?.state,type:c?.type||"",viewport:{left:0,top:0,width:o.width,height:o.height},setResizePreview:s,raised:!!c?.raised})})]}):null})),mr=t.memo((({areaToOpen:t,dimensions:r})=>{const{t:a}=Qt(),n=Ke.getComponent(t.area.type);return n?e.jsxs("div",{className:"area-preview",style:{left:t.position.x,top:t.position.y},children:[e.jsx(yr,{id:"-1",Component:n,raised:!0,isChildOfStack:!1,state:t.area.state,type:t.area.type,viewport:{left:0,top:0,height:r.y,width:r.x},setResizePreview:()=>{}}),e.jsx("div",{className:"area-preview-content",children:a(`area.preview.${t.area.type}`,`Preview of ${t.area.type}`)})]}):null})),vr=t.memo((({id:r,viewport:a,setResizePreview:n})=>{const o=wt((e=>e.getAreaById(r))),s=wt((e=>e.screens[e.activeScreenId]?.areas.layout[r])),i=wt((e=>e.screens[e.activeScreenId]?.areas.areas)),c=wt((e=>e.activeScreenId)),l=wt((e=>e.screens[c]?.isDetached))||!1,d="area_row"===s?.type,u=d?s:null,p=d&&"stack"===u.orientation,f=d&&!p,h=o?.type?Ke.getComponent(o.type):null;let y=r,g=o,m=h;p&&(u.activeTabId?(y=u.activeTabId,g=i?.[y],m=g?.type?Ke.getComponent(g.type):null):(g=void 0,m=null));const{getComponents:v}=pr(g?.type||"","top-outer"),{getComponents:w}=pr(g?.type||"","bottom-outer"),S=v(),b=w(),I=S.length>0,x=b.length>0,A=I?ye:0,_=x?ye:0,E=t.useMemo((()=>l?a:{...a,top:a.top+A,height:a.height-A-_}),[a,l,A,_]),k=t.useMemo((()=>({position:"absolute",left:E.left,top:E.top,width:E.width,height:E.height,display:"flex",flexDirection:f&&"horizontal"===u?.orientation?"row":"column"})),[E,f,u?.orientation]),O=t.useMemo((()=>({left:0,top:0,width:E.width,height:E.height})),[E]);return(!r.includes("row-")||p)&&"root"!==r&&e.jsxs("div",{className:"area-container "+r,style:k,"data-areaid":r,"data-testid":`area-${r}`,"data-areatype":p?"stack-row":f?`${u?.orientation}-row`:o?.type||"unknown-leaf",children:[p&&u&&e.jsx(gr,{id:r,areas:i,layout:u,viewport:O,setResizePreview:n}),!d&&m&&g&&e.jsx(yr,{id:g.id,Component:m,state:g.state,type:g.type,viewport:O,raised:!!g.raised,setResizePreview:n,isChildOfStack:!1})]})}));const wr=(e,t,r,a)=>{const n=wt.getState().screens[wt.getState().activeScreenId]?.areas.isDetached;if(n)return;if(!e||!e.areas||0===e.areas.length)return void console.error("Invalid row data for resize");if(r<1||r>=e.areas.length)return void console.error("Invalid areaIndex for resize:",{areaIndex:r,areasLength:e.areas.length});const o=wt.getState(),s=o.activeScreenId,i=o.screens[s]?.areas;if(!i||!i.layout||!i.rootId)return void console.error("Invalid active screen area state for resize:",i);const c=i.layout,l=i.rootId,d=Oe(l,c),u=be();if(!u)return void console.error("Unable to get root viewport");const p=Me(c,l,u),f=e.areas[r-1],h=e.areas[r];if(!f||!h)return void console.error("Invalid area indices:",{areaIndex:r,areas:e.areas});let y=p[f.id],g=p[h.id];if(!y||!g)return void console.error("Missing initial viewports:",{a0:f.id,a1:h.id,viewports:p});const m=e=>{const r=c[e];if(!r)return 1;if("area"===r.type)return 1;const a=d[r.id];return t?a?.width??1:a?.height??1},v=m(f.id),w=m(h.id);let S=f.size+h.size;(isNaN(S)||S<=0)&&(S=1);const b={width:t?y.width+g.width:y.width,height:t?y.height:y.height+g.height,left:y.left,top:y.top},I=t?b.width:b.height;if(I<=0)return void console.error("Invalid viewport size:",I);const x=ge*v/I,A=ge*w/I;if(x+A>=.99)return void console.warn("Not enough space to resize:",{tMin0:x,tMin1:A});let _=0;let E=null,k=null;const O=t=>{const r=performance.now();r-_<16||(_=r,wt.getState().setRowSizes({rowId:e.id,sizes:t}))},z=()=>{k&&(n=>{if(!k)return void(k=n);const o=t?b.left:b.top,s=t?b.left+b.width:b.top+b.height,i=t?n.x:n.y,l=Ae(x,1-A,(i-o)/(s-o));a({rowId:e.id,separatorIndex:r,t:l});const d=[l,1-l].map((e=>xe(0,S,e)));if(!d.some((e=>isNaN(e)||e<0))){const t=e.areas.map(((t,a)=>{if(a===r-1)return d[0];if(a===r)return d[1];const n=c[e.id];return n?.areas?.[a]?.size||0})),a=t.reduce(((e,t)=>e+t),0);if(a>0&&Math.abs(a-1)>.001){const e=t.map((e=>e/a));O(e)}else O(t)}})(k),E=requestAnimationFrame(z)};!function(e,t){document.body.style.userSelect="none";const r=t=>{e(t)},a=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),document.body.style.userSelect="",t()};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}((e=>{(e=>{k=e,E||(E=requestAnimationFrame(z))})(Ee.fromEvent(e))}),(()=>{null!==E&&(cancelAnimationFrame(E),E=null),k=null,setTimeout((()=>a(null)),0)}))},Sr=t=>{const{row:r,setResizePreview:a,offset:n}=t,o=wt((e=>e.screens[e.activeScreenId]?.areas.layout??{})),s=wt((e=>e.screens[e.activeScreenId]?.areas.rootId)),i=wt((e=>e.screens[e.activeScreenId]?.areas.viewports)),c=wt((e=>e.options?.resizableAreas??!0)),{t:l}=Qt();if("stack"===r.orientation)return null;if(!r||!r.areas||r.areas.length<=1||!o||!s)return null;if(!r.areas.every((e=>i[e.id]&&o[e.id])))return null;const d=[];for(let t=0;t<r.areas.length-1;t++){const s=r.areas[t],u=r.areas[t+1];if(!s||!u)continue;const p=i[s.id],f=i[u.id];if(!(o[s.id]&&o[u.id]&&p&&f))continue;const h="horizontal"===r.orientation;let y;if(y=h?{left:f.left-5,top:f.top+ye-n,width:10,height:Math.max(f.height-ye,5)}:{left:f.left,top:f.top-5-n,width:Math.max(f.width,5),height:10},isNaN(y.left)||isNaN(y.top)||isNaN(y.width)||isNaN(y.height))continue;y.width=Math.max(0,y.width),y.height=Math.max(0,y.height);const g=e=>{e.stopPropagation(),wr(r,h,t+1,a)};d.push(e.jsx("div",{className:"area-separator "+(h?"area-separator--horizontal":""),style:{...y,flexDirection:h?"column":"row",zIndex:h?2001:2e3,cursor:c?void 0:"default"},onMouseDown:c?g:void 0,title:l("area.separator.resize","Resize"),children:c&&(h?e.jsxs(e.Fragment,{children:[e.jsx(Lt,{size:32}),e.jsx(Lt,{size:32})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{size:32}),e.jsx(Nt,{size:32})]}))},`sep-${s.id}-${u.id}`))}return e.jsx(e.Fragment,{children:d})},br=t.memo((({dimensions:r,setAreaToOpenDimensions:a})=>{const n=wt((e=>e.setViewports)),o=wt((e=>e.screens[e.activeScreenId]?.areas.viewports)),{handleDragOver:s,handleDrop:i,areaToOpenTargetId:c,areaToOpenTargetViewport:l,calculatedPlacement:d}=Et();t.useEffect((()=>{if(!c||!l)return;const e=Ee.new(l.width,l.height);e.x===r.x&&e.y===r.y||a(e)}),[c,l,r,a]),t.useEffect((()=>{n(o)}),[o,n]);const u=t.useMemo((()=>{if(!l)return{lines:[],placementLines:{}};const e=l,t=.25*Math.min(e.width,e.height),r=Ee.new(t,t),a=e.width,n=e.height,o=Ee.new(0,0),s=Ee.new(a,0),i=Ee.new(a,n),c=Ee.new(0,n),d=o.add(r),u=s.add(r.scaleX(-1)),p=i.add(r.scale(-1)),f=c.add(r.scaleY(-1));return{lines:[[o,d],[s,u],[c,f],[i,p],[d,u],[u,p],[p,f],[f,d]],placementLines:{left:[o,d,f,c],top:[o,s,u,d],right:[u,s,i,p],bottom:[c,f,p,i],stack:[d,u,p,f]}}}),[l]),p=t.useMemo((()=>{if(!l||!u.placementLines||!u.placementLines[d])return"";return u.placementLines[d].map((e=>[e.x,e.y].join(","))).map(((e,t)=>[0===t?"M":"L",e].join(" "))).join(" ")+" Z"}),[l,u.placementLines,d]);return l?e.jsx("div",{className:"area-to-open-overlay",onDragOver:s,onDrop:i,children:l&&e.jsxs("svg",{width:l.width,height:l.height,className:"area-to-open-overlay__placement",style:{left:l.left,top:l.top},children:[u.lines.map((([t,r],a)=>e.jsx("line",{x1:t.x,y1:t.y,x2:r.x,y2:r.y},a))),e.jsx("path",{d:p})]})}):null})),Ir=t.memo((()=>{const r=wt((e=>e.screens[e.activeScreenId]?.areas.areaToOpen)),a=t.useMemo((()=>Ee.new(100,100)),[]),[n,o]=t.useState(a);return r?e.jsxs(e.Fragment,{children:[e.jsx(mr,{areaToOpen:r,dimensions:n}),e.jsx(br,{areaToOpen:r,dimensions:n,setAreaToOpenDimensions:o})]}):null})),xr=t=>{const{viewport:r,movingInDirection:a}=t,{t:n}=Qt(),o=Math.min(256,5*Math.min(r.width,r.height));return e.jsxs("div",{className:"join-area-preview",style:{left:r.left,top:r.top,width:r.width,height:r.height},children:[e.jsx("div",{className:`join-area-preview__arrow-container join-area-preview__arrow-container--${a}`,children:e.jsx("div",{className:`join-area-preview__arrow join-area-preview__arrow--${a}`,style:{width:o,height:o},children:e.jsx(Tt,{size:o+"px",style:{color:"transparent"}})})}),e.jsx("div",{className:"join-area-preview-content",children:n("area.join.preview","Join areas")})]})},Ar=()=>{const a=It((e=>e.isVisible&&"default"===e.menuType)),n=It((e=>e.items)),o=It((e=>e.position)),s=It((e=>e.closeContextMenu)),i=It((e=>e.metadata)),c=It((e=>e.menuClassName)),{t:l}=Qt(),d=(a,n)=>a.map((a=>a.children&&a.children.length>0?e.jsx(r.SubMenu,{label:l(`menu.${a.id}.label`,a.label),disabled:a.disabled,children:d(a.children,n)},a.id):"area.separator"===a.actionId||a.label.match(/^[-\u2500]+$/)?e.jsx("div",{style:{margin:"4px 0",borderBottom:"1px solid #ccc"}},a.id):e.jsxs(r.MenuItem,{disabled:a.disabled,onClick:()=>n(a.actionId,a.metadata,a),children:[a.icon&&t.createElement(a.icon),l(`menu.${a.id}.label`,a.label)]},a.id)));return a?e.jsx(r.ControlledMenu,{anchorPoint:o,state:a?"open":"closed",onClose:s,transition:!0,direction:"right",menuClassName:c,children:d(n,((e,t)=>{At.executeAction(e,{...i,...t}),s&&s()}))}):null},_r=({children:t})=>e.jsxs(e.Fragment,{children:[t,e.jsx(Ar,{}),e.jsx(er,{})]});function Er(){const e=wt((e=>e.activeScreenId)),r=wt((t=>t.screens[e]?.isDetached)),a=wt((e=>e.removeScreen));return t.useEffect((()=>{if(!r)return;const t=()=>{a(e)};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)}),[e,r,a]),null}const kr=x((e=>({entries:[],addEntry:t=>e((e=>({entries:[...e.entries,t]}))),clearHistory:()=>e({entries:[]})}))),Or={id:"history",priority:exports.ActionPriority.HIGH,actionTypes:["area/addArea","area/removeArea","area/updateArea","area/moveArea","area/resizeArea","composition/update","composition/addElement","composition/removeElement","composition/updateElement","project/update","draw/addLine","draw/updateLine","draw/removeLine","draw/updateStrokeWidth","draw/updateColor","draw/updateZoom","draw/updatePan","draw/clearCanvas"],handler:e=>{const{type:t,payload:r}=e,a={id:`${t}-${Date.now()}`,type:t,payload:r,timestamp:Date.now(),description:zr(t,r)};kr.getState().addEntry(a)}};function zr(e,t){const{t:r}=Qt();switch(e){case"area/addArea":return r("action.area.add",`Add area ${t.type||""}`);case"area/removeArea":return r("action.area.remove","Remove area");case"area/updateArea":return r("action.area.update","Update area");case"area/moveArea":return r("action.area.move","Move area");case"area/resizeArea":return r("action.area.resize","Resize area");case"composition/addElement":return r("action.composition.add",`Add element ${t.elementType||""}`);case"composition/removeElement":return r("action.composition.remove","Remove element");case"composition/updateElement":return r("action.composition.update","Update element");case"draw/addLine":return r("action.draw.addLine","Add line");case"draw/updateLine":return r("action.draw.updateLine","Edit line");case"draw/removeLine":return r("action.draw.removeLine","Remove line");case"draw/updateStrokeWidth":return r("action.draw.updateStrokeWidth",`Change stroke width: ${t.oldValue} → ${t.newValue}`);case"draw/updateColor":return r("action.draw.updateColor",`Change color: ${t.oldValue} → ${t.newValue}`);case"draw/clearCanvas":return r("action.draw.clearCanvas","Clear drawing");default:return r("action.unknown",`Action ${e}`)}}function jr(){const{addArea:e,removeArea:r,setActiveArea:a,updateArea:n,getActiveArea:o,getAreaById:s,getAllAreas:i,getAreaErrors:c}=wt();return{createArea:t.useCallback(((t,r,a,n)=>{if(!Ke.getRegisteredTypes().has(t))throw new Error(`Invalid area type: ${t}`);const o={id:n||"",type:t,state:r,position:a};if((Ke._roleMap||{})[t]===He.LEAD){const e=dt.getState().spaces,r=Object.keys(e);if(r.length>0){const e=dt.getState().activeSpaceId;o.spaceId=e||r[0]}else{const e=dt.getState().addSpace({name:`Space for ${t}`,sharedState:{}});e&&(o.spaceId=e)}}return e(o)}),[e]),removeArea:t.useCallback((e=>{r(e)}),[r]),setActive:t.useCallback((e=>{a(e)}),[a]),update:t.useCallback(((e,t)=>{n({id:e,...t})}),[n]),getActive:t.useCallback((()=>o()),[o]),getById:t.useCallback((e=>s(e)),[s]),getAll:t.useCallback((()=>i()),[i]),getErrors:t.useCallback((()=>c()),[c])}}const Dr=({options:r={},children:a,onError:n})=>{const o=t.useRef(!1),{createArea:s}=jr();return t.useEffect((()=>{if(!o.current){o.current=!0;try{const e=[Or],t=r.plugins||[],a=[...e,...t],o=[];a.forEach((e=>{e&&"object"==typeof e&&e.id&&(At.registerPlugin(e),o.push(e.id))})),r.validators&&r.validators.forEach((({actionType:e,validator:t})=>{e&&"function"==typeof t&&At.registerValidator(e,t)}));const i=wt.getState(),c=i.activeScreenId,l=i.screens[c]?.areas;if(!(l?.rootId||Object.keys(l?.areas||{}).length>0)){const e=r.initialAreas||[],t=[];if(e.forEach(((e,r)=>{if(!e||"object"!=typeof e){const e=new Error(`Invalid area config at index ${r}`);return console.error("[KarmycInitializer] Invalid area config",e),void n?.(e)}if(!e.type||"string"!=typeof e.type){const e=new Error(`Invalid area type for area at index ${r}`);return console.error("[KarmycInitializer] Invalid area config",e),void n?.(e)}const a=Je(e);if(!a.isValid){const e=new Error(`Invalid area configuration: ${a.errors.join(", ")}`);return console.error("[KarmycInitializer] Invalid area config",e),void n?.(e)}let o;try{o=s(e.type,e.state||{},void 0,e.id)}catch(e){return console.error("[KarmycInitializer] Invalid area config",e),void n?.(e instanceof Error?e:new Error(String(e)))}if(o)t.push(o);else{const e=new Error(`Failed to create area at index ${r}`);console.error("[KarmycInitializer] Invalid area config",e),n?.(e)}})),t.length>0){const e={id:"root",type:"area_row",orientation:"horizontal",areas:t.map((e=>({id:e,size:1/t.length})))};wt.setState((r=>{if(!r.screens[r.activeScreenId]?.areas){const e=new Error(`Active screen areas ${r.activeScreenId} not found during layout update.`);return n?.(e),r}const a={...r.screens[r.activeScreenId].areas.layout||{},root:e,...t.reduce(((e,t)=>(e[t]||(e[t]={type:"area",id:t}),e)),{})};return{...r,screens:{...r.screens,[r.activeScreenId]:{...r.screens[r.activeScreenId],areas:{...r.screens[r.activeScreenId].areas,rootId:"root",layout:a}}}}}),!1,"KarmycInitializer/setDefaultLayout")}}}catch(e){console.error("[KarmycInitializer] Invalid area config",e),n?.(e instanceof Error?e:new Error(String(e)))}return()=>{try{const e=wt.getState().options;(e.plugins||[]).map((e=>e.id)).forEach((e=>{e&&At.unregisterPlugin(e)}))}catch(e){console.error("[KarmycInitializer] Error during cleanup:",e),n?.(e instanceof Error?e:new Error(String(e)))}}}}),[n]),e.jsx(e.Fragment,{children:a})},Mr=new Map,Cr=new Map;const Tr=(e,t)=>{Mr.set(e,t)},Rr=e=>Mr.get(e)||[],Lr=e=>{Mr.delete(e)},Nr=()=>{const e=[];for(const t of Mr.values())e.push(...t);for(const t of Cr.values())e.push(t);return e};const $r=t.createContext({options:{}}),Pr=e=>e.screens[e.activeScreenId]?.areas;function Fr(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,a]of e)if(!Object.is(a,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const a of r)if(!Object.prototype.hasOwnProperty.call(t,a)||!Object.is(e[a],t[a]))return!1;return!0}const{useDebugValue:Vr}=t,{useSyncExternalStoreWithSelector:Ur}=m,Hr=e=>e;function Br(e,t=Hr,r){const a=Ur(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return Vr(a),a}function Kr(){const e=Br(dt,(e=>e.spaces),Fr),r=Br(dt,(e=>e.activeSpaceId),Fr),a=Br(dt,(e=>e.openSpaceIds),Fr),n=Br(dt,(e=>e.pilotMode),Fr),o=dt((e=>e.addSpace)),s=dt((e=>e.removeSpace)),i=dt((e=>e.setActiveSpace)),c=dt((e=>e.openSpace)),l=dt((e=>e.closeSpace)),d=dt((e=>e.updateSpace)),u=dt((e=>e.updateSpaceGenericSharedState)),p=t.useMemo((()=>Object.entries(e).map((([e,t])=>({id:e,name:t.name})))),[e]),f=t.useMemo((()=>a.map((t=>e[t])).filter((e=>void 0!==e))),[e,a]),h=t.useCallback(((e,t={})=>o({name:e,sharedState:t})),[o]),y=t.useCallback((e=>{s(e)}),[s]),g=t.useCallback((e=>{i(e)}),[i]),m=t.useCallback((e=>{c(e)}),[c]),v=t.useCallback((e=>{l(e)}),[l]),w=t.useCallback(((e,t)=>{u({spaceId:e,changes:t})}),[u]),S=t.useCallback(((e,t)=>{d({id:e,...t})}),[d]),b=t.useCallback((e=>dt.getState().spaces[e]),[]),I=t.useCallback((e=>{dt.getState().setPilotMode(e)}),[]);return{spaceList:p,activeSpaceId:r,openSpaces:f,openSpaceIds:a,pilotMode:n,createSpace:h,deleteSpace:y,setActive:g,setPilotMode:I,openSpace:m,closeSpace:v,updateSharedState:w,updateSpaceProperties:S,getSpaceById:b}}exports.AREA_BORDER_WIDTH=5,exports.AREA_MIN_CONTENT_WIDTH=ge,exports.AREA_PLACEMENT_TRESHOLD=.25,exports.AREA_ROLE=He,exports.AREA_TAB_HEIGHT=32,exports.ActionRegistry=xt,exports.AreaErrorBoundary=or,exports.AreaIdContext=ke,exports.AreaPreview=mr,exports.AreaRowSeparators=Sr,exports.AreaStack=gr,exports.AreaTabs=rr,exports.AreaToOpenPreview=Ir,exports.ContextMenu=Ar,exports.ContextMenuProvider=_r,exports.DetachedWindowCleanup=Er,exports.DropZone=br,exports.JoinAreaPreview=xr,exports.Karmyc=({offset:r=0})=>{if(!t.useContext($r))throw new Error("Karmyc must be used within a KarmycProvider");const a=wt(Pr),n=wt((e=>e.screens[e.activeScreenId]?.isDetached)),o=t.useMemo((()=>a?.rootId),[a?.rootId]),s=t.useMemo((()=>a?.layout??{}),[a?.layout]),i=t.useMemo((()=>a?.joinPreview),[a?.joinPreview]),c=t.useMemo((()=>a?.areaToOpen),[a?.areaToOpen]),l=t.useRef(null),[d,u]=t.useState((()=>n?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:be())),[p,f]=t.useState(null),h=wt((e=>e.setViewports));t.useEffect((()=>{if(!n){const e=document.querySelector(".area-root");if(e){const t=e.getBoundingClientRect();u({left:0,top:0,width:t.width,height:t.height})}}}),[n]),t.useEffect((()=>{const e=()=>{if(n){const e={left:0,top:0,width:window.innerWidth,height:window.innerHeight};l.current&&e.width===l.current.width&&e.height===l.current.height||u(e)}else{const e=document.querySelector(".area-root");if(e){const t=e.getBoundingClientRect(),r={left:0,top:0,width:t.width,height:t.height};l.current&&r.width===l.current.width&&r.height===l.current.height||u(r)}}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[n]),t.useEffect((()=>{const e=Object.keys(s).length,t=o?s[o]:null;if(o&&t&&0!==e){if(!(!d||d.width<=0||d.height<=0))try{const e=Me(s,o,{...d,top:d.top+r}),t=wt.getState().screens[wt.getState().activeScreenId]?.areas.viewports;if(!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const a of r){if(!t.hasOwnProperty(a))return!1;const r=e[a],n=t[a];if(r.left!==n.left||r.top!==n.top||r.width!==n.width||r.height!==n.height)return!1}return!0}(t,e)){Object.keys(e).some((r=>{const a=t?.[r],n=e[r];return!a||(Math.abs(a.left-n.left)>1||Math.abs(a.top-n.top)>1||Math.abs(a.width-n.width)>1||Math.abs(a.height-n.height)>1)}))&&(l.current=d,h(e))}}catch(e){console.error("[Karmyc] Erreur lors du calcul du viewportMap:",e)}}else null!==l.current&&(l.current=null,h({}))}),[s,o,d,p,h]);const y=t.useCallback((e=>{const t=wt.getState(),r=t.screens[t.activeScreenId],a=r?.areas.viewports||{},n=a[e];if(r?.isDetached)return{...n,left:0,top:0,width:window.innerWidth,height:window.innerHeight};if(!p)return n;let o,i=-1;if(o=Object.values(s).filter((e=>"area_row"===e.type)).find((t=>{const r=t.areas.findIndex((t=>t.id===e));return-1!==r&&(i=r,!0)})),!o||o.id!==p.rowId)return n;const c=p.separatorIndex;if(i===c-1||i===c){const t=i===c-1?c:c-1,r=o.areas[t]?.id;if(!r)return n;const s=a[r];if(!s)return n;const l=i===c-1,d=p.t;if(!a[o.id])return n;const u=l?n:s,f=l?s:n,h={left:u.left,top:u.top,width:u.width+f.width,height:u.height+f.height};if("horizontal"===o.orientation){const t=h.width,r=Math.max(0,Math.floor(t*d)),a=Math.max(0,t-r),o=l?r:a,s=l?h.left:h.left+r;return isNaN(o)||isNaN(s)?(console.warn(`[VisViewport] ${e}: NaN detected in horizontal calc.`),n):{...n,width:o,left:s}}if("vertical"===o.orientation){const t=h.height,r=Math.max(0,Math.floor(t*d)),a=Math.max(0,t-r),o=l?r:a,s=l?h.top:h.top+r;return isNaN(o)||isNaN(s)?(console.warn(`[VisViewport] ${e}: NaN detected in vertical calc.`),n):{...n,height:o,top:s}}if("stack"===o.orientation)return n}return n}),[s,p]);return e.jsxs(_r,{children:[e.jsx(Er,{}),e.jsxs("div",{className:"area-root",children:[Object.values(s).map((t=>{if("area_row"===t.type){const a=t,n=wt.getState().screens[wt.getState().activeScreenId]?.areas.viewports||{};if(a.areas.every((e=>n[e.id])))return e.jsx(Sr,{offset:r,row:a,setResizePreview:f},t.id)}return null})),Object.entries(s).map((([t])=>{const a=y(t);return a?e.jsx(vr,{id:t,viewport:{...a,top:a.top-r},setResizePreview:f},t):null})),i&&i.areaId&&(()=>{const t=(wt.getState().screens[wt.getState().activeScreenId]?.areas.viewports||{})[i.areaId];return t?e.jsx(xr,{viewport:t,movingInDirection:i.movingInDirection}):null})(),c&&e.jsx(Ir,{})]})]})},exports.KarmycContext=$r,exports.KarmycInitializer=Dr,exports.KarmycProvider=({children:r,options:a={},onError:n})=>{const o=t.useRef(!0),s=t.useRef(!1),i=t.useRef(null),c=t.useRef(0),l=t.useRef([]);t.useEffect((()=>{var e;St(a),a.t&&(e=a.t,Zt.getState().setTranslationFunction(e))}),[a]),t.useEffect((()=>{document.addEventListener("contextmenu",(e=>e.preventDefault()),!1)}),[]),t.useEffect((()=>{const e=new URLSearchParams(window.location.search).get("screen");if(e){if(wt.getState().screens[e])wt.setState({activeScreenId:e}),i.current=e;else{console.warn(`[KarmycProvider] Screen ID '${e}' from URL not found in store.`);const t=new URL(window.location.href);t.searchParams.delete("screen"),window.history.replaceState({},"",t.toString())}}const t=setTimeout((()=>{o.current=!1}),0);return()=>clearTimeout(t)}),[]);const d=wt((e=>e.activeScreenId)),u=wt((e=>e.screens));return t.useEffect((()=>{if(o.current||s.current)return;const e=wt.getState(),t=Object.keys(e.screens).length;if(t!==c.current){const r=Object.keys(e.screens).sort(((e,t)=>parseInt(e)-parseInt(t)));if(0===l.current.length)return l.current=r,void(c.current=t);const a=l.current.find((e=>!r.includes(e)));if(a){const e=l.current.indexOf(a),t=l.current.indexOf(d);if(t>e){const e=r[t-1];e&&(wt.setState({activeScreenId:e}),i.current=e)}}return l.current=r,void(c.current=t)}if(!e.screens[d])return console.warn(`[KarmycProvider] Invalid active screen ID '${d}', resetting to '1'`),void wt.setState({activeScreenId:"1"});if(i.current===d)return;const r=new URL(window.location.href),a=r.searchParams.get("screen");d!==a&&(s.current=!0,d?r.searchParams.set("screen",d):r.searchParams.delete("screen"),window.history.replaceState({},"",r.toString()),s.current=!1,i.current=d)}),[d,u]),t.useEffect((()=>{const e=e=>{const t=wt.getState();if(!t.options.keyboardShortcutsEnabled)return;if("Control"===e.key||"Alt"===e.key||"Shift"===e.key||"Meta"===e.key)return;const r=new Set;e.ctrlKey&&r.add("Control"),e.altKey&&r.add("Alt"),e.shiftKey&&r.add("Shift"),e.metaKey&&r.add("Command");const a=t.screens[t.activeScreenId]?.areas.activeAreaId,n=a?t.getAreaById(a)?.type:null,o=Nr().filter((e=>e.isGlobal));for(const t of o)if(t.key.toUpperCase()===e.key.toUpperCase()){const n=new Set(t.modifierKeys||[]);let o=!0;for(const e of n)if(!r.has(e)){o=!1;break}if(o){const e=new Set(t.optionalModifierKeys||[]);for(const t of r)if(!n.has(t)&&!e.has(t)){o=!1;break}}if(o){e.preventDefault(),e.stopPropagation();try{t.fn(a||"",{})}catch(e){console.error(`Error executing global shortcut ${t.name}:`,e)}return}}if(!a||!n)return;const s=Rr(n);for(const t of s)if(!t.isGlobal&&t.key.toUpperCase()===e.key.toUpperCase()){const n=new Set(t.modifierKeys||[]);let o=!0;for(const e of n)if(!r.has(e)){o=!1;break}if(o){const e=new Set(t.optionalModifierKeys||[]);for(const t of r)if(!n.has(t)&&!e.has(t)){o=!1;break}}if(o){e.preventDefault(),e.stopPropagation();try{t.fn(a,{})}catch(e){console.error(`Error executing shortcut ${t.name}:`,e)}return}}(function(e,t){const r=Nr();for(const a of r)if(a.key===e){const e=new Set(a.modifierKeys||[]);let r=!0;for(const a of e)if(!t.has(a)){r=!1;break}if(r){const n=new Set(a.optionalModifierKeys||[]);for(const a of t)if(!e.has(a)&&!n.has(a)){r=!1;break}}if(r)return!0}const a=[{key:"R",modifiers:["Control"]},{key:"S",modifiers:["Control"]},{key:"P",modifiers:["Control"]},{key:"F",modifiers:["Control"]},{key:"L",modifiers:["Control"]},{key:"U",modifiers:["Control"]},{key:"I",modifiers:["Control"]},{key:"J",modifiers:["Control"]},{key:"K",modifiers:["Control"]},{key:"N",modifiers:["Control"]},{key:"T",modifiers:["Control"]},{key:"W",modifiers:["Control"]}];for(const r of a)if(e===r.key){const e=new Set(r.modifiers);let a=!0;for(const r of e)if(!t.has(r)){a=!1;break}if(a&&t.size===e.size)return!0}return!1})(e.key,r)&&(e.preventDefault(),e.stopPropagation())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)}),[]),e.jsx($r.Provider,{value:{options:a},children:e.jsx(Dr,{options:a,onError:e=>{console.error("[KarmycInitializer] Error during initialization:",e),n?.(e)},children:r})})},exports.ScreenSwitcher=ir,exports.SpaceMenu=()=>{const{open:r}=sr(),[a,n]=t.useState(!1),{spaceList:o,activeSpaceId:s,openSpaces:i,createSpace:c,setActive:l,openSpace:d,closeSpace:u,updateSpaceProperties:p}=Kr(),f=t.useCallback((()=>{const e=o.find((e=>e.id===s));if(!e)return;const t=JSON.stringify(e,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(t),a=`${e.name}.json`,n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",a),n.click()}),[o,s]),h=t.useCallback((()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files?.[0];if(!t)return;const r=new FileReader;r.onload=e=>{try{const t=JSON.parse(e.target?.result),r=c(t.name,t.sharedState);r&&l(r)}catch(e){console.error("Error importing space:",e)}},r.readAsText(t)},e.click()}),[c,l]),y=t.useCallback((()=>{const e=o.find((e=>e.id===s));if(!e||!s)return;const t=prompt("Nouveau nom du space:",e.name);t&&t!==e.name&&p(s,{name:t})}),[o,s,p]);t.useEffect((()=>(At.registerActionHandler("space.new",(()=>{const e=c("Nouveau Space");e&&l(e)})),At.registerActionHandler("space.import",h),At.registerActionHandler("space.export",f),At.registerActionHandler("space.rename",y),At.registerActionHandler("space.close",(e=>{const t=e.spaceId||s;t&&u(t)})),At.registerActionHandler("space.open",(e=>{e.spaceId&&(d(e.spaceId),l(e.spaceId))})),()=>{At.unregisterActionHandler("space.new"),At.unregisterActionHandler("space.import"),At.unregisterActionHandler("space.export"),At.unregisterActionHandler("space.rename"),At.unregisterActionHandler("space.close"),At.unregisterActionHandler("space.open")})),[c,h,f,y,u,d,l,s]);const g=t.useCallback((e=>{e.preventDefault();const t=o.slice(-10).reverse(),a=!!s,n=[{id:"new",label:"Nouveau Space",actionId:"space.new",icon:qt},{id:"import",label:"Importer Space",actionId:"space.import",icon:Ft},{id:"export",label:"Exporter Space",actionId:"space.export",icon:Pt,disabled:!a},{id:"rename",label:"Renommer Space",actionId:"space.rename",icon:Wt,disabled:!a},{id:"close",label:"Fermer Space Actif",actionId:"space.close",icon:Xt,disabled:!a}];i.length>0&&n.push({id:"separator1",label:"---",actionId:"area.separator"},{id:"open",label:"Espaces Ouverts",actionId:"space.open",icon:Vt,children:i.map((e=>({id:`open-${e.id}`,label:e.name,actionId:"space.open",metadata:{spaceId:e.id}})))}),t.length>0&&n.push({id:"separator2",label:"---",actionId:"area.separator"},{id:"recent",label:"Spaces Récents",actionId:"space.recent",icon:Ut,children:t.map((e=>({id:`recent-${e.id}`,label:e.name,actionId:"space.open",metadata:{spaceId:e.id}})))}),r({position:{x:e.clientX,y:e.clientY},items:n,menuClassName:"space-context-menu"})}),[r,o,s,i]);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:"\n                    .space-context-menu {\n                        z-index: 9999 !important;\n                    }\n                "}),e.jsx("div",{onContextMenu:g,onClick:g,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),style:{cursor:"pointer",padding:"8px",color:"white",display:"flex",alignItems:"center",gap:"8px",userSelect:"none",backgroundColor:a?"rgba(255, 255, 255, 0.1)":"transparent",transition:"background-color 0.2s ease"},children:e.jsx(Vt,{size:26})})]})},exports.SwitchAreaTypeContextMenu=er,exports.TOOLBAR_HEIGHT=ye,exports.Vec2=Ee,exports._setAreaViewport=e=>{Ie=e},exports.actionRegistry=At,exports.areaRegistry=Ke,exports.capToRange=Ae,exports.computeAreaRowToMinSize=Oe,exports.computeAreaToParentRow=ze,exports.computeAreaToViewport=Me,exports.coreRegistry=_t,exports.createInitialScreenState=ft,exports.findParentRowAndIndices=ht,exports.getAreaRootViewport=be,exports.getAreaToOpenPlacementInViewport=Te,exports.getAreaViewport=(e,t)=>{const r=Ie[e];if(!r)return console.warn(`No viewport found for area ${e}`),{left:5,top:5,width:90,height:90};return{left:r.left+5,top:r.top+5,width:r.width-10,height:r.height-10}},exports.getHoveredAreaId=Ce,exports.getRgbaFromCssColor=e=>{if(e){if(Ve[e]){return $e(Ve[e])}if(Pe.test(e))return $e(e);if(Fe.test(e)){"#"===e.substr(0,1)&&(e=e.substr(1));let t="";for(const r of e.split(""))t+=r+r;return $e("#"+t)}if("none"!==e.toLowerCase())throw new Error("Only hex and CSS name colors are supported yet.")}},exports.hexColorRegex=Pe,exports.hexRegex=Le,exports.hexToBinary=e=>("#"===e.substr(0,1)&&(e=e.substr(1)),parseInt(e,16)),exports.hexToRGB=Ne,exports.hexToRGBA=$e,exports.hexToRGBAString=(e,t=1)=>`rgba(${Ne(e).join(",")},${t})`,exports.hslToRGB=([e,t,r])=>{t/=100,r/=100;const a=(1-Math.abs(2*r-1))*t,n=a*(1-Math.abs(e/60%2-1)),o=r-a/2;let s=0,i=0,c=0;return e>=0&&e<60?(s=a,i=n,c=0):e>=60&&e<120?(s=n,i=a,c=0):e>=120&&e<180?(s=0,i=a,c=n):e>=180&&e<240?(s=0,i=n,c=a):e>=240&&e<300?(s=n,i=0,c=a):e>=300&&e<360&&(s=a,i=0,c=n),s=Math.round(255*(s+o)),i=Math.round(255*(i+o)),c=Math.round(255*(c+o)),[s,i,c]},exports.initialAreaSliceState=pt,exports.initializeKarmycStore=St,exports.interpolate=xe,exports.joinAreas=Re,exports.rgbToBinary=e=>{const[t,r,a]=e;let n=256*t;return n+=r,n*=256,n+=a,n},exports.rgbToHSL=e=>{let[t,r,a]=e;t/=255,r/=255,a/=255;const n=Math.min(t,r,a),o=Math.max(t,r,a),s=o-n;let i=0,c=(o+n)/2,l=0===s?0:s/(1-Math.abs(2*c-1));return i=0===s?0:o===t?(r-a)/s%6:o===r?(a-t)/s+2:(t-r)/s+4,i=Math.round(60*i),i<0&&(i+=360),l=Number((100*l).toFixed(1)),c=Number((100*c).toFixed(1)),[i,l,c]},exports.rgbToString=(e,t=1)=>`rgba(${e.join(",")},${t})`,exports.rgbaToString=e=>`rgba(${e.join(",")})`,exports.setAreaResizing=e=>{window.__AREA_RESIZING__=e,e||(Se=0)},exports.shortHexColorRegex=Fe,exports.useArea=jr,exports.useAreaDragAndDrop=Et,exports.useAreaKeyboardShortcuts=function(e,r){t.useEffect((()=>{const t=r.map((t=>({...t,areaType:t.isGlobal?void 0:e})));return Tr(e,t),()=>{Lr(e)}}),[e,r])},exports.useContextMenu=sr,exports.useContextMenuStore=It,exports.useKarmyc=function(e={}){const r=t.useMemo((()=>{const t=(e.initialAreas??[]).filter((e=>e.role&&!Object.values(He).includes(e.role)?(console.warn(`Zone invalide ignorée: rôle "${e.role}" non reconnu`),!1):!!e.type||(console.warn("Zone invalide ignorée: type non défini"),!1)));return{plugins:e.plugins??[],validators:e.validators??[],initialAreas:t,keyboardShortcutsEnabled:e.keyboardShortcutsEnabled??!0,builtInLayouts:e.builtInLayouts??[],initialLayout:e.initialLayout??"default",options:{resizableAreas:e.resizableAreas??!0,manageableAreas:e.manageableAreas??!0,multiScreen:e.multiScreen??!0,builtInLayouts:e.builtInLayouts??[]}}}),[e.plugins,e.validators,e.initialAreas,e.keyboardShortcutsEnabled,e.builtInLayouts,e.initialLayout,e.resizableAreas,e.manageableAreas,e.multiScreen]);return t.useEffect((()=>{let e=!0;return(async()=>{try{const t={areas:{types:[],layout:{}},actions:{plugins:r.plugins,validators:r.validators},contextMenu:{actions:[]}};if(_t.initialize(t),!e)return;const a={...r.options,keyboardShortcutsEnabled:r.keyboardShortcutsEnabled,builtInLayouts:r.builtInLayouts,initialLayout:r.initialLayout};wt.setState((e=>({...e,options:a})))}catch(t){console.error("[KarmycInitializer] Error during initialization:",t),e&&wt.setState((e=>({...e,options:{resizableAreas:!0,manageableAreas:!0,multiScreen:!0,builtInLayouts:[]}})))}})(),()=>{e=!1}}),[r]),r},exports.useKarmycStore=wt,exports.usePluginSystem=function(e,r=[]){const[a,n]=t.useState(r),[o,s]=t.useState([]);return t.useEffect((()=>{const t=[];return a.forEach((r=>{if(r.onStoreInit&&r.onStoreInit(e),r.onStoreChange){let a=e.getState();const n=e.subscribe((e=>{e!==a&&(r.onStoreChange?.(e,a),a=e)}));t.push(n)}})),()=>{t.forEach((e=>e()))}}),[e,a]),t.useEffect((()=>{const e=a.filter((e=>e.actions&&Object.keys(e.actions).length>0)).map((e=>({id:e.name,priority:500,actionTypes:null,handler:t=>{e.actions&&t.type in e.actions&&e.actions[t.type](t.payload)}})));return e.forEach((e=>{At.registerPlugin(e)})),s(e),()=>{o.forEach((e=>{At.unregisterPlugin(e.id)}))}}),[a]),{plugins:a,registerPlugin:e=>{if(a.find((t=>t.name===e.name)))throw new Error(`Plugin with name "${e.name}" already exists`);n((t=>[...t,e]))},unregisterPlugin:e=>{n((t=>t.filter((t=>t.name!==e))))},applyPluginTransformations:e=>{let t={...e};for(const e of a)if(e.transformState){const r=e.transformState(t);t={...t,...r}}return t}}},exports.useRegisterActionHandler=Yt,exports.useRegisterAreaType=function(e,r,a,n){t.useEffect((()=>(Ke.registerComponent(e,r),Ke.registerInitialState(e,a),n&&(n.displayName&&Ke.registerDisplayName(e,n.displayName),n.icon&&Ke.registerIcon(e,n.icon),n.defaultSize&&Ke.registerDefaultSize(e,n.defaultSize),n.supportedActions&&Ke.registerSupportedActions(e,n.supportedActions),n.role&&(Ke._roleMap=Ke._roleMap||{},Ke._roleMap[e]=n.role),void 0!==n.supportFullscreen&&(Ke._supportFullscreenMap=Ke._supportFullscreenMap||{},Ke._supportFullscreenMap[e]=n.supportFullscreen)),()=>{Ke.unregisterAreaType(e)})),[e,r,a,n,n?.displayName,n?.defaultSize,n?.supportedActions,n?.icon,n?.role,n?.supportFullscreen])},exports.useSpace=Kr,exports.useSpaceHistory=function(e,r={}){const{enabled:a=!0}=r,n=dt((e=>e.undoSharedState)),o=dt((e=>e.redoSharedState)),s=dt((t=>e?t.spaces[e]:null)),i=Boolean(s?.sharedState?.pastDiffs?.length),c=Boolean(s?.sharedState?.futureDiffs?.length),l=t.useCallback((()=>{a&&e&&i&&n(e)}),[a,e,i,n]),d=t.useCallback((()=>{a&&e&&c&&o(e)}),[a,e,c,o]),u=t.useCallback((()=>{a&&e&&dt.setState((t=>{const r=t.spaces[e];r&&(r.sharedState.pastDiffs=[],r.sharedState.futureDiffs=[])}))}),[a,e]);return{canUndo:i,canRedo:c,undo:l,redo:d,clearHistory:u,pastDiffs:s?.sharedState?.pastDiffs??[],futureDiffs:s?.sharedState?.futureDiffs??[]}},exports.useSpaceStore=dt,exports.useTranslation=Qt;
//# sourceMappingURL=index.js.map
