import{jsx as e,jsxs as t,Fragment as r}from"react/jsx-runtime";import a,{useRef as n,useMemo as o,useCallback as i,useEffect as s,forwardRef as c,createElement as l,useState as d,createContext as u,useContext as p}from"react";import{ControlledMenu as f,SubMenu as h,MenuItem as y}from"@szhsin/react-menu";const m=e=>{let t;const r=new Set,a=(e,a)=>{const n="function"==typeof e?e(t):e;if(!Object.is(n,t)){const e=t;t=(null!=a?a:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach((r=>r(t,e)))}},n=()=>t,o={setState:a,getState:n,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{"production"!==(import.meta.env?import.meta.env.MODE:void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},i=t=e(a,n,o);return o};function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v,w={exports:{}},S={},b={exports:{}},I={};var _,A,x,O={};
/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function E(){return A||(A=1,"production"===process.env.NODE_ENV?b.exports=function(){if(v)return I;v=1;var e=a,t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=e.useState,n=e.useEffect,o=e.useLayoutEffect,i=e.useDebugValue;function s(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!t(e,a)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),c=r({inst:{value:a,getSnapshot:t}}),l=c[0].inst,d=c[1];return o((function(){l.value=a,l.getSnapshot=t,s(l)&&d({inst:l})}),[e,a,t]),n((function(){return s(l)&&d({inst:l}),e((function(){s(l)&&d({inst:l})}))}),[e]),i(a),a};return I.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:c,I}():b.exports=(_||(_=1,"production"!==process.env.NODE_ENV&&function(){function e(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!r(e,a)}catch(e){return!0}}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var t=a,r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=t.useState,o=t.useEffect,i=t.useLayoutEffect,s=t.useDebugValue,c=!1,l=!1,d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(a,d){c||void 0===t.startTransition||(c=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var u=d();if(!l){var p=d();r(u,p)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),l=!0)}var f=(p=n({inst:{value:u,getSnapshot:d}}))[0].inst,h=p[1];return i((function(){f.value=u,f.getSnapshot=d,e(f)&&h({inst:f})}),[a,u,d]),o((function(){return e(f)&&h({inst:f}),a((function(){e(f)&&h({inst:f})}))}),[a]),s(u),u};O.useSyncExternalStore=void 0!==t.useSyncExternalStore?t.useSyncExternalStore:d,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),O)),b.exports}
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z,k={};
/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"===process.env.NODE_ENV?w.exports=function(){if(x)return S;x=1;var e=a,t=E(),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=t.useSyncExternalStore,o=e.useRef,i=e.useEffect,s=e.useMemo,c=e.useDebugValue;return S.useSyncExternalStoreWithSelector=function(e,t,a,l,d){var u=o(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=s((function(){function e(e){if(!i){if(i=!0,n=e,e=l(e),void 0!==d&&p.hasValue){var t=p.value;if(d(t,e))return o=t}return o=e}if(t=o,r(n,e))return t;var a=l(e);return void 0!==d&&d(t,a)?(n=e,t):(n=e,o=a)}var n,o,i=!1,s=void 0===a?null:a;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]}),[t,a,l,d]);var f=n(e,u[0],u[1]);return i((function(){p.hasValue=!0,p.value=f}),[f]),c(f),f},S}():w.exports=(z||(z=1,"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=a,t=E(),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=t.useSyncExternalStore,o=e.useRef,i=e.useEffect,s=e.useMemo,c=e.useDebugValue;k.useSyncExternalStoreWithSelector=function(e,t,a,l,d){var u=o(null);if(null===u.current){var p={hasValue:!1,value:null};u.current=p}else p=u.current;u=s((function(){function e(e){if(!i){if(i=!0,n=e,e=l(e),void 0!==d&&p.hasValue){var t=p.value;if(d(t,e))return o=t}return o=e}if(t=o,r(n,e))return t;var a=l(e);return void 0!==d&&d(t,a)?(n=e,t):(n=e,o=a)}var n,o,i=!1,s=void 0===a?null:a;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]}),[t,a,l,d]);var f=n(e,u[0],u[1]);return i((function(){p.hasValue=!0,p.value=f}),[f]),c(f),f},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),k);var D=g(w.exports);const{useDebugValue:M}=a,{useSyncExternalStoreWithSelector:T}=D;let C=!1;const L=e=>e;const N=e=>{"production"!==(import.meta.env?import.meta.env.MODE:void 0)&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?m(e):m)(e):e,r=(e,r)=>function(e,t=L,r){"production"!==(import.meta.env?import.meta.env.MODE:void 0)&&r&&!C&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),C=!0);const a=T(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return M(a),a}(t,e,r);return Object.assign(r,t),r},$=e=>e?N(e):N;var R=Symbol.for("immer-nothing"),j=Symbol.for("immer-draftable"),P=Symbol.for("immer-state"),V="production"!==process.env.NODE_ENV?[function(e){return`The plugin for '${e}' has not been loaded into Immer. To enable the plugin, import and call \`enable${e}()\` when initializing your application.`},function(e){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${e}'`},"This object has been frozen and should not be mutated",function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(e){return`'current' expects a draft, got: ${e}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(e){return`'original' expects a draft, got: ${e}`}]:[];function F(e,...t){if("production"!==process.env.NODE_ENV){const r=V[e],a="function"==typeof r?r.apply(null,t):r;throw new Error(`[Immer] ${a}`)}throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var U=Object.getPrototypeOf;function H(e){return!!e&&!!e[P]}function B(e){return!!e&&(J(e)||Array.isArray(e)||!!e[j]||!!e.constructor?.[j]||Y(e)||Z(e))}var K=Object.prototype.constructor.toString();function J(e){if(!e||"object"!=typeof e)return!1;const t=U(e);if(null===t)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===K}function q(e,t){0===W(e)?Reflect.ownKeys(e).forEach((r=>{t(r,e[r],e)})):e.forEach(((r,a)=>t(a,r,e)))}function W(e){const t=e[P];return t?t.type_:Array.isArray(e)?1:Y(e)?2:Z(e)?3:0}function G(e,t){return 2===W(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function X(e,t,r){const a=W(e);2===a?e.set(t,r):3===a?e.add(r):e[t]=r}function Y(e){return e instanceof Map}function Z(e){return e instanceof Set}function Q(e){return e.copy_||e.base_}function ee(e,t){if(Y(e))return new Map(e);if(Z(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=J(e);if(!0===t||"class_only"===t&&!r){const t=Object.getOwnPropertyDescriptors(e);delete t[P];let r=Reflect.ownKeys(t);for(let a=0;a<r.length;a++){const n=r[a],o=t[n];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[n]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[n]})}return Object.create(U(e),t)}{const t=U(e);if(null!==t&&r)return{...e};const a=Object.create(t);return Object.assign(a,e)}}function te(e,t=!1){return ae(e)||H(e)||!B(e)||(W(e)>1&&(e.set=e.add=e.clear=e.delete=re),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>te(t,!0)))),e}function re(){F(2)}function ae(e){return Object.isFrozen(e)}var ne,oe={};function ie(e){const t=oe[e];return t||F(0,e),t}function se(){return ne}function ce(e,t){t&&(ie("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function le(e){de(e),e.drafts_.forEach(pe),e.drafts_=null}function de(e){e===ne&&(ne=e.parent_)}function ue(e){return ne={drafts_:[],parent_:ne,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function pe(e){const t=e[P];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function fe(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[P].modified_&&(le(t),F(4)),B(e)&&(e=he(t,e),t.parent_||me(t,e)),t.patches_&&ie("Patches").generateReplacementPatches_(r[P].base_,e,t.patches_,t.inversePatches_)):e=he(t,r,[]),le(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==R?e:void 0}function he(e,t,r){if(ae(t))return t;const a=t[P];if(!a)return q(t,((n,o)=>ye(e,a,t,n,o,r))),t;if(a.scope_!==e)return t;if(!a.modified_)return me(e,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;const t=a.copy_;let n=t,o=!1;3===a.type_&&(n=new Set(t),t.clear(),o=!0),q(n,((n,i)=>ye(e,a,t,n,i,r,o))),me(e,t,!1),r&&e.patches_&&ie("Patches").generatePatches_(a,r,e.patches_,e.inversePatches_)}return a.copy_}function ye(e,t,r,a,n,o,i){if("production"!==process.env.NODE_ENV&&n===r&&F(5),H(n)){const i=he(e,n,o&&t&&3!==t.type_&&!G(t.assigned_,a)?o.concat(a):void 0);if(X(r,a,i),!H(i))return;e.canAutoFreeze_=!1}else i&&r.add(n);if(B(n)&&!ae(n)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;he(e,n),t&&t.scope_.parent_||"symbol"==typeof a||!Object.prototype.propertyIsEnumerable.call(r,a)||me(e,n)}}function me(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&te(t,r)}var ge={get(e,t){if(t===P)return e;const r=Q(e);if(!G(r,t))return function(e,t,r){const a=Se(t,r);return a?"value"in a?a.value:a.get?.call(e.draft_):void 0}(e,r,t);const a=r[t];return e.finalized_||!B(a)?a:a===we(e.base_,t)?(Ie(e),e.copy_[t]=_e(a,e)):a},has:(e,t)=>t in Q(e),ownKeys:e=>Reflect.ownKeys(Q(e)),set(e,t,r){const a=Se(Q(e),t);if(a?.set)return a.set.call(e.draft_,r),!0;if(!e.modified_){const a=we(Q(e),t),i=a?.[P];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((n=r)===(o=a)?0!==n||1/n==1/o:n!=n&&o!=o)&&(void 0!==r||G(e.base_,t)))return!0;Ie(e),be(e)}var n,o;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==we(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Ie(e),be(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=Q(e),a=Reflect.getOwnPropertyDescriptor(r,t);return a?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:a.enumerable,value:r[t]}:a},defineProperty(){F(11)},getPrototypeOf:e=>U(e.base_),setPrototypeOf(){F(12)}},ve={};function we(e,t){const r=e[P];return(r?Q(r):e)[t]}function Se(e,t){if(!(t in e))return;let r=U(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=U(r)}}function be(e){e.modified_||(e.modified_=!0,e.parent_&&be(e.parent_))}function Ie(e){e.copy_||(e.copy_=ee(e.base_,e.scope_.immer_.useStrictShallowCopy_))}q(ge,((e,t)=>{ve[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),ve.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&F(13),ve.set.call(this,e,t,void 0)},ve.set=function(e,t,r){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&F(14),ge.set.call(this,e[0],t,r,e[0])};function _e(e,t){const r=Y(e)?ie("MapSet").proxyMap_(e,t):Z(e)?ie("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),a={type_:r?1:0,scope_:t?t.scope_:se(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=a,o=ge;r&&(n=[a],o=ve);const{revoke:i,proxy:s}=Proxy.revocable(n,o);return a.draft_=s,a.revoke_=i,s}(e,t);return(t?t.scope_:se()).drafts_.push(r),r}function Ae(e){if(!B(e)||ae(e))return e;const t=e[P];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=ee(e,t.scope_.immer_.useStrictShallowCopy_)}else r=ee(e,!0);return q(r,((e,t)=>{X(r,e,Ae(t))})),t&&(t.finalized_=!1),r}var xe=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if("function"==typeof e&&"function"!=typeof t){const r=t;t=e;const a=this;return function(e=r,...n){return a.produce(e,(e=>t.call(this,e,...n)))}}let a;if("function"!=typeof t&&F(6),void 0!==r&&"function"!=typeof r&&F(7),B(e)){const n=ue(this),o=_e(e,void 0);let i=!0;try{a=t(o),i=!1}finally{i?le(n):de(n)}return ce(n,r),fe(a,n)}if(!e||"object"!=typeof e){if(a=t(e),void 0===a&&(a=e),a===R&&(a=void 0),this.autoFreeze_&&te(a,!0),r){const t=[],n=[];ie("Patches").generateReplacementPatches_(e,a,t,n),r(t,n)}return a}F(1,e)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...r)=>this.produceWithPatches(t,(t=>e(t,...r)));let r,a;return[this.produce(e,t,((e,t)=>{r=e,a=t})),r,a]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){B(e)||F(8),H(e)&&(e=function(e){H(e)||F(10,e);return Ae(e)}(e));const t=ue(this),r=_e(e,void 0);return r[P].isManual_=!0,de(t),r}finishDraft(e,t){const r=e&&e[P];r&&r.isManual_||F(9);const{scope_:a}=r;return ce(a,t),fe(void 0,a)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const a=t[r];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}r>-1&&(t=t.slice(r+1));const a=ie("Patches").applyPatches_;return H(e)?a(e,t):this.produce(e,(e=>a(e,t)))}},Oe=xe.produce;xe.produceWithPatches.bind(xe),xe.setAutoFreeze.bind(xe),xe.setUseStrictShallowCopy.bind(xe),xe.applyPatches.bind(xe),xe.createDraft.bind(xe),xe.finishDraft.bind(xe);const Ee=e=>(t,r,a)=>(a.setState=(e,r,...a)=>{const n="function"==typeof e?Oe(e):e;return t(n,r,...a)},e(a.setState,r,a)),ze=5,ke=30,De=32,Me=.25,Te=32;let Ce=null,Le=0,Ne=0,$e=0;const Re=()=>{const e={top:0,left:0,height:Math.floor(window.document.querySelector(".area-root")?.getBoundingClientRect().height||0),width:Math.floor(window.document.querySelector(".area-root")?.getBoundingClientRect().width||0)},t=Date.now();if(window.__AREA_RESIZING__){if($e||($e=t,Ce||(Ce={...e},Le=e.width,Ne=e.height)),Ce)return Ce}else $e&&t-$e>500&&($e=0);const r=Math.abs(e.width-Le),a=Math.abs(e.height-Ne),n=r>5||a>5;return window.__AREA_RESIZING__||!n||$e||(Ce={...e},Le=e.width,Ne=e.height),Ce||e},je=e=>{window.__AREA_RESIZING__=e,e||($e=0)};let Pe={};const Ve=e=>{Pe=e},Fe=(e,t)=>{const r=Pe[e];if(!r)return console.warn(`No viewport found for area ${e}`),{left:5,top:5,width:90,height:90};return{left:r.left+5,top:r.top+5,width:r.width-10,height:r.height-10}},Ue=(e,t,r)=>e*(1-r)+t*r,He=(e,t,r)=>Math.min(t,Math.max(e,r)),Be=e=>e instanceof Ke?e:"number"==typeof e.left?new Ke(e.left,e.top):new Ke(e.x,e.y);class Ke{static new(e,t){return"number"==typeof e?new Ke(e,t):"number"==typeof e.left?new Ke(e.left,e.top):new Ke(e.x,e.y)}static fromEvent(e){return new Ke(e.clientX,e.clientY)}static dot(e,t){const r=Be(e),a=Be(t);return r.x*a.x+r.y*a.y}constructor(e,t){"number"==typeof e?(this._x=e,this._y=t):(this._x=e.x,this._y=e.y),this.atOrigin=0===this.x&&0===this.y,this.apply=this.apply.bind(this)}set x(e){this._x=e,this.atOrigin=0===this.x&&0===this.y}get x(){return this._x}set y(e){this._y=e,this.atOrigin=0===this.x&&0===this.y}get y(){return this._y}add(e){const t=Be(e);return t.atOrigin?this:new Ke(this.x+t.x,this.y+t.y)}addX(e){return new Ke(this.x+e,this.y)}addY(e){return new Ke(this.x,this.y+e)}sub(e){const t=Be(e);return t.atOrigin?this:new Ke(this.x-t.x,this.y-t.y)}subX(e){return new Ke(this.x-e,this.y)}subY(e){return new Ke(this.x,this.y-e)}subXY(e,t){return new Ke(this.x-e,this.y-t)}scale(e,t=Ke.new(0,0)){if(1===e)return this;const r=Be(t);return new Ke(r.x+(this.x-r.x)*e,r.y+(this.y-r.y)*e)}scaleX(e,t=Ke.new(0,0)){if(1===e)return this;const r=Be(t);return new Ke(r.x+(this.x-r.x)*e,this.y)}scaleY(e,t=Ke.new(0,0)){if(1===e)return this;const r=Be(t);return new Ke(this.x,r.y+(this.y-r.y)*e)}scaleXY(e,t,r=Ke.new(0,0)){if(1===e&&1===t)return this;const a=Be(r);return new Ke(a.x+(this.x-a.x)*e,a.y+(this.y-a.y)*t)}rotate(e,t=Ke.new(0,0)){if(0===e)return this;const r=Be(t),a=this.x-r.x,n=this.y-r.y,o=Math.cos(e),i=Math.sin(e),s=a*i+n*o;return new Ke(a*o-n*i+r.x,s+r.y)}multiplyMat2(e,t=Ke.new(0,0)){const r=Be(t);return e.multiplyVec2(this.sub(r)).add(r)}copy(){return new Ke(this.x,this.y)}lerp(e,t){const r=Be(e);return new Ke(Ue(this.x,r.x,t),Ue(this.y,r.y,t))}round(){return Ke.new(Math.round(this.x),Math.round(this.y))}apply(e){return Be(e(this))}length(){return Math.hypot(this.x,this.y)}eq(e){const t=Be(e);return t.x===this.x&&t.y===this.y}toJSON(){return{x:this.x,y:this.y,__objectType:"vec2"}}}Ke.ORIGIN=Ke.new(0,0);const Je=a.createContext(""),qe=(e,t)=>{const r={};if("area"===t[e].type)return{};return r[e]=function e(a){const n=t[a];if("area"===n.type)return{width:1,height:1};const o={height:0,width:0},i=n.areas.map((t=>e(t.id)));return"horizontal"===n.orientation?(o.width=i.reduce(((e,t)=>e+t.width),0),o.height=Math.max(...i.map((e=>e.height)))):(o.height=i.reduce(((e,t)=>e+t.height),0),o.width=Math.max(...i.map((e=>e.width)))),r[a]=o,o}(e),r};function We(e){const t={};if(!e)return console.error("computeAreaToParentRow received null or undefined layout."),{};const r=Object.keys(e);for(let a=0;a<r.length;a+=1){const n=e[r[a]];if(!n||"area_row"!==n.type)continue;const o=n;if(o.areas&&Array.isArray(o.areas))for(let e=0;e<o.areas.length;e+=1)o.areas[e]&&o.areas[e].id&&(t[o.areas[e].id]=o.id)}return t}const Ge={lastCalculation:0,totalCalculations:0,failedIds:new Set,reportedProblems:new Set,reset(){this.failedIds.clear(),this.reportedProblems.clear()}};setInterval((()=>{Date.now()-Ge.lastCalculation>6e4&&Ge.reset()}),6e4);let Xe={width:0,height:0};const Ye=(e,t,r)=>{if(!t)return{};const a=JSON.parse(JSON.stringify(e));if(Ge.lastCalculation=Date.now(),Ge.totalCalculations++,!r||r.width<=0||r.height<=0){if(console.error("Invalid viewport dimensions",r),!(Xe.width>0&&Xe.height>0))return{};console.warn("Using last valid viewport dimensions"),r={...r,width:Xe.width,height:Xe.height}}else Xe={width:r.width,height:r.height};if(!e||0===Object.keys(e).length)return console.error("Empty layout provided to computeAreaToViewport"),{};if(!t||!a[t])return console.error(`Invalid rootId: ${t} - not found in layout`,e),{};const n={},o=new Set,i=Ge.reportedProblems;function s(e,t){e&&t?o.has(e.id)||(e.type||(console.warn(`Area ${e.id} has no type, defaulting to 'area'`),e.type="area"),t.width<=0||t.height<=0?console.warn(`Area ${e.id} has invalid content area size: ${t.width}x${t.height}`):(o.add(e.id),n[e.id]={...t})):console.error("Invalid area or contentArea in computeArea",{area:e,contentArea:t})}Object.entries(a).forEach((([e,t])=>{t?"area_row"!==t.type||t.areas&&Array.isArray(t.areas)||console.error(`Area row ${e} has invalid areas property`,t):console.error(`Invalid area definition for id ${e}`,t)}));const c=a[t];"area"===c.type?s(c,r):"area_row"===c.type&&function e(t,r){if(!t||!r||o.has(t.id)){if(t&&o.has(t.id))return;if(!t)return void console.error("computeRow: Invalid row");if(!r)return void console.error("computeRow: Invalid contentArea for row",t.id)}if(o.add(t.id),t.areas&&Array.isArray(t.areas)||(console.error("Row without proper areas array in computeRow",{rowId:t.id,areas:t.areas}),t.areas=[]),(r.width<=0||r.height<=0)&&(console.error("ContentArea with invalid dimensions in computeRow",{rowId:t.id,contentArea:r}),r={...r,width:Math.max(r.width,10),height:Math.max(r.height,10)},console.warn("Corrected contentArea to minimum size for row",t.id,r)),0===t.areas.length)return console.warn("Row with empty areas array in computeRow, skipping children but assigning viewport",{rowId:t.id}),void(n[t.id]={...r});n[t.id]={...r};const c=t.areas.map((e=>e.id)).filter((e=>!a[e]));c.length>0&&c.forEach((e=>{i.has(`auto_creating_${e}`)||(console.warn(`Auto-creating area ${e} referenced in row ${t.id}`),i.add(`auto_creating_${e}`)),a[e]={type:"area",id:e}}));const l=.05;let d=0;t.areas.forEach(((e,r)=>{e.size>1&&(e.size=e.size/100),"number"!=typeof e.size||isNaN(e.size)||e.size<=0?(0===e.size&&d++,i.has(`${t.id}_${r}_size`)||(console.warn(`Invalid size for area ${e.id}: ${e.size}, defaulting to 1/${t.areas.length}`),i.add(`${t.id}_${r}_size`)),e.size=1/t.areas.length):e.size<l&&(i.has(`${t.id}_${r}_min_size`)||(console.warn(`Area ${e.id} has very small size: ${e.size}, setting to minimum 0.05`),i.add(`${t.id}_${r}_min_size`)),e.size=l)}));const u=t.areas.reduce(((e,t)=>e+(t.size||0)),0);if(0===u||d===t.areas.length){console.warn(`All areas in row ${t.id} have zero size, setting equal distribution`);const e=1/t.areas.length;t.areas.forEach((t=>{t.size=e}))}else if(Math.abs(u-1)>.001){const e=1/u;t.areas.forEach((t=>{t.size=t.size*e}))}const p=t.areas.reduce(((e,t)=>e+(t.size||0)),0);if(Math.abs(p-1)>.001){console.error(`Failed to normalize sizes in row ${t.id}: final total=${p}`);const e=1/t.areas.length;t.areas.forEach((t=>{t.size=e}))}let f=r.left,h=r.top,y=0,m=0;for(let n=0;n<t.areas.length;n++){const o=t.areas[n];if(!o||!o.id)continue;const i=o.id,c=a[i],l=n===t.areas.length-1;if(!c)continue;let d,u;"horizontal"===t.orientation?(u=r.height,l?d=Math.max(0,r.width-y):(d=Math.max(0,Math.floor(o.size*r.width)),y+=d)):(d=r.width,l?u=Math.max(0,r.height-m):(u=Math.max(0,Math.floor(o.size*r.height)),m+=u));const p={left:f,top:h,width:d,height:u};try{"area"===c.type?s(c,p):"area_row"===c.type&&e(c,p)}catch(e){console.error(`[computeRow RECURSE_ERROR ${n}] Error computing viewport for area ${i}:`,e)}"horizontal"===t.orientation?f+=d:h+=u}}(c,r);const l=Object.keys(a).filter((e=>!n[e]));return l.length>0&&l.forEach((e=>{n[e]||(Ge.failedIds.add(e),n[e]={left:0,top:0,width:100,height:100})})),n},Ze=(e,t,r,a)=>{const n=a?Ke.new(e.x+a.x/15,e.y+a.y/15):e;let o,i,s,c=1/0;return Object.entries(r).forEach((([e,r])=>{const a=t.layout[e];if(!a||"area"!==a.type&&("area_row"!==a.type||"stack"!==a.orientation))return;if(n.x>=r.left&&n.x<=r.left+r.width&&n.y>=r.top&&n.y<=r.top+r.height)return void("area_row"===a.type&&"stack"===a.orientation?o=e:"area"===a.type&&(i=e));const l=Math.abs(n.x-r.left),d=Math.abs(n.x-(r.left+r.width)),u=Math.abs(n.y-r.top),p=Math.abs(n.y-(r.top+r.height)),f=Math.min(l,d,u,p);f<c&&(c=f,s=e)})),o||i||s};function Qe(e,t){const r=t.x-e.left,a=t.y-e.top,n=r,o=e.width-r,i=a,s=e.height-a,c=e.width/2,l=e.height/2,d=Math.abs(r-c),u=Math.abs(a-l),p=.3*e.width,f=.3*e.height;if(d<p&&u<f)return"stack";const h=Math.min(n,o,i,s);let y;return y=h===n?"left":h===o?"right":h===i?"top":"bottom",y}const et=(e,t,r)=>{const a=t,n=a+r;if(a<0||a>=e.areas.length||n<0||n>=e.areas.length)throw new Error(`Invalid indices: source=${a}, target=${n}, length=${e.areas.length}, direction=${-1===r?"west":"east"}`);const o=e.areas[a],i=e.areas[n];if(!o||!i)throw new Error(`Missing areas: source=${o}, target=${i}`);const s=(o.size||1)+(i.size||1);if(2===e.areas.length){return{area:{type:"area",id:o.id},removedAreaId:i.id}}const c=[...e.areas];c[n]={id:o.id,size:s},c.splice(a,1);return{area:{...e,areas:c},removedAreaId:i.id}},tt=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rt=e=>{const[,t,r,a]=tt.exec(e);return[t,r,a].map((e=>parseInt(e,16)))},at=e=>("#"===e.substr(0,1)&&(e=e.substr(1)),parseInt(e,16)),nt=e=>{const[t,r,a]=e;let n=256*t;return n+=r,n*=256,n+=a,n},ot=e=>{const[t,r,a]=rt(e);return[t,r,a,1]},it=(e,t=1)=>`rgba(${rt(e).join(",")},${t})`,st=(e,t=1)=>`rgba(${e.join(",")},${t})`,ct=e=>`rgba(${e.join(",")})`,lt=e=>{let[t,r,a]=e;t/=255,r/=255,a/=255;const n=Math.min(t,r,a),o=Math.max(t,r,a),i=o-n;let s=0,c=(o+n)/2,l=0===i?0:i/(1-Math.abs(2*c-1));return s=0===i?0:o===t?(r-a)/i%6:o===r?(a-t)/i+2:(t-r)/i+4,s=Math.round(60*s),s<0&&(s+=360),l=Number((100*l).toFixed(1)),c=Number((100*c).toFixed(1)),[s,l,c]},dt=([e,t,r])=>{t/=100,r/=100;const a=(1-Math.abs(2*r-1))*t,n=a*(1-Math.abs(e/60%2-1)),o=r-a/2;let i=0,s=0,c=0;return e>=0&&e<60?(i=a,s=n,c=0):e>=60&&e<120?(i=n,s=a,c=0):e>=120&&e<180?(i=0,s=a,c=n):e>=180&&e<240?(i=0,s=n,c=a):e>=240&&e<300?(i=n,s=0,c=a):e>=300&&e<360&&(i=a,s=0,c=n),i=Math.round(255*(i+o)),s=Math.round(255*(s+o)),c=Math.round(255*(c+o)),[i,s,c]},ut=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,pt=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,ft={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ht=e=>{if(e){if(ft[e]){return ot(ft[e])}if(ut.test(e))return ot(e);if(pt.test(e)){"#"===e.substr(0,1)&&(e=e.substr(1));let t="";for(const r of e.split(""))t+=r+r;return ot("#"+t)}if("none"!==e.toLowerCase())throw new Error("Only hex and CSS name colors are supported yet.")}};var yt;!function(e){e[e.CRITICAL=1e3]="CRITICAL",e[e.HIGH=800]="HIGH",e[e.NORMAL=500]="NORMAL",e[e.LOW=200]="LOW",e[e.BACKGROUND=100]="BACKGROUND"}(yt||(yt={}));const mt={LEAD:"LEAD",FOLLOW:"FOLLOW",SELF:"SELF"},gt=new Map,vt={registerComponent:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,component:t})},registerInitialState:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,initialState:t})},registerDisplayName:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,displayName:t})},registerIcon:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,icon:t})},registerDefaultSize:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,defaultSize:t})},registerSupportedActions:(e,t)=>{const r=gt.get(e)||{};gt.set(e,{...r,supportedActions:t})},getComponent:e=>gt.get(e)?.component,getInitialState:e=>gt.get(e)?.initialState||{},getDisplayName:e=>gt.get(e)?.displayName||e,getIcon:e=>gt.get(e)?.icon,getDefaultSize:e=>gt.get(e)?.defaultSize,getSupportedActions:e=>gt.get(e)?.supportedActions,getRegisteredTypes:()=>new Set(Array.from(gt.keys())),unregisterAreaType:e=>{gt.delete(e)}},wt=e=>{const t=[];return e.id||t.push("Missing ID"),e.type||t.push("Missing type"),e.state||t.push("Missing state"),e.type&&!vt.getRegisteredTypes().has(e.type)&&t.push(`Invalid area type: ${e.type}`),{isValid:0===t.length,errors:t}},St=e=>{const t=[];return"number"!=typeof e.x&&t.push("Position X must be a number"),"number"!=typeof e.y&&t.push("Position Y must be a number"),isNaN(e.x)&&t.push("Position X is NaN"),isNaN(e.y)&&t.push("Position Y is NaN"),{isValid:0===t.length,errors:t}},bt=e=>{const t=[];return e.id||t.push("Missing ID"),e.label||t.push("Missing label"),e.actionId||t.push("Missing actionId"),{isValid:0===t.length,errors:t}},It=new Map,_t=e=>{const t=It.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},At=(e,t={})=>(r,a,n)=>{const{enabled:o,anonymousActionType:i,store:s,...c}=t;let l;try{l=(null!=o?o:"production"!==(import.meta.env?import.meta.env.MODE:void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!l)return"production"!==(import.meta.env?import.meta.env.MODE:void 0)&&o&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(r,a,n);const{connection:d,...u}=((e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};const a=It.get(r.name);if(a)return{type:"tracked",store:e,...a};const n={connection:t.connect(r),stores:{}};return It.set(r.name,n),{type:"tracked",store:e,...n}})(s,l,c);let p=!0;n.setState=(e,t,o)=>{const l=r(e,t);if(!p)return l;const u=void 0===o?{type:i||"anonymous"}:"string"==typeof o?{type:o}:o;return void 0===s?(null==d||d.send(u,a()),l):(null==d||d.send({...u,type:`${s}/${u.type}`},{..._t(c.name),[s]:n.getState()}),l)};const f=(...e)=>{const t=p;p=!1,r(...e),p=t},h=e(n.setState,a,n);if("untracked"===u.type?null==d||d.init(h):(u.stores[u.store]=n,null==d||d.init(Object.fromEntries(Object.entries(u.stores).map((([e,t])=>[e,e===u.store?h:t.getState()]))))),n.dispatchFromDevtools&&"function"==typeof n.dispatch){let e=!1;const t=n.dispatch;n.dispatch=(...r)=>{"production"===(import.meta.env?import.meta.env.MODE:void 0)||"__setState"!==r[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...r)}}return d.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):xt(e.payload,(e=>{if("__setState"!==e.type)n.dispatchFromDevtools&&"function"==typeof n.dispatch&&n.dispatch(e);else{if(void 0===s)return void f(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[s];if(null==t)return;JSON.stringify(n.getState())!==JSON.stringify(t)&&f(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return f(h),void 0===s?null==d?void 0:d.init(n.getState()):null==d?void 0:d.init(_t(c.name));case"COMMIT":return void 0===s?void(null==d||d.init(n.getState())):null==d?void 0:d.init(_t(c.name));case"ROLLBACK":return xt(e.state,(e=>{if(void 0===s)return f(e),void(null==d||d.init(n.getState()));f(e[s]),null==d||d.init(_t(c.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return xt(e.state,(e=>{void 0!==s?JSON.stringify(n.getState())!==JSON.stringify(e[s])&&f(e[s]):f(e)}));case"IMPORT_STATE":{const{nextLiftedState:r}=e.payload,a=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!a)return;return f(void 0===s?a:a[s]),void(null==d||d.send(null,r))}case"PAUSE_RECORDING":return p=!p}return}})),h},xt=(e,t)=>{let r;try{r=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==r&&t(r)};function Ot(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=r.getItem(e))?t:null;return n instanceof Promise?n.then(a):a(n)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}const Et=e=>t=>{try{const r=e(t);return r instanceof Promise?r:{then:e=>Et(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>Et(t)(e)}}},zt=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?("production"!==(import.meta.env?import.meta.env.MODE:void 0)&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(r,a,n)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const s=new Set,c=new Set;let l;try{l=o.getStorage()}catch(e){}if(!l)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)}),a,n);const d=Et(o.serialize),u=()=>{const e=o.partialize({...a()});let t;const r=d({state:e,version:o.version}).then((e=>l.setItem(o.name,e))).catch((e=>{t=e}));if(t)throw t;return r},p=n.setState;n.setState=(e,t)=>{p(e,t),u()};const f=e(((...e)=>{r(...e),u()}),a,n);let h;const y=()=>{var e;if(!l)return;i=!1,s.forEach((e=>e(a())));const t=(null==(e=o.onRehydrateStorage)?void 0:e.call(o,a()))||void 0;return Et(l.getItem.bind(l))(o.name).then((e=>{if(e)return o.deserialize(e)})).then((e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return e.state;if(o.migrate)return o.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((e=>{var t;return h=o.merge(e,null!=(t=a())?t:f),r(h,!0),u()})).then((()=>{null==t||t(h,void 0),i=!0,c.forEach((e=>e(h)))})).catch((e=>{null==t||t(void 0,e)}))};return n.persist={setOptions:e=>{o={...o,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>y(),hasHydrated:()=>i,onHydrate:e=>(s.add(e),()=>{s.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},y(),h||f})(e,t)):((e,t)=>(r,a,n)=>{let o={storage:Ot((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const s=new Set,c=new Set;let l=o.storage;if(!l)return e(((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)}),a,n);const d=()=>{const e=o.partialize({...a()});return l.setItem(o.name,{state:e,version:o.version})},u=n.setState;n.setState=(e,t)=>{u(e,t),d()};const p=e(((...e)=>{r(...e),d()}),a,n);let f;n.getInitialState=()=>p;const h=()=>{var e,t;if(!l)return;i=!1,s.forEach((e=>{var t;return e(null!=(t=a())?t:p)}));const n=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=a())?e:p))||void 0;return Et(l.getItem.bind(l))(o.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate)return[!0,o.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]})).then((e=>{var t;const[n,i]=e;if(f=o.merge(i,null!=(t=a())?t:p),r(f,!0),n)return d()})).then((()=>{null==n||n(f,void 0),f=a(),i=!0,c.forEach((e=>e(f)))})).catch((e=>{null==n||n(void 0,e)}))};return n.persist={setOptions:e=>{o={...o,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>h(),hasHydrated:()=>i,onHydrate:e=>(s.add(e),()=>{s.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},o.skipHydration||h(),f||p})(e,t),kt=[];for(let e=0;e<256;++e)kt.push((e+256).toString(16).slice(1));let Dt;const Mt=new Uint8Array(16);var Tt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ct(e,t,r){if(Tt.randomUUID&&!e)return Tt.randomUUID();const a=(e=e||{}).random??e.rng?.()??function(){if(!Dt){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Dt=crypto.getRandomValues.bind(crypto)}return Dt(Mt)}();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=15&a[6]|64,a[8]=63&a[8]|128,function(e,t=0){return(kt[e[t+0]]+kt[e[t+1]]+kt[e[t+2]]+kt[e[t+3]]+"-"+kt[e[t+4]]+kt[e[t+5]]+"-"+kt[e[t+6]]+kt[e[t+7]]+"-"+kt[e[t+8]]+kt[e[t+9]]+"-"+kt[e[t+10]]+kt[e[t+11]]+kt[e[t+12]]+kt[e[t+13]]+kt[e[t+14]]+kt[e[t+15]]).toLowerCase()}(a)}function Lt(e,t){let r={...e};return t.changes.forEach((e=>{let t=r;for(let r=0;r<e.path.length-1;r++)t=t[e.path[r]];t[e.path[e.path.length-1]]=e.oldValue})),r}const Nt=Ee(((e,t)=>({spaces:{},activeSpaceId:null,openSpaceIds:[],errors:[],pilotMode:"AUTO",addSpace:r=>{if(!r.name)return e((e=>{e.errors=["Space name cannot be empty."]})),void console.error("Validation failed for space:",t().errors);const a=Ct(),n={id:a,name:r.name,description:r.description??"",sharedState:{color:r.sharedState?.color??"#ff0000",pastDiffs:[],futureDiffs:[],...r.sharedState||{}}};return e((e=>{e.spaces[a]=n,e.openSpaceIds.push(a),e.errors=[]})),a},removeSpace:t=>{e((e=>{delete e.spaces[t],e.activeSpaceId===t&&(e.activeSpaceId=null),e.openSpaceIds=e.openSpaceIds.filter((e=>e!==t)),e.errors=[]}))},setActiveSpace:t=>{e((e=>{null===t||e.spaces[t]?e.activeSpaceId=t:console.warn(`Attempted to set active space to non-existent ID: ${t}`),e.errors=[]}))},setPilotMode:t=>{e((e=>{e.pilotMode=t}))},openSpace:t=>{e((e=>{e.spaces[t]&&!e.openSpaceIds.includes(t)&&e.openSpaceIds.push(t)}))},closeSpace:t=>{e((e=>{e.openSpaceIds=e.openSpaceIds.filter((e=>e!==t)),e.activeSpaceId===t&&(e.activeSpaceId=e.openSpaceIds[e.openSpaceIds.length-1]||null)}))},updateSpace:t=>{e((e=>{const r=e.spaces[t.id];if(r){if(""===t.name)return e.errors=["Space name cannot be empty."],void console.error("Validation failed for space update:",e.errors);const{id:a,...n}=t;e.spaces[a]={...r,...n},e.errors=[]}else e.errors=[`Space with ID ${t.id} not found for update.`],console.error("Update failed:",e.errors)}))},updateSpaceGenericSharedState:r=>{const{spaceId:a,changes:n}=r,o=t().spaces[a];if(!o)return e((e=>{e.errors=[`Space with ID ${r.spaceId} not found for shared state update.`]})),void console.error("Shared state update failed: Space not found");const i=o.sharedState,s=n.actionType||"UPDATE_SHARED_STATE",c=n.payload||{};e((e=>{const t=e.spaces[a];if(t){const{actionType:r,payload:a,...o}=n;t.sharedState={...t.sharedState,...o},e.errors=[]}}));const l=t().spaces[a]?.sharedState;if(!l)return void console.error("Shared state update failed: Space disappeared after update?");const d=function(e,t){const r=[];return function e(t,a,n){if(a!==n)if(typeof a==typeof n)if("object"==typeof a&&null!==a&&null!==n){const o=a,i=n,s=Object.keys(o),c=Object.keys(i);s.forEach((e=>{c.includes(e)||r.push({path:[...t,e],oldValue:o[e],newValue:void 0})})),c.forEach((a=>{s.includes(a)?e([...t,a],o[a],i[a]):r.push({path:[...t,a],oldValue:void 0,newValue:i[a]})}))}else r.push({path:t,oldValue:a,newValue:n});else r.push({path:t,oldValue:a,newValue:n})}([],e,t),r}(i,l);Array.isArray(d)&&d.length>0&&e((e=>{const t=e.spaces[a];t&&(t.sharedState.pastDiffs||(t.sharedState.pastDiffs=[]),t.sharedState.pastDiffs.push({timestamp:Date.now(),actionType:s,payload:c,changes:d}),t.sharedState.futureDiffs=[])}))},clearErrors:()=>{e((e=>{e.errors=[]}))},undoSharedState:t=>{e((e=>{const r=e.spaces[t];if(!r?.sharedState?.pastDiffs?.length)return;const a=r.sharedState.pastDiffs.pop(),n=Lt(r.sharedState,a);r.sharedState=n,r.sharedState.futureDiffs||(r.sharedState.futureDiffs=[]),r.sharedState.futureDiffs.push(a)}))},redoSharedState:t=>{e((e=>{const r=e.spaces[t];if(!r?.sharedState?.futureDiffs?.length)return;const a=r.sharedState.futureDiffs.pop(),n=(o=a,{...o,changes:o.changes.map((e=>({...e,oldValue:e.newValue,newValue:e.oldValue})))});var o;const i=Lt(r.sharedState,n);r.sharedState=i,r.sharedState.pastDiffs||(r.sharedState.pastDiffs=[]),r.sharedState.pastDiffs.push(a)}))},getSpaceById:e=>t().spaces[e],getAllSpaces:()=>t().spaces,getActiveSpace:()=>{const e=t();return e.activeSpaceId?e.spaces[e.activeSpaceId]:null},getActiveSpaceId:()=>t().activeSpaceId,getOpenSpaces:()=>{const e=t();return e.openSpaceIds.map((t=>e.spaces[t])).filter((e=>void 0!==e))},getSpaceErrors:()=>t().errors,getPilotMode:()=>t().pilotMode}))),$t=zt(Nt,{name:"space-storage",partialize:e=>{const t={};for(const r in e.spaces){const{sharedState:a,...n}=e.spaces[r],{pastDiffs:o,futureDiffs:i,...s}=a??{};t[r]={...n,sharedState:s}}const{activeSpaceId:r}=e;return{spaces:t,activeSpaceId:r}},merge:(e,t)=>{const r=e,a={},n=r?.spaces??{},o=t.spaces,i=new Set([...Object.keys(n),...Object.keys(o)]);for(const e of i){const t=n[e],r=o[e];if(!t&&!r)continue;const i=r?.sharedState??{},s=t?.sharedState??{};a[e]={id:t?.id??r?.id??e,name:t?.name??r?.name??`Space ${e}`,description:t?.description??r?.description??"",sharedState:{...i,...s,pastDiffs:[],futureDiffs:[]}},a[e].sharedState.color||(a[e].sharedState.color="#000000")}return{...t,activeSpaceId:r?.activeSpaceId??t.activeSpaceId,spaces:a,errors:[]}}}),Rt=$()(At($t,{name:"SpaceStore"}));const jt=new class{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}publish(e){this.listeners.forEach((t=>t(e)))}},Pt={_id:0,rootId:null,updateLayout:()=>{},errors:[],activeAreaId:null,joinPreview:null,layout:{},areas:{},viewports:{},areaToOpen:null,lastSplitResultData:null,lastLeadAreaId:null,addArea:()=>"",removeArea:()=>{},setActiveArea:()=>{},updateArea:()=>{},setAreaToOpen:()=>{},updateAreaToOpenPosition:()=>{},finalizeAreaPlacement:()=>{},cleanupTemporaryStates:()=>{},setViewports:()=>{},setRowSizes:()=>{},splitArea:()=>null,setJoinPreview:()=>{},joinOrMoveArea:()=>{},getLastSplitResult:()=>null,getActiveArea:()=>null,getAreaById:()=>{},getAllAreas:()=>({}),getAreaErrors:()=>[],getLastLeadAreaId:()=>null},Vt=()=>JSON.parse(JSON.stringify({areas:Pt}));function Ft(e,t,r){for(const a in e){const n=e[a];if("area_row"===n.type){const e=n,a=e.areas.findIndex((e=>e.id===t)),o=e.areas.findIndex((e=>e.id===r));if(-1!==a&&-1!==o&&1===Math.abs(a-o))return{parentRow:e,sourceIndex:a,targetIndex:o}}}return{parentRow:null,sourceIndex:-1,targetIndex:-1}}function Ut(e,t){if(!t)return;const r=e.layout[t];if(!r||"area_row"!==r.type)return;const a=r;if(1!==a.areas.length)return;const n=a.areas[0],o=n.id,i=We(e.layout)[t];if(i&&"area_row"===e.layout[i]?.type){const r=e.layout[i],a=r.areas.findIndex((e=>e.id===t));if(-1===a)return void console.error(`[simplifyLayoutNodeIfNeeded] Cleanup Error: Row ${t} not found in parent ${i}.`);{const e=r.areas[a].size??n.size??.5;r.areas[a]={id:o,size:e}}}else e.rootId===t?e.rootId=o:console.warn(`[simplifyLayoutNodeIfNeeded] Row ${t} has single child ${o} but no parent and is not root. Removing row.`);delete e.layout[t]}function Ht(e,t){const r=e[t];return r?"area"===r.type?t:"area_row"===r.type?0===r.areas.length?null:Ht(e,r.areas[0].id):null:null}const Bt=(e,t)=>({...Pt,addArea:t=>{let r="";return e((e=>{console.log("state",e);const a=e.screens[e.activeScreenId]?.areas;if(console.log("activeScreenAreas",a),!a)return;const n=t.id||Ct();let o;if(t.type){o=(vt._roleMap||{})[t.type]}const i={...t,id:n,role:o};if(o===mt.LEAD&&!i.spaceId){const e=Rt.getState().spaces,r=Object.keys(e);if(r.length>0){const e=Rt.getState().activeSpaceId;i.spaceId=e||r[0]}else{const e=Rt.getState().addSpace({name:`Space for ${t.type}`,sharedState:{}});e&&(i.spaceId=e)}}console.log("areaWithId",i);const s=wt(i);s.isValid?(a.areas[n]=i,a._id+=1,a.errors=[],r=n,e.lastUpdated=Date.now()):(a.errors=s.errors,console.error("Validation failed for area:",s.errors))})),console.log("generatedAreaId",r),r},removeArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;if(Object.keys(r.areas).length<=1)console.warn("Cannot remove the last area of a screen");else{delete r.areas[t],delete r.layout[t];for(const e in r.layout){const a=r.layout[e];if("area_row"===a.type){const n=a,o=n.areas.findIndex((e=>e.id===t));if(-1!==o)if(n.areas.splice(o,1),"stack"===n.orientation){if(n.activeTabId===t&&(n.activeTabId=n.areas[0]?.id||void 0),0===n.areas.length)delete r.layout[e];else if(1===n.areas.length){const t=Object.keys(r.layout).find((t=>{const a=r.layout[t];return"area_row"===a.type&&a.areas.some((t=>t.id===e))}));if(t){const a=r.layout[t],o=a.areas.findIndex((t=>t.id===e));-1!==o&&(a.areas[o]={...n.areas[0]}),delete r.layout[e]}else r.rootId===e&&(r.rootId=n.areas[0].id,delete r.layout[e])}}else 0===n.areas.length&&delete r.layout[e]}}r.rootId===t&&(r.rootId=null),r.activeAreaId===t&&(r.activeAreaId=null),r.errors=[],e.lastUpdated=Date.now(),jt.publish({type:"cleanup",areaId:t})}})),setActiveArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&(null===t||r.areas[t])&&r.activeAreaId!==t&&(r.activeAreaId=t,t&&r.areas[t]?.role===mt.LEAD&&(r.lastLeadAreaId=t),r.errors=[],e.lastUpdated=Date.now())})),updateArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.areas[t.id];if(a){const e=t.role;e&&e!==a.role&&jt.publish({type:"cleanup",areaId:a.id}),Object.assign(a,t,{role:e})}})),updateLayout:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.layout[t.id];if(a&&"area_row"===a.type){const n=JSON.stringify(a);void 0!==t.activeTabId&&(a.activeTabId=t.activeTabId),void 0!==t.areas&&(a.areas=t.areas);n!==JSON.stringify(a)&&(r.errors=[],e.lastUpdated=Date.now())}else r.errors=[`Layout with ID ${t.id} not found or not a row.`]})),setAreaToOpen:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&r.areaToOpen!==t&&(r.areaToOpen=t,e.lastUpdated=Date.now())})),updateAreaToOpenPosition:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;!r?.areaToOpen||r.areaToOpen.position.x===t.x&&r.areaToOpen.position.y===t.y||(r.areaToOpen.position=t)})),finalizeAreaPlacement:r=>e((e=>{const a=e.screens[e.activeScreenId]?.areas;if(!a)return;const n=a.areaToOpen;if(n)try{const{position:o,area:i}=n,s=i.state?.sourceId,c=s||Ct(),l=new Ke(o.x,o.y);if(!s){if(a.areas[c])return console.error(`finalizeAreaPlacement: ID conflict for new area ${c}`),void(a.areaToOpen=null);a.areas[c]={id:c,type:i.type,state:i.state},a._id+=1}const d=Re(),u=Ye(a.layout,a.rootId||"",d);let p=r?.targetId,f=r?.placement;if(!p){const e=new Ke(300,200);p=Ze(l,a,u,e)}if(!p)return s||delete a.areas[c],void(a.areaToOpen=null);const h=u[p];if(!h)return console.error(`[areaStore] finalizeAreaPlacement: Viewport not found for target ${p}. Bailing out.`),s||delete a.areas[c],void(a.areaToOpen=null);f||(f=Qe(h,l)),a.areaToOpen=null;let y=null,m=null;if(s){const e=We(a.layout),t=e[s];if(y=t,t&&"area_row"===a.layout[t]?.type){const r=a.layout[t],n=r.areas.findIndex((e=>e.id===s));if(-1!==n)if(r.areas.splice(n,1),0===r.areas.length){delete a.layout[t];Ut(a,e[t])}else{const e=r.areas.reduce(((e,t)=>e+(t.size||0)),0);if(e>0){const t=1/e;r.areas.forEach((e=>{e.size=(e.size||0)*t}))}1===r.areas.length&&(m=r.areas[0].id),Ut(a,t)}}else a.layout[s]&&delete a.layout[s];s!==c&&delete a.areas[s],a.rootId===s&&(a.rootId=null)}p&&p===y&&m&&!a.layout[p]&&(p=m);let g="stack"===f?"horizontal":"top"===f||"bottom"===f?"vertical":"horizontal";if("stack"===f){let e=p,r=a.areas[e];if("area_row"===a.layout[e]?.type&&"stack"===a.layout[e].orientation)r=a.areas[e];else if(!r&&"area_row"===a.layout[e]?.type){const t=Ht(a.layout,e);t&&(e=t,r=a.areas[e])}const n=a.areas[c];if(!n||!r)return void console.error("[finalizeAreaPlacement] Stack creation failed: Source or target area not found.");if(!(!1!==t().options?.allowStackMixedRoles)){const e=n.role||n.type&&vt._roleMap?.[n.type],t=r.role||r.type&&vt._roleMap?.[r.type];if(e&&t&&e!==t)return void(a.errors=["Impossible de stacker des areas de rles diffrents (option de configuration)"])}const o=`row-${a._id+1}`;a._id+=1;const i={type:"area_row",id:o,orientation:"stack",areas:[{id:e,size:.5},{id:c,size:.5}],activeTabId:e},s=We(a.layout)[e];if(s&&"area_row"===a.layout[s]?.type){const t=a.layout[s],r=t.areas.findIndex((t=>t.id===e));if(-1!==r){const e=t.areas[r].size;t.areas[r]={id:o,size:e}}}else a.rootId===e&&(a.rootId=o);a.layout[o]=i,a.activeAreaId=e}else{const e=We(a.layout)[p],t=e?a.layout[e]:null,r=Ct();if(a.layout[c]||(a.layout[c]={type:"area",id:c}),t&&"area_row"===t.type){const n=t.areas.findIndex((e=>e.id===p));if(-1===n)return void console.error(`[finalizeAreaPlacement] Target ${p} not found in parent ${e}`);if(t.orientation===g){const e=n+("bottom"===f||"right"===f?1:0);let r=[];r=0===e?[t.areas[0]]:e===t.areas.length?[t.areas[t.areas.length-1]]:[t.areas[e-1],t.areas[e]];const a=r.reduce(((e,t)=>e+(t.size||0)),0),o=a/(r.length+1);r.forEach((e=>e.size=o)),t.areas.splice(e,0,{id:c,size:o})}else{a._id+=1;const e={type:"area_row",id:r,orientation:g,areas:"bottom"===f||"right"===f?[{id:p,size:.5},{id:c,size:.5}]:[{id:c,size:.5},{id:p,size:.5}]};a.layout[r]=e,t.areas[n]={id:r,size:t.areas[n].size}}}else{a._id+=1;const e={type:"area_row",id:r,orientation:g,areas:"bottom"===f||"right"===f?[{id:p,size:.5},{id:c,size:.5}]:[{id:c,size:.5},{id:p,size:.5}]};a.layout[r]=e,a.rootId=r,a.layout[p]||(a.layout[p]={type:"area",id:p})}}if(a.areas[c]&&(e.screens[e.activeScreenId].areas.activeAreaId=c,a.areas[c].role===mt.LEAD&&(e.screens[e.activeScreenId].areas.lastLeadAreaId=c)),a.rootId&&d&&d.width>0&&d.height>0){const e=Ye(a.layout,a.rootId,d);a.viewports=e}else a.viewports={};e.lastUpdated=Date.now()}catch(e){a&&(a.areaToOpen=null),a.errors=[`Error finalizing area placement: ${e}`]}else a.errors=["No area to open"]})),cleanupTemporaryStates:()=>e((e=>{const t=e.screens[e.activeScreenId]?.areas;t&&(t.joinPreview||t.areaToOpen||t.lastSplitResultData)&&(t.joinPreview=null,t.areaToOpen=null,t.lastSplitResultData=null,e.lastUpdated=Date.now())})),setViewports:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&(r.viewports=t)})),setRowSizes:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const a=r.layout[t.rowId];if(a&&"area_row"===a.type){const r=a;if(r.areas.length===t.sizes.length){let a=t.sizes.reduce(((e,t)=>e+t),0);if(Math.abs(a-1)>.001&&a>0){const e=1/a;r.areas.forEach(((r,a)=>{r&&(r.size=t.sizes[a]*e)}))}else r.areas.forEach(((e,r)=>{e&&(e.size=t.sizes[r])}));e.lastUpdated=Date.now()}}})),splitArea:t=>{let r=null;return e((e=>{const a=e.screens[e.activeScreenId]?.areas;if(!a)return;const{areaIdToSplit:n,parentRowId:o,horizontal:i}=t,s=a.layout[n];if("area_row"===s.type&&"stack"===s.orientation){const e=s.areas,t=[];for(const r of e){const e=a.areas[r.id];if(!e)continue;const n=`area-${a._id+1}`;a._id+=1,a.areas[n]={id:n,type:e.type,state:{...e.state}},a.layout[n]={type:"area",id:n},t.push({id:n,size:r.size})}const c=`row-${a._id+1}`;a._id+=1;const l={id:c,type:"area_row",orientation:"stack",areas:t,activeTabId:t[0]?.id};a.layout[c]=l;const d=`row-${a._id+1}`;a._id+=1;const u={id:d,type:"area_row",orientation:i?"horizontal":"vertical",areas:[{id:n,size:.5},{id:c,size:.5}]};if(a.layout[d]=u,o){const e=a.layout[o];if("area_row"===e?.type){const t=e.areas.findIndex((e=>e.id===n));if(-1!==t){const r=e.areas[t].size??.5;e.areas[t]={id:d,size:r}}}}else a.rootId=d;return void(r={newRowId:d,separatorIndex:1})}a._id+=1;const c=a._id,l=`area-${c}`,d=`row-${c+1}`;if(a.areas[l]||a.layout[l])return void console.error(`splitArea: ID conflict for new area ${l}`);const u=a.areas[n];if(a.areas[l]={id:l,type:u?.type||s.type,state:{...u?.state},spaceId:u?.spaceId},a.layout[l]={type:"area",id:l},a.layout[d])return void console.error(`splitArea: ID conflict for new row ${d}`);const p={id:d,type:"area_row",orientation:i?"horizontal":"vertical",areas:[{id:n,size:.5},{id:l,size:.5}]};a.layout[d]=p;let f=.5;if(o){const e=a.layout[o];if("area_row"===e?.type){const t=e.areas.findIndex((e=>e.id===n));if(-1!==t)if(f=e.areas[t].size??.5,e.orientation===p.orientation){const a=p.areas.map((e=>({id:e.id,size:(e.size??.5)*f})));e.areas.splice(t,1,...a),r={newRowId:o,separatorIndex:t+1}}else e.areas[t]={id:d,size:f},r={newRowId:d,separatorIndex:1};else console.error(`splitArea Error: Area ${n} not in parent ${o}.`)}else console.error(`splitArea Error: Parent ${o} not found or not row.`)}else a.rootId===n?(a.rootId=d,r={newRowId:d,separatorIndex:1}):console.error(`splitArea Error: Area ${n} has no parent and is not root.`);a._id=c+2,a.lastSplitResultData=r,function(e){if(!e)return;let t=e;for(;t;){const e=a.layout[t];Ut(a,t);if(t=We(a.layout)[t],!e||a.layout[e.id])break}}(o),function e(t,r=null){if(!t)return;const n=a.layout[t];if(!n||"area_row"!==n.type)return;let o=!1;for(let e=0;e<n.areas.length;){const t=n.areas[e].id,r=a.layout[t];if(r&&"area_row"===r.type&&r.orientation===n.orientation){const i=r,s=n.areas[e].size??1/n.areas.length,c=i.areas.reduce(((e,t)=>e+(t.size??0)),0)||1,l=i.areas.map((e=>({id:e.id,size:(e.size??1/i.areas.length)*s/c})));n.areas.splice(e,1,...l.filter((e=>!n.areas.some((t=>t.id===e.id))))),delete a.layout[t],o=!0}else e++}for(const r of n.areas)e(r.id,t);o&&e(t,r)}(a.rootId),function(){const e=new Set;!function t(r){if(!r||e.has(r))return;e.add(r);const n=a.layout[r];if(n&&"area_row"===n.type)for(const e of n.areas)t(e.id)}(a.rootId);for(const t in a.layout){const r=a.layout[t];r&&"area_row"===r.type&&!e.has(t)&&delete a.layout[t]}}(),e.lastUpdated=Date.now()})),r},setJoinPreview:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;r&&r.joinPreview!==t&&(r.joinPreview=t,e.lastUpdated=Date.now())})),joinOrMoveArea:t=>e((e=>{const r=e.screens[e.activeScreenId]?.areas;if(!r)return;const{sourceAreaId:a,targetAreaId:n}=t,{parentRow:o,sourceIndex:i,targetIndex:s}=Ft(r.layout,a,n);if(!o||"area_row"!==o.type)return r.errors=[`Could not find adjacent areas ${a}/${n} in the same row.`],void(r.joinPreview=null);const c=o.id,l=We(r.layout)[c],d=JSON.parse(JSON.stringify(o)),u=s>i?1:-1,p=i;try{const e=et(d,p,u),{area:t,removedAreaId:a}=e,n=function(e,t){const r=new Set,a=[t],n=new Set;for(;a.length>0;){const t=a.shift();if(n.has(t))continue;n.add(t);const o=e[t];if(o)if("area"===o.type)r.add(t);else if("area_row"===o.type){const e=o;e.areas&&Array.isArray(e.areas)&&e.areas.forEach((e=>{e&&e.id&&a.push(e.id)}))}}return"area"===e[t]?.type&&r.add(t),r}(r.layout,a);if(n.add(a),n.forEach((e=>{delete r.areas[e],delete r.layout[e]})),t.id===c&&"area_row"===t.type){const e=t;if(r.layout[c]=e,e.areas){const t=e.areas.reduce(((e,t)=>e+(t.size||0)),0);if(t>0){const r=1/t;e.areas.forEach((e=>{e.size=(e.size||0)*r}))}}1===e.areas?.length&&Ut(r,c)}else if(delete r.layout[c],r.layout[t.id]||"area_row"!==t.type&&(r.layout[t.id]={type:"area",id:t.id}),l&&"area_row"===r.layout[l]?.type){const e=r.layout[l],a=e.areas.findIndex((e=>e.id===c));if(-1!==a){const r=e.areas[a].size??.5;e.areas[a]={id:t.id,size:r}}else console.error(`[joinOrMoveArea] Cleanup Error: Row ${c} not found in grandparent ${l}.`)}else r.rootId===c&&(r.rootId=t.id);r.activeAreaId&&n.has(r.activeAreaId)&&("area"===t.type?r.activeAreaId=t.id:r.activeAreaId=null),r.errors=[],r.joinPreview=null}catch(e){console.error("Error during joinOrMoveArea:",e),r.errors=[e instanceof Error?e.message:String(e)],r.joinPreview=null}e.lastUpdated=Date.now()})),getLastSplitResult:()=>{const e=t().screens[t().activeScreenId]?.areas;return e?e.lastSplitResultData:null},getActiveArea:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r&&r.activeAreaId?r.areas[r.activeAreaId]:null},getAreaById:e=>{const r=t(),a=r.screens[r.activeScreenId]?.areas;return a?a.areas[e]:void 0},getAllAreas:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?r.areas:{}},getAreaErrors:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?r.errors:[]},getLastLeadAreaId:()=>{const e=t(),r=e.screens[e.activeScreenId]?.areas;return r?.lastLeadAreaId||null},findParentRowAndIndices:Ft}),Kt=Math.random().toString(36).slice(2),Jt=$()(Ee(zt(At(((e,t)=>{const r=Bt(e,t);return{screens:{1:Vt()},activeScreenId:"1",nextScreenId:2,options:{allowStackMixedRoles:!0},lastUpdated:Date.now(),layout_preset:[],addScreen:()=>e((e=>{const t=e.nextScreenId.toString();e.screens[t]=Vt();const r=`area-default-${t}-0`,a=e.screens[t].areas;a.areas[r]={id:r,type:"text-note",state:{content:"New Screen"}},a.layout={[r]:{type:"area",id:r}},a.rootId=r,a._id=1,a.activeAreaId=r,e.nextScreenId+=1,e.activeScreenId=t,e.lastUpdated=Date.now()})),switchScreen:t=>e((e=>{e.screens[t]&&e.activeScreenId!==t?(e.activeScreenId=t,e.lastUpdated=Date.now()):e.screens[t]||console.warn(`Attempted to switch to non-existent screen ID: ${t}`)})),removeScreen:t=>e((e=>{if(Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).length<=1&&!e.screens[t]?.isDetached)return void console.warn("Cannot remove the last classic screen");if(!e.screens[t])return void console.warn(`Attempted to remove non-existent screen ID: ${t}`);delete e.screens[t];const r=Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).reduce(((e,t)=>Math.max(e,parseInt(t))),0);if(e.nextScreenId=r+1,e.activeScreenId===t){const t=Object.keys(e.screens).filter((t=>!e.screens[t]?.isDetached)).sort(((e,t)=>parseInt(e)-parseInt(t)));e.activeScreenId=t[0]||Object.keys(e.screens)[0]||"1"}const a=new URL(window.location.href);a.searchParams.get("screen")===t&&(a.searchParams.delete("screen"),window.history.replaceState({},"",a.toString())),e.lastUpdated=Date.now()})),duplicateScreen:t=>e((e=>{if(!e.screens[t])return void console.warn(`Attempted to duplicate non-existent screen ID: ${t}`);const r=e.nextScreenId.toString(),a=e.screens[t];e.screens[r]=JSON.parse(JSON.stringify(a)),e.nextScreenId+=1,e.activeScreenId=r,e.lastUpdated=Date.now()})),detachArea:t=>e((e=>{const r=e.getAreaById(t);if(!r)return void console.warn(`Area ${t} not found`);const a=`detached-${e.nextScreenId}`;e.nextScreenId+=1,e.screens[a]={...Vt(),areas:{...Vt().areas},isDetached:!0,detachedFromAreaId:t};const n=e.screens[a].areas;n.areas[t]={...r},n.layout={[t]:{type:"area",id:t}},n.rootId=t,n.activeAreaId=t;const o=e.screens[e.activeScreenId];if(o){delete o.areas.areas[t];for(const e in o.areas.layout){const r=o.areas.layout[e];"area_row"===r.type&&(r.areas=r.areas.filter((e=>e.id!==t)))}delete o.areas.layout[t],o.areas.rootId===t&&(o.areas.rootId=null);for(const e in o.areas.layout){const t=o.areas.layout[e];"area_row"===t.type&&1===t.areas.length&&Ut(o.areas,e)}}const i=["width=800","height=600","menubar=no","toolbar=no","location=no","status=no","scrollbars=yes","resizable=yes"].join(",");window.open(`?screen=${a}`,a,i),e.lastUpdated=Date.now()})),addArea:r.addArea,removeArea:r.removeArea,setActiveArea:r.setActiveArea,updateArea:r.updateArea,updateLayout:r.updateLayout,setAreaToOpen:r.setAreaToOpen,updateAreaToOpenPosition:r.updateAreaToOpenPosition,finalizeAreaPlacement:r.finalizeAreaPlacement,cleanupTemporaryStates:r.cleanupTemporaryStates,setViewports:r.setViewports,setRowSizes:r.setRowSizes,splitArea:r.splitArea,setJoinPreview:r.setJoinPreview,joinOrMoveArea:r.joinOrMoveArea,getLastSplitResult:r.getLastSplitResult,getActiveArea:r.getActiveArea,getAreaById:r.getAreaById,getAllAreas:r.getAllAreas,getAreaErrors:r.getAreaErrors,findParentRowAndIndices:Ft}}),{name:"KarmycRootStore"}),{name:"karmycRootState",partialize:e=>({screens:e.screens,activeScreenId:e.activeScreenId,nextScreenId:e.nextScreenId,lastUpdated:e.lastUpdated,options:e.options,layout_preset:e.layout_preset}),storage:Ot((()=>localStorage)),skipHydration:!1,onRehydrateStorage:()=>e=>{e||(console.warn("[KarmycStore] tat invalide aprs hydratation, rinitialisation..."),Jt.setState({screens:{1:Vt()},activeScreenId:"1",nextScreenId:2,lastUpdated:Date.now(),options:{allowStackMixedRoles:!0}}))}}))),qt=(e={})=>{const t=Jt.getState(),r={...t.options,...e};t.screens&&0!==Object.keys(t.screens).length?Jt.setState({options:r}):Jt.setState({screens:{1:Vt()},activeScreenId:"1",nextScreenId:2,lastUpdated:Date.now(),options:r})};if("undefined"!=typeof window){let e=null;const t=50;window.addEventListener("storage",(r=>{if("karmycRootState"===r.key){const r=localStorage.getItem("karmycRootState");if(!r)return;const a=JSON.parse(r);if(a?.state?.windowId===Kt)return;const n=Jt.getState(),o=a?.state?.screens||{},i=a?.state?.lastUpdated||0,s=n.lastUpdated||0,c=Object.keys(o).some((e=>{const t=o[e],r=n.screens[e];return!r||JSON.stringify(t)!==JSON.stringify(r)}));e&&clearTimeout(e),e=setTimeout((()=>{c&&i>s&&Jt.setState((e=>({...e,screens:o,lastUpdated:i}))),e=null}),t)}}))}const Wt={isVisible:!1,position:{x:0,y:0},items:[],errors:[],targetId:void 0,metadata:void 0,menuClassName:"menu",customContextMenuContent:null,menuType:void 0},Gt=$()(Ee((e=>({...Wt,openContextMenu:t=>e((e=>{const{position:r,items:a,targetId:n,metadata:o}=t,i=t.menuClassName,s=St(r);if(!s.isValid)return console.warn("Position validation failed:",s.errors),void(e.errors=s.errors);const c=a.map((e=>bt(e))).filter((e=>!e.isValid));if(c.length>0)return console.warn("Items validation failed:",c),void(e.errors=c.flatMap((e=>e.errors||["Unknown item validation error"])));e.isVisible=!0,e.position=r,e.items=a,e.targetId=n,e.metadata=o,e.menuClassName=i||e.menuClassName||"menu",e.errors=[],e.menuType="default"})),openCustomContextMenu:t=>e((e=>{const{position:r,targetId:a,metadata:n,component:o}=t,i=t.menuClassName;if(!r)return console.warn("Aucune position fournie  openCustomContextMenu"),void(e.errors=["Aucune position fournie au menu contextuel"]);const s=St(r);if(!s.isValid)return console.warn("Position validation failed:",s.errors),void(e.errors=s.errors);e.isVisible=!0,e.position=r,e.targetId=a,e.metadata=n,e.errors=[],e.menuClassName=i+" menu",e.customContextMenuContent=o,e.menuType="custom"})),closeContextMenu:()=>e((e=>{Object.assign(e,Wt),e.menuType=void 0})),updateContextMenuPosition:t=>e((e=>{const r=St(t);r.isValid?(e.position=t,e.errors=[]):e.errors=r.errors})),updateContextMenuItems:t=>e((e=>{const r=t.map((e=>bt(e))).filter((e=>!e.isValid));r.length>0?e.errors=r.flatMap((e=>e.errors||["Unknown item validation error"])):(e.items=t,e.errors=[])})),clearErrors:()=>e((e=>{e.errors=[]}))}))));class Xt{constructor(e={}){this.plugins=new Map,this.validators=new Map,this.actionHandlers=new Map,this.menuActionsByType=new Map,this.options={...e},e.defaultValidators&&(this.validators=new Map(Object.entries(e.defaultValidators)))}registerPlugin(e){this.plugins.set(e.id,e),e.onRegister&&e.onRegister()}unregisterPlugin(e){const t=this.plugins.get(e);t?.onUnregister&&t.onUnregister(),this.plugins.delete(e)}registerValidator(e,t){const r=this.validators.get(e)||[];this.validators.set(e,[...r,t])}unregisterValidators(e){this.validators.delete(e)}registerActionHandler(e,t,r){if(this.actionHandlers.set(e,{handler:t,metadata:r}),r?.menuType){const t=this.menuActionsByType.get(r.menuType)||new Set;t.add(e),this.menuActionsByType.set(r.menuType,t)}}unregisterActionHandler(e){const t=this.actionHandlers.get(e);if(t?.metadata?.menuType){const r=this.menuActionsByType.get(t.metadata.menuType);r&&(r.delete(e),0===r.size&&this.menuActionsByType.delete(t.metadata.menuType))}this.actionHandlers.delete(e)}validateAction(e){const t=this.validators.get(e.type)||[];for(const r of t){const t=r(e);if(!t.valid)return t}return{valid:!0}}handleAction(e){const t=this.validateAction(e);if(!t.valid)return void console.warn(`Invalid action: ${t.message}`);const r=Array.from(this.plugins.values()).sort(((e,t)=>t.priority-e.priority));for(const t of r)if(null===t.actionTypes||t.actionTypes.includes(e.type))try{t.handler(e)}catch(e){console.error(`Error in plugin ${t.id}:`,e)}}executeAction(e,t){const r=this.actionHandlers.get(e);return!!r?.handler&&(r.handler(t),!0)}getMenuActions(e){const t=this.menuActionsByType.get(e)||new Set;return Array.from(t).map((e=>{const t=this.actionHandlers.get(e);return t?{id:e,...t}:null})).filter((e=>null!==e&&void 0!==e.metadata)).sort(((e,t)=>(e.order||0)-(t.order||0)))}}const Yt=new Xt,Zt={initialize:e=>{e.actions.plugins.forEach((e=>{Yt.registerPlugin(e)})),e.actions.validators.forEach((({actionType:e,validator:t})=>{Yt.registerValidator(e,t)}))}},Qt=e=>{const t=Jt((e=>e.setAreaToOpen)),r=Jt((e=>e.updateAreaToOpenPosition)),a=Jt((e=>e.finalizeAreaPlacement)),c=Jt((e=>e.cleanupTemporaryStates)),l=Jt((e=>e.updateLayout)),d=Jt((e=>e.screens[e.activeScreenId]?.areas.layout)),u=Jt((e=>e.screens[e.activeScreenId]?.areas.rootId)),p=Jt((e=>e.screens[e.activeScreenId]?.areas.areas)),f=Jt((e=>e.screens[e.activeScreenId]?.areas.areaToOpen)),h=Jt((e=>e.screens[e.activeScreenId]?.areas.viewports)),y=n(null),m=n(performance.now()),g=n(void 0),v=n(!1),w=o((()=>Ke.new(300,200)),[]),S=o((()=>{if(!f||!u||!h||0===Object.keys(h).length)return null;const e=Ke.new(f.position.x,f.position.y);return Ze(e,{layout:d},h,w)}),[f?.position.x,f?.position.y,d,u,p,h,w]),b=o((()=>S?h[S]:null),[S,h]),I=o((()=>{if(!f||!b)return"stack";const e=Ke.new(f.position.x,f.position.y);return Qe(b,e)}),[b,f?.position.x,f?.position.y,f]),_=i(((e,t)=>{v.current||(v.current=!0,g.current=requestAnimationFrame((()=>{r({x:e,y:t}),v.current=!1})))}),[r]),A=i((e=>{e.preventDefault(),_(e.clientX,e.clientY)}),[_]),x=i((r=>{if(!e?.type||!e?.id||!e?.state)return void console.warn("useAreaDragAndDrop - Missing required params for handleDragStart");const{type:a,id:n,state:o}=e;document.body.style.userSelect="none";const i=r.currentTarget.getBoundingClientRect();y.current={startX:r.clientX-i.left,startY:r.clientY-i.top,sourceId:n},m.current=performance.now();const s=document.createElement("div");s.style.width="1px",s.style.height="1px",s.style.position="fixed",s.style.top="-1px",s.style.left="-1px",s.style.opacity="0.01",s.style.pointerEvents="none",document.body.appendChild(s),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",JSON.stringify({type:"menubar",areaType:a,areaId:n})),r.dataTransfer.setDragImage(s,0,0),requestAnimationFrame((()=>{document.body.contains(s)&&document.body.removeChild(s),t({position:{x:r.clientX,y:r.clientY},area:{type:a,state:{...o,sourceId:n}}})})),document.addEventListener("dragover",A)}),[e,t,A]),O=i((e=>{e.dataTransfer.types.includes("karmyc/tab-drag-source")||(e.preventDefault(),e.dataTransfer.dropEffect="move")}),[]),E=i((e=>{let t;try{const r=e.dataTransfer.getData("text/plain");r&&(t=JSON.parse(r))}catch(e){return console.warn("[DropZone] handleDrop - Could not parse drag data",e),void c()}if(t&&"tab"===t.type)return console.warn('[DropZone] handleDrop - Received "tab" type drag, assuming handled by AreaTabs. Aborting here.'),void c();if(e.preventDefault(),e.stopPropagation(),!t)return console.warn("[DropZone] handleDrop - Invalid or missing source data type after tab check"),void c();const r=t.areaId;let n=null;const o=document.elementsFromPoint(e.clientX,e.clientY);for(const e of o){if(e.classList.contains("global-drag-overlay")||e.classList.contains("areaToOpenContainer"))continue;const t=e.closest("[data-areaid]");if(t){const e=t.dataset.areaid;if(e&&"-1"!==e&&e!==r){if(!Object.values(d).some((t=>"area_row"===t.type&&"stack"===t.orientation&&t.areas.some((t=>t.id===e))))){n=e;break}}}}if(!n)return console.warn("[DropZone] handleDrop: no targetAreaId found"),void c();try{_(e.clientX,e.clientY);if(Object.values(d).some((e=>"area_row"===e.type&&"stack"===e.orientation&&e.id===n))&&"stack"===I){const e=Object.values(d).find((e=>"area_row"===e.type&&"stack"===e.orientation&&e.id===n));if(e){const t=Object.values(d).find((e=>"area_row"===e.type&&e.areas.some((e=>e.id===r))));if(t){const e=t.areas.filter((e=>e.id!==r)),a=e.reduce(((e,t)=>e+t.size),0),n=e.map((t=>({...t,size:a>0?t.size/a:1/e.length})));l({...t,areas:n})}const a={...e,areas:[...e.areas,{id:r,size:1}]};l(a),Jt.getState().updateArea({id:r,isLocked:!0}),c()}}else"stack"===I&&(Jt.getState().updateArea({id:r,isLocked:!0}),Jt.getState().updateArea({id:n,isLocked:!0})),a({targetId:n,placement:I}),c()}catch(e){console.error("[DropZone] handleDrop - Error during finalization:",e),c()}}),[c,a,_,I,d,l]),z=i((()=>{if(document.body.style.userSelect="",!y.current)return;g.current&&cancelAnimationFrame(g.current);performance.now()-m.current<100||(y.current=null,c(),document.removeEventListener("dragover",A))}),[c,A]);return s((()=>()=>{g.current&&cancelAnimationFrame(g.current)}),[]),{handleDragStart:x,handleDragOver:O,handleDragEnd:z,handleDrop:E,areaToOpenTargetId:S,areaToOpenTargetViewport:b,calculatedPlacement:I}},er=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,t,r)=>r?r.toUpperCase():t.toLowerCase())))(e);return t.charAt(0).toUpperCase()+t.slice(1)},tr=(...e)=>e.filter(((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t)).join(" ").trim(),rr=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var ar={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=c((({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,iconNode:i,...s},c)=>l("svg",{ref:c,...ar,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:tr("lucide",n),...!o&&!rr(s)&&{"aria-hidden":"true"},...s},[...i.map((([e,t])=>l(e,t))),...Array.isArray(o)?o:[o]]))),or=(e,t)=>{const r=c((({className:r,...a},n)=>{return l(nr,{ref:n,iconNode:t,className:tr(`lucide-${o=er(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...a});var o}));return r.displayName=er(e),r},ir=or("app-window",[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]]),sr=or("arrow-big-down",[["path",{d:"M15 6v6h4l-7 7-7-7h4V6h6z",key:"1thax2"}]]),cr=or("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),lr=or("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),dr=or("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),ur=or("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),pr=or("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),fr=or("file-up",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),hr=or("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),yr=or("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),mr=or("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),gr=or("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),vr=or("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),wr=or("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),Sr=or("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),br=or("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ir=or("trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),_r=or("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);
/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Ar(e,t,r){s((()=>(Yt.registerActionHandler(e,t,r),()=>{Yt.unregisterActionHandler(e)})),[e,t,r])}const xr=$((e=>({t:null,setTranslationFunction:t=>e({t:t})}))),Or=()=>{const{t:e}=xr();return{t:(t,r)=>e?e(t,r):r}},Er=()=>{const{t:a}=Or(),n=Gt((e=>e.isVisible&&"custom"===e.menuType)),o=Gt((e=>e.position)),i=Gt((e=>e.closeContextMenu)),s=Gt((e=>e.targetId))||"",c=vt._roleMap||{},l=Array.from(vt.getRegisteredTypes()),d=Rt((e=>e.spaces)),u=Rt((e=>e.activeSpaceId)),p=[{role:mt.LEAD,title:a("area.role.lead","LEAD"),items:[]},{role:mt.FOLLOW,title:a("area.role.follow","FOLLOW"),items:[]},{role:mt.SELF,title:a("area.role.self","SELF"),items:[]}];l.forEach((e=>{const t=c[e]||mt.SELF,r=p.find((e=>e.role===t));r&&r.items.push(e)}));return Ar("switch-area-type",(e=>{e?.areaId&&e?.newType&&console.log(a("area.switch.log",`Switching area ${e.areaId} to type ${e.newType}`))})),e(f,{anchorPoint:o,state:n?"open":"closed",onClose:i,transition:!0,direction:"right",menuClassName:"switch-area-type-context-menu",children:p.map((n=>t("div",{style:{flex:1,margin:"0 8px",width:"250px"},children:[e("div",{style:{padding:"4px 0 16px",marginBottom:8,textAlign:"left",borderBottom:"2px ridge #444",paddingBottom:4},children:n.title}),n.items.map((r=>{const n=vt.getIcon(r);return t("div",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:4},onClick:()=>{return e=r,Jt.getState().updateArea({id:s,type:e}),void(i&&i());var e},onMouseDown:e=>e.preventDefault(),children:[e(n,{style:{width:16,height:16}}),a(`area.type.${r}`,vt.getDisplayName(r))]},r)})),n.role===mt.LEAD&&t(r,{children:[e("div",{style:{padding:"4px 0 16px",marginTop:16,marginBottom:8,textAlign:"left",borderBottom:"2px ridge #444",paddingBottom:4},children:a("area.spaces.title","SPACES")}),Object.entries(d).map((([r,n])=>t("div",{"data-testid":"space-switch-button",style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",marginBottom:4,backgroundColor:r===u?"rgba(255, 255, 255, 0.1)":"transparent",padding:"4px 8px",borderRadius:4},onClick:()=>(e=>{Jt.getState().updateArea({id:s,spaceId:e}),i&&i()})(r),onMouseDown:e=>e.preventDefault(),children:[e("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:n.sharedState?.color||"#666"}}),a(`space.${r}.name`,n.name)]},r)))]})]},n.role)))})},zr=({state:a,type:o,id:i,style:s})=>{const{t:c}=Or(),[u,p]=d(!1),f=Jt((e=>e.updateArea)),h=Jt((e=>e.getAreaById(i)?.isLocked||!1)),y=Jt((e=>e.options?.manageableAreas??!0)),m=Jt((e=>e.getAreaById(i))),g=m?.enableFullscreen??!1,v=vt._supportFullscreenMap?.[o]??!1,{handleDragStart:w,handleDragOver:S,handleDrop:b,handleDragEnd:I}=Qt({type:o,id:i,state:a}),_=Gt((e=>e.openCustomContextMenu)),A=n(null),x=Rt((e=>e.getSpaceById(m?.spaceId||"")));let O=x?.sharedState?.color||"#0000ff";if("FOLLOW"===m?.role){const e=Jt.getState().activeScreenId,t=Jt.getState().screens[e]?.areas.lastLeadAreaId,r=Jt.getState().screens[e]?.areas.areas||{},a=t?r[t]:null,n=a?.spaceId;if(n){const e=Rt.getState().spaces[n];e&&e.sharedState?.color&&(O=e.sharedState.color)}}return t("div",{className:"select-area-button",draggable:y&&!h&&!g,title:c("area.drag","Move area"),onDragStart:e=>{y&&!g&&(p(!0),w(e),requestAnimationFrame((()=>{A.current&&(A.current.style.pointerEvents="none",A.current.style.opacity="0.5")})))},onDragOver:e=>{y&&!g&&S(e)},onDrop:e=>{y&&!g&&(u||b(e))},onDragEnd:()=>{y&&!g&&(p(!1),A.current.style.pointerEvents="auto",A.current.style.opacity="1",I())},onContextMenu:t=>{y&&!g&&(t.preventDefault(),(()=>{if(y&&A.current){const t=A.current.getBoundingClientRect();_({targetId:i,position:{x:t.left,y:t.top},component:e(Er,{})})}})())},style:{cursor:!y||g||h?"default":u?"grabbing":"grab","--space-color":O,pointerEvents:"auto",height:"30px",...s},ref:A,children:[t("div",{className:"select-area-button__main",children:[l(vt.getIcon(o),{className:"select-area-button__icon",style:{color:O}}),vt.getDisplayName(o)]}),t("div",{className:"select-area-button__action-icons",children:[y&&!h&&t(r,{children:[e("button",{className:"select-area-icons select-area-button__detach",onClick:e=>{y&&(e.stopPropagation(),Jt.getState().detachArea(i))},title:c("area.detach","Detach area"),children:e(cr,{})}),e("button",{className:"select-area-icons select-area-button__close",onClick:e=>{y&&(e.stopPropagation(),Jt.getState().removeArea(i))},title:c("area.close","Close area"),children:e(_r,{})})]}),y&&t(r,{children:[v&&e("button",{className:"select-area-icons select-area-button__fullscreen",onClick:e=>{if(!y)return;e.stopPropagation();const t=document.querySelector(`[data-areaid="${i}"]`);if(t)if(g)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),f({id:i,enableFullscreen:!1,previousLayout:void 0,previousRootId:void 0});else{const e=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.layout,r=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.rootId;f({id:i,enableFullscreen:!0,previousLayout:e,previousRootId:r}),t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen();const a=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||(f({id:i,enableFullscreen:!1,previousLayout:void 0,previousRootId:void 0}),document.removeEventListener("fullscreenchange",a),document.removeEventListener("webkitfullscreenchange",a),document.removeEventListener("msfullscreenchange",a))};document.addEventListener("fullscreenchange",a),document.addEventListener("webkitfullscreenchange",a),document.addEventListener("msfullscreenchange",a)}},title:c("area.fullscreen","Toggle fullscreen"),children:e(g?wr:vr,{})}),e("button",{className:"select-area-icons select-area-button__lock-icon "+(h?"locked":""),onClick:e=>{e.stopPropagation(),f({id:i,isLocked:!h})},title:c("area.lock","Lock/Unlock area"),children:e(h?gr:mr,{})})]})]})]})},kr=a.memo((({rowId:t,row:r,areas:a})=>{const n=Jt((e=>e.updateLayout)),o=Jt((e=>e.setActiveArea)),[i,s]=d({targetId:null,position:null}),[c,l]=d(null),u=()=>{l(null),s({targetId:null,position:null})};return e("div",{className:"area-tabs",onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||s({targetId:null,position:null})},children:r.areas.map((({id:d})=>{const p=a[d];if(!p)return null;const f=r.activeTabId===d,h=i.targetId===d?`drop-indicator-${i.position}`:"";return e("div",{className:`area-tab ${f?"area-tab--active":""} ${h} ${c===d?"is-dragging-source":""}`,onClick:()=>(e=>{const r=a[e];r&&(n({id:t,activeTabId:e}),o(e),r.spaceId&&Rt.getState().setActiveSpace(r.spaceId))})(d),draggable:p.isLocked,onDragStart:e=>p.isLocked?((e,r)=>{e.stopPropagation(),l(r),e.dataTransfer.setData("text/plain",JSON.stringify({type:"tab",areaId:r,sourceRowId:t})),e.dataTransfer.setData("karmyc/tab-drag-source","true"),e.dataTransfer.effectAllowed="move"})(e,d):void 0,onDragOver:e=>((e,t)=>{if(e.dataTransfer.types.includes("karmyc/tab-drag-source")){e.preventDefault(),e.dataTransfer.dropEffect="move";const r=e.currentTarget.getBoundingClientRect(),a=r.left+r.width/2,n=e.clientX<a?"before":"after";i.targetId===t&&i.position===n||s({targetId:t,position:n})}})(e,d),onDrop:e=>((e,a)=>{try{const o=e.dataTransfer.getData("text/plain");if(!o)return void s({targetId:null,position:null});const c=JSON.parse(o);if("tab"===c.type&&c.sourceRowId===t){e.preventDefault(),e.stopPropagation();const o=c.areaId,{targetId:l,position:d}=i;if(o===a&&l!==a)return void s({targetId:null,position:null});if(o===a&&l===a&&null===d)return void s({targetId:null,position:null});const u=[...r.areas],p=u.findIndex((e=>e.id===o)),f=r.areas.findIndex((e=>e.id===a));if(-1===p||-1===f)return void s({targetId:null,position:null});const[h]=u.splice(p,1);let y=f;p<f&&y--,o===a&&(y=p);let m=y;l===a&&"after"===d&&(m=y+1),u.splice(m,0,h),n({id:t,areas:u,activeTabId:r.activeTabId})}}catch(e){console.error("Error handling tab drop:",e)}s({targetId:null,position:null}),l(null)})(e,d),onDragEnd:u,"data-areaid":d,children:e(zr,{id:d,state:p.state,type:p.type})},d)}))})}));const Dr=(e,t,r,a,n,o)=>{const i=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.isDetached;if(i)return;e.preventDefault();const s=Ke.fromEvent(e);let c=s,l=null,d=null;const u=()=>{const e=Jt.getState();return e.screens[e.activeScreenId]?.areas},p=u();if(!p)return void console.error("handleAreaDragFromCorner: Could not get active screen state.");const f=p.layout,h=p.rootId;if(!h||!f||!f[h])return void console.error("handleAreaDragFromCorner: Invalid initial active screen state (rootId or layout missing/invalid)");const y=We(f)[r];function m(e){if((e?a.width:a.height)<64)return g(),void(l&&l(c));const o=Jt.getState().getAreaById(r);if(!o)return void console.error("Source area data not found");const i=Jt.getState().splitArea({areaIdToSplit:r,parentRowId:y,horizontal:e,corner:t});if(!i||!i.newRowId||void 0===i.separatorIndex)return console.error("Failed to split area or get split result info. Switching to join/move."),g(),void(l&&l(c));const{newRowId:s,separatorIndex:p}=i;setTimeout((()=>{const e=u();if(!e)return void console.error("Failed to get active screen state after split");const t=e.layout[s];if(!t||"area_row"!==t.type)return void console.error(`Split seemed successful but row ${s} not found or not a row in active screen state.`);if(!t.areas.every((e=>e.size>=.1)))return void console.error("Invalid sizes detected in new row layout");const r=t.areas[p].id;Jt.getState().updateArea({id:r,type:o.type,state:{...o.state}});const a=t.areas.map((()=>1/t.areas.length));Jt.getState().setRowSizes({rowId:s,sizes:a}),function(e,t,r){const a="horizontal"===e.orientation,n=e.areas[t-1]?.id,o=e.areas[t]?.id;if(!n||!o)return console.error("Cannot set up resize handlers: invalid separator index or missing areas.",{rowToResize:e,sepIndex:t}),l=null,void(d=()=>{});const i=e.areas.map((e=>e.size)),s=i[t-1]+i[t];if(s<=0)return console.error("Invalid total size for resize operation"),l=null,void(d=()=>{});let c=null;const p=75;let f=.5;const h=t=>{const r=.1;if(t.some((e=>e<r))){console.warn("Invalid sizes detected, adjusting to minimum values");const a=t.map((e=>Math.max(e,r))),n=a.reduce(((e,t)=>e+t),0),o=a.map((e=>e/n));Jt.getState().setRowSizes({rowId:e.id,sizes:o})}else Jt.getState().setRowSizes({rowId:e.id,sizes:t})},y=e=>{null!==c&&clearTimeout(c),c=setTimeout((()=>{c=null,h(e)}),p)},m=()=>{null!==c&&(clearTimeout(c),c=null)};l=i=>{const c=u();if(!c)return;const l=c.layout,d=l[e.id],p=c.rootId;if(!d||!p||"area_row"!==d.type)return void console.warn("Resize handler: Row or rootId not found/invalid in current active screen state.");const h=Ye(l,p,Re()),m=h[n],g=h[o];if(!m||!g)return void console.warn("Resize handler: Viewports for adjacent areas not found.");const v=a?{left:m.left,top:m.top,width:m.width+g.width,height:m.height}:{left:m.left,top:m.top,width:m.width,height:m.height+g.height},w=a?v.width:v.height;if(w<=0)return void console.warn("Resize handler: Shared viewport size is zero or negative.");const S=Math.max(.1,De/w),b=a?v.left:v.top,I=b+w,_=a?i.x:i.y,A=He(S,1-S,(_-b)/(I-b));f=A,r({rowId:e.id,separatorIndex:t,t:A});const x=A*s,O=(1-A)*s,E=d.areas.map(((e,r)=>r===t-1?x:r===t?O:e.size)),z=.1;if(E.some((e=>e<z))){console.warn("Invalid sizes detected in preview, adjusting to minimum values");const e=E.map((e=>Math.max(e,z))),t=e.reduce(((e,t)=>e+t),0),r=e.map((e=>e/t));y(r)}else{const e=E.reduce(((e,t)=>e+t),0);if(e>0){const t=E.map((t=>t/e));y(t)}else console.warn("Resize handler: Debounce skipped, zero total size.")}},d=()=>{m();const a=f*s,n=(1-f)*s,o=u()?.layout[e.id];if(!o||"area_row"!==o.type)return console.error("Resize mouseup: Cannot find final row state."),r(null),l=null,void(d=null);const i=o.areas.map(((e,r)=>r===t-1?a:r===t?n:e.size)),c=i.reduce(((e,t)=>e+t),0);let p=i;if(c>0)p=i.map((e=>e/c));else{console.error("Resize mouseup: Final total size is zero, cannot normalize. Using equal distribution as fallback.");const e=o.areas.length;p=Array(e).fill(1/e)}h(p),setTimeout((()=>r(null)),0),l=null,d=null}}(t,p,n),l&&l(c)}),0)}function g(){const e=y?f[y]:null;if(!e||"area_row"!==e.type)return console.error("Join/Move setup: Source area does not have a valid parent row. Cannot determine siblings."),l=null,void(d=()=>{Jt.getState().setJoinPreview(null)});const t=e.areas.findIndex((e=>e.id===r));if(-1===t)return console.error(`Join/Move setup: Source area ${r} not found within its supposed parent row ${y}.`),l=null,void(d=()=>{Jt.getState().setJoinPreview(null)});const a=e.areas.filter(((e,r)=>r!==t)).map((e=>e.id)),n=[t>0?e.areas[t-1].id:null,t<e.areas.length-1?e.areas[t+1].id:null].filter((e=>null!==e));l=t=>{const o=u();if(!o)return;const i=o.layout,s=o.rootId;if(!s)return;const c=Ye(i,s,Re());let l=null,d=null;for(const a of n){const n=c[a];if(n&&t.x>=n.left&&t.x<=n.left+n.width&&t.y>=n.top&&t.y<=n.top+n.height){l=a;const t=c[r];if(t){const r=n,a=r.left+r.width/2-(t.left+t.width/2),o=r.top+r.height/2-(t.top+t.height/2);d="horizontal"===e.orientation?a>0?"e":"w":o>0?"s":"n"}break}}l&&d?Jt.getState().setJoinPreview({areaId:l,movingInDirection:d,eligibleAreaIds:a}):null!==u()?.joinPreview&&Jt.getState().setJoinPreview(null)},d=()=>{const e=u(),t=e?.joinPreview;t&&t.areaId&&t.movingInDirection&&n.includes(t.areaId)&&Jt.getState().joinOrMoveArea({sourceAreaId:r,targetAreaId:t.areaId,direction:t.movingInDirection}),null!==u()?.joinPreview&&Jt.getState().setJoinPreview(null),l=null,d=null}}let v=!1;const w=e=>{const r=new Ke(e.x-s.x,e.y-s.y);if(r.length()<10)return;window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",b);const a=function(e,t){const r=Math.abs(t.x),a=Math.abs(t.y),n=a>r;if(r>a)switch(e){case"ne":case"se":return t.x<0;case"nw":case"sw":return t.x>0}else if(n)switch(e){case"ne":case"nw":return t.y>0;case"se":case"sw":return t.y<0}switch(e){case"ne":return t.x<0&&t.y>0;case"nw":return t.x>0&&t.y>0;case"se":return t.x<0&&t.y<0;case"sw":return t.x>0&&t.y<0;default:return console.warn("Unknown corner direction in determineIfMovingInwards:",e),!1}}(t,r),n=Math.abs(r.x),o=Math.abs(r.y);a?m(n>o):g(),v=!0,l&&l(e)},S=e=>{const t=Ke.fromEvent(e);c=t,v?l&&l(t):w(t)},b=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",b),v?d?d():console.warn("Mouse up, direction determined but no final handler set."):null!==u()?.joinPreview&&Jt.getState().setJoinPreview(null)};document.addEventListener("mousemove",S),document.addEventListener("mouseup",b)},Mr=({viewport:r,error:a})=>{const{t:n}=Or();return t("div",{style:{position:"absolute",left:r.left,top:r.top,width:r.width,height:r.height,backgroundColor:"#fff5f5",border:"1px solid #feb2b2",borderRadius:"4px",padding:"16px",color:"#c53030"},children:[e("h3",{children:n("area.error.title","An error occurred in the area")}),e("p",{children:a?.message})]})};class Tr extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Area error:",e,t)}render(){if(this.state.hasError)return e(Mr,{viewport:this.props.viewport,error:this.state.error});const t=this.props.component;return e(t,{id:this.props.areaId,state:this.props.areaState,type:this.props.type,viewport:this.props.viewport,Component:t})}}const Cr=()=>{const e=Gt((e=>e.isVisible)),t=Gt((e=>e.position)),r=Gt((e=>e.openContextMenu)),a=Gt((e=>e.closeContextMenu));return{isVisible:e,position:t,open:i((e=>{r(e)}),[r]),close:i((()=>{a()}),[a])}};const Lr=()=>{const{t:t}=Or(),{screens:r,activeScreenId:a,switchScreen:n,addScreen:o,removeScreen:i,duplicateScreen:s}={screens:Jt((e=>e.screens)),activeScreenId:Jt((e=>e.activeScreenId)),switchScreen:Jt((e=>e.switchScreen)),addScreen:Jt((e=>e.addScreen)),removeScreen:Jt((e=>e.removeScreen)),duplicateScreen:Jt((e=>e.duplicateScreen))},{open:c}=Cr();Ar("open-new-window",(e=>{e?.screenId&&window.open(`?screen=${e.screenId}`,"_blank","noopener,noreferrer")})),Ar("open-new-tab",(e=>{e?.screenId&&window.open(`?screen=${e.screenId}`,"_blank")})),Ar("delete-screen",(e=>{e?.screenId&&(Object.keys(r).length>1?i(e.screenId):console.warn("Cannot remove the last screen"))})),Ar("duplicate-screen",(e=>{e?.screenId&&s(e.screenId)})),Ar("add-screen",(()=>{o()}));const l=Object.keys(r).filter((e=>!r[e]?.isDetached)).sort(((e,t)=>parseInt(e)-parseInt(t)));return e("div",{style:{display:"flex",alignItems:"center",gap:"5px",padding:"0 10px"},children:l.map(((o,i)=>e("button",{onClick:()=>n(o),onContextMenu:e=>((e,a)=>{e.preventDefault(),c({position:{x:e.clientX,y:e.clientY},menuClassName:"screen-switcher-menu",items:[{id:"add",label:t("screen.menu.add","Add"),icon:Sr,actionId:"add-screen",metadata:{}},{id:"duplicate",label:t("screen.menu.duplicate","Duplicate"),icon:cr,actionId:"duplicate-screen",metadata:{screenId:a}},{id:"open-new-window",label:t("screen.menu.openNewWindow","Open in new window"),icon:ir,actionId:"open-new-window",metadata:{screenId:a}},{id:"open-new-tab",label:t("screen.menu.openNewTab","Open in new tab"),icon:ur,actionId:"open-new-tab",metadata:{screenId:a}},{id:"delete",label:t("screen.menu.delete","Delete"),icon:Ir,actionId:"delete-screen",metadata:{screenId:a},disabled:Object.keys(r).length<=1}],targetId:a})})(e,o),title:t("screen.switch",`Switch to screen ${i+1}`),style:{padding:"2px 8px",border:"1px solid #555",borderRadius:"3px",background:a===o?"#444":"#2a2a2a",color:a===o?"#eee":"#aaa",cursor:"pointer",minWidth:"25px",textAlign:"center"},disabled:a===o,children:i+1},o)))})},Nr={},$r=new Set;function Rr(e){["top-outer","top-inner","bottom-outer","bottom-inner"].forEach((t=>{const r=`${e}:${t}`;Nr[r]&&delete Nr[r]})),$r.forEach((e=>e()))}const jr=new Set;function Pr(e,t){const r=`${e}:${t}`;return{registerComponent:i(((e,t,a={})=>{const{order:n=0,alignment:o="left",width:i,allowedLayerTypes:s,callback:c}=a;Nr[r]?Nr[r]=Nr[r].filter((e=>!(e.identifier.name===t.name&&e.identifier.type===t.type))):Nr[r]=[];const l=Math.random().toString(36).substr(2,9);return Nr[r].push({component:e,order:n,alignment:o,width:i,identifier:t,allowedLayerTypes:s,callback:c}),Nr[r].sort(((e,t)=>e.order-t.order)),jr.forEach((e=>e())),l}),[r]),getComponents:i((()=>Nr[r]||[]),[r])}}function Vr(){const[,e]=a.useReducer((e=>e+1),0);s((()=>{return t=e,$r.add(t),()=>{$r.delete(t)};var t}),[])}const Fr=({areaId:r,areaType:a="app",areaState:n={},children:o,viewport:c={top:0,left:0,width:"100%",height:"100%"}})=>{Vr(),s((()=>jt.subscribe((e=>{"cleanup"===e.type&&Rr(e.areaId)}))),[]);const l=(...e)=>{const t=new Map;return e.flat().forEach((e=>{const r=`${e.identifier.name}:${e.identifier.type}`;t.has(r)||t.set(r,e)})),Array.from(t.values()).sort(((e,t)=>e.order-t.order))},{getComponents:d}=Pr(r||"","top-outer"),{getComponents:u}=Pr(a,"top-outer"),p=l(d(),u()),{getComponents:f}=Pr(r||"","bottom-outer"),{getComponents:h}=Pr(a,"bottom-outer"),y=l(f(),h()),{getComponents:m}=Pr(r||"","top-inner"),{getComponents:g}=Pr(a,"top-inner"),v=l(m(),g()),{getComponents:w}=Pr(r||"","bottom-inner"),{getComponents:S}=Pr(a,"bottom-inner"),b=l(w(),S()),{handleFocus:I}=(e=>{const t=Jt((e=>e.activeScreenId)),r=Jt((e=>e.screens[t]?.isDetached))||!1,a=Jt((e=>e.options.multiScreen))||!1,n=Jt((t=>{const r=t.screens[t.activeScreenId]?.areas;if(r)return e?Object.values(r.areas).find((t=>t.id===e)):void 0})),o=n?.spaceId,s=i((()=>{o&&Rt.getState().setActiveSpace(o)}),[o]);return{activeScreenId:t,isDetached:r,multiScreen:a,currentArea:n,currentSpaceId:o,handleFocus:s,isFullscreen:n?.enableFullscreen??!1}})(r),{isDetached:_,multiScreen:A}=(()=>{const e=Jt((e=>e.activeScreenId)),t=Jt((t=>t.screens[e]?.isDetached))||!1,r=Jt((e=>e.options.multiScreen))||!1;return{activeScreenId:e,isDetached:t,multiScreen:r}})(),x=p.length>0,O=y.length>0,E=v.length>0,z=b.length>0,k=x?ke:0,D=O?ke:0,M=(r,o)=>{const i=r.filter((e=>"left"===e.alignment)),s=r.filter((e=>"center"===e.alignment)),c=r.filter((e=>"right"===e.alignment));return 0===i.length&&0===s.length&&0===c.length?null:o.includes("inner")||!_&&o.includes("outer")?t("div",{className:`tools-bar tools-bar-${o}`,style:{height:ke,minHeight:ke,position:o.includes("outer")?"absolute":"relative",left:0,right:0,...o.includes("bottom")?{bottom:0}:{top:0}},onFocusCapture:I,tabIndex:0,"data-testid":`tools-bar-${o}`,children:[e("div",{className:"tools-bar-section tools-bar-section--left",style:{display:i.length>0?"flex":"none"},children:i.map(((t,r)=>{const a=t.component;return e(a,{areaState:n,onFocusCapture:I},`${t.identifier.type}-${t.identifier.name}-${r}`)}))}),e("div",{className:"tools-bar-section tools-bar-section--center",style:{display:s.length>0?"flex":"none"},children:s.map(((t,r)=>{const a=t.component;return e(a,{areaState:n,onFocusCapture:I},`${t.identifier.type}-${t.identifier.name}-${r}`)}))}),t("div",{className:"tools-bar-section tools-bar-section--right",style:{display:c.length>0?"flex":"none"},children:[c.map(((t,r)=>{const a=t.component;return e(a,{areaState:n,onFocusCapture:I},`${t.identifier.type}-${t.identifier.name}-${r}`)})),A&&"app"===a&&"bottom-outer"===o&&e(Lr,{})]})]}):null};return t("div",{className:"tools-container",style:{position:"relative",width:c.width,height:_?"100%":"calc(100%)",overflow:"hidden"},"data-testid":"tools-container",children:[e("div",{className:"tools-content",style:{position:"absolute",top:k,left:0,right:0,bottom:D,overflow:"hidden",display:"flex",flexDirection:"column"},"data-testid":"tools-content",children:e("div",{style:{flex:1,overflow:"hidden"},children:o})}),x&&M(p,"top-outer"),O&&M(y,"bottom-outer"),E&&M(v,"top-inner"),z&&M(b,"bottom-inner")]})},Ur=({id:r,Component:a,state:o,type:i,viewport:c,raised:l,isChildOfStack:d=!1,setResizePreview:u})=>{c||(console.warn(`No viewport found for area ${r}, using default viewport`),c={left:0,top:0,width:100,height:100});const p=Jt((e=>e.screens[e.activeScreenId]?.areas.activeAreaId===r)),f=Jt((e=>e.setActiveArea)),h=n(null),y=Jt((e=>e.getAreaById(r))),m=Rt((e=>e.setActiveSpace)),g=Rt((e=>e.activeSpaceId)),v=Rt((e=>e.pilotMode)),w=Rt((e=>e.spaces)),S=Jt((e=>e.options?.resizableAreas??!0)),b=Jt((e=>e.options?.manageableAreas??!0));s((()=>{if(g)if("AUTO"===v&&y?.role===mt.FOLLOW){const e=Jt.getState().activeScreenId,t=Jt.getState().screens[e]?.areas.lastLeadAreaId,r=Jt.getState().screens[e]?.areas.areas||{},a=t?r[t]:null;a&&a.spaceId===g&&f(a.id)}else"MANUAL"===v&&y?.spaceId!==g&&Jt.getState().updateArea({id:r,spaceId:g})}),[g,y?.role,v]);const I=Jt((e=>e.activeScreenId)),_=Jt((e=>e.screens[I]?.isDetached))||!1;return t(Je.Provider,{value:r,children:[!_&&!d&&e(zr,{id:r,state:o,type:i}),e(Fr,{areaId:r,areaType:i,areaState:o,viewport:c,children:t("div",{ref:h,"data-areaid":r,"data-testid":`area-${r}`,"data-testid-resize-handle":`area-${r}-resize-handle`,className:"area "+(l?"active":""),style:{width:"100%",height:_||y?.enableFullscreen?"100%":`calc(${"string"==typeof c.height?c.height:c.height+"px"} - 30px)`},onClick:()=>{if(!p&&(f(r),y?.role===mt.LEAD&&"MANUAL"!==v))if(y.spaceId)m(y.spaceId);else{const e=Object.keys(w);if(e.length>0){const t=g||e[0];Jt.getState().updateArea({id:r,spaceId:t}),m(t)}else{const e=Rt.getState().addSpace({name:`Space for ${y.type}`,sharedState:{}});e&&(Jt.getState().updateArea({id:r,spaceId:e}),m(e))}}},children:[!_&&!d&&S&&b&&["ne","nw","se","sw"].map((t=>e("div",{className:`area__corner area__corner--${t}`,"data-testid":`area-${r}-resize-handle`,onMouseDown:e=>Dr(e.nativeEvent,t,r,c,u)},t))),e("div",{className:`area-main-content-wrapper ${i}`,"data-areatype":i,"data-testid":`area-${r}-role-button`,style:{opacity:p?1:.9,height:"100%",width:y?.enableFullscreen?"100vw":"100%",top:y?.enableFullscreen?0:"auto",left:y?.enableFullscreen?0:"auto",zIndex:y?.enableFullscreen?9999:"auto",overflow:"hidden"},children:a?e(Tr,{component:a,areaId:r,areaState:o,type:i,viewport:{left:0,top:0,width:y?.enableFullscreen?window.innerWidth:c.width,height:y?.enableFullscreen?window.innerHeight:c.height-(_?0:ke)}}):t("div",{style:{position:"absolute",left:0,top:0,width:y?.enableFullscreen?window.innerWidth:c.width,height:y?.enableFullscreen?window.innerHeight:c.height-(_?0:ke),backgroundColor:"#fff5f5",border:"1px solid #feb2b2",borderRadius:"4px",padding:"16px",color:"#c53030"},children:[t("h3",{children:["Invalid area type: ",i]}),e("p",{children:"This area type is not registered in the area registry."})]})})]})})]})},Hr=a.memo((({id:r,layout:a,areas:n,viewport:o,setResizePreview:i})=>{const c=a.activeTabId||a.areas[0]?.id,l=c?n[c]:null,[u,p]=d(!1);s((()=>{if(l?.type){const e=()=>{vt.getComponent(l.type)?p(!0):setTimeout(e,25)};e()}}),[l?.type]);const f=l?.type?vt.getComponent(l.type):null;return f&&u?t("div",{className:"area-stack",style:{left:o.left,top:o.top,width:o.width,height:o.height+ke},"data-areaid":r,children:[e(kr,{rowId:a.id,row:a,areas:n}),e("div",{className:"area-stack__content",children:e(Ur,{isChildOfStack:!0,id:c,Component:f,state:l?.state,type:l?.type||"",viewport:{left:0,top:0,width:o.width,height:o.height},setResizePreview:i,raised:!!l?.raised})})]}):null})),Br=a.memo((({areaToOpen:r,dimensions:a})=>{const{t:n}=Or(),o=vt.getComponent(r.area.type);return o?t("div",{className:"area-preview",style:{left:r.position.x,top:r.position.y},children:[e(Ur,{id:"-1",Component:o,raised:!0,isChildOfStack:!1,state:r.area.state,type:r.area.type,viewport:{left:0,top:0,height:a.y,width:a.x},setResizePreview:()=>{}}),e("div",{className:"area-preview-content",children:n(`area.preview.${r.area.type}`,`Preview of ${r.area.type}`)})]}):null})),Kr=a.memo((({id:r,viewport:a,setResizePreview:n})=>{const i=Jt((e=>e.getAreaById(r))),s=Jt((e=>e.screens[e.activeScreenId]?.areas.layout[r])),c=Jt((e=>e.screens[e.activeScreenId]?.areas.areas)),l=Jt((e=>e.activeScreenId)),d=Jt((e=>e.screens[l]?.isDetached))||!1,u="area_row"===s?.type,p=u?s:null,f=u&&"stack"===p.orientation,h=u&&!f,y=i?.type?vt.getComponent(i.type):null;let m=r,g=i,v=y;f&&(p.activeTabId?(m=p.activeTabId,g=c?.[m],v=g?.type?vt.getComponent(g.type):null):(g=void 0,v=null));const{getComponents:w}=Pr(g?.type||"","top-outer"),{getComponents:S}=Pr(g?.type||"","bottom-outer"),b=w(),I=S(),_=b.length>0,A=I.length>0,x=_?ke:0,O=A?ke:0,E=o((()=>d?a:{...a,top:a.top+x,height:a.height-x-O}),[a,d,x,O]),z=o((()=>({position:"absolute",left:E.left,top:E.top,width:E.width,height:E.height,display:"flex",flexDirection:h&&"horizontal"===p?.orientation?"row":"column"})),[E,h,p?.orientation]),k=o((()=>({left:0,top:0,width:E.width,height:E.height})),[E]);return(!r.includes("row-")||f)&&"root"!==r&&t("div",{className:"area-container "+r,style:z,"data-areaid":r,"data-testid":`area-${r}`,"data-areatype":f?"stack-row":h?`${p?.orientation}-row`:i?.type||"unknown-leaf",children:[f&&p&&e(Hr,{id:r,areas:c,layout:p,viewport:k,setResizePreview:n}),!u&&v&&g&&e(Ur,{id:g.id,Component:v,state:g.state,type:g.type,viewport:k,raised:!!g.raised,setResizePreview:n,isChildOfStack:!1})]})}));const Jr=(e,t,r,a)=>{const n=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.isDetached;if(n)return;if(!e||!e.areas||0===e.areas.length)return void console.error("Invalid row data for resize");if(r<1||r>=e.areas.length)return void console.error("Invalid areaIndex for resize:",{areaIndex:r,areasLength:e.areas.length});const o=Jt.getState(),i=o.activeScreenId,s=o.screens[i]?.areas;if(!s||!s.layout||!s.rootId)return void console.error("Invalid active screen area state for resize:",s);const c=s.layout,l=s.rootId,d=qe(l,c),u=Re();if(!u)return void console.error("Unable to get root viewport");const p=Ye(c,l,u),f=e.areas[r-1],h=e.areas[r];if(!f||!h)return void console.error("Invalid area indices:",{areaIndex:r,areas:e.areas});let y=p[f.id],m=p[h.id];if(!y||!m)return void console.error("Missing initial viewports:",{a0:f.id,a1:h.id,viewports:p});const g=e=>{const r=c[e];if(!r)return 1;if("area"===r.type)return 1;const a=d[r.id];return t?a?.width??1:a?.height??1},v=g(f.id),w=g(h.id);let S=f.size+h.size;(isNaN(S)||S<=0)&&(S=1);const b={width:t?y.width+m.width:y.width,height:t?y.height:y.height+m.height,left:y.left,top:y.top},I=t?b.width:b.height;if(I<=0)return void console.error("Invalid viewport size:",I);const _=De*v/I,A=De*w/I;if(_+A>=.99)return void console.warn("Not enough space to resize:",{tMin0:_,tMin1:A});let x=0;let O=null,E=null;const z=t=>{const r=performance.now();r-x<16||(x=r,Jt.getState().setRowSizes({rowId:e.id,sizes:t}))},k=()=>{E&&(n=>{if(!E)return void(E=n);const o=t?b.left:b.top,i=t?b.left+b.width:b.top+b.height,s=t?n.x:n.y,l=He(_,1-A,(s-o)/(i-o));a({rowId:e.id,separatorIndex:r,t:l});const d=[l,1-l].map((e=>Ue(0,S,e)));if(!d.some((e=>isNaN(e)||e<0))){const t=e.areas.map(((t,a)=>{if(a===r-1)return d[0];if(a===r)return d[1];const n=c[e.id];return n?.areas?.[a]?.size||0})),a=t.reduce(((e,t)=>e+t),0);if(a>0&&Math.abs(a-1)>.001){const e=t.map((e=>e/a));z(e)}else z(t)}})(E),O=requestAnimationFrame(k)};!function(e,t){document.body.style.userSelect="none";const r=t=>{e(t)},a=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),document.body.style.userSelect="",t()};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}((e=>{(e=>{E=e,O||(O=requestAnimationFrame(k))})(Ke.fromEvent(e))}),(()=>{null!==O&&(cancelAnimationFrame(O),O=null),E=null,setTimeout((()=>a(null)),0)}))},qr=a=>{const{row:n,setResizePreview:o,offset:i}=a,s=Jt((e=>e.screens[e.activeScreenId]?.areas.layout??{})),c=Jt((e=>e.screens[e.activeScreenId]?.areas.rootId)),l=Jt((e=>e.screens[e.activeScreenId]?.areas.viewports)),d=Jt((e=>e.options?.resizableAreas??!0)),{t:u}=Or();if("stack"===n.orientation)return null;if(!n||!n.areas||n.areas.length<=1||!s||!c)return null;if(!n.areas.every((e=>l[e.id]&&s[e.id])))return null;const p=[];for(let a=0;a<n.areas.length-1;a++){const c=n.areas[a],f=n.areas[a+1];if(!c||!f)continue;const h=l[c.id],y=l[f.id];if(!(s[c.id]&&s[f.id]&&h&&y))continue;const m="horizontal"===n.orientation;let g;if(g=m?{left:y.left-5,top:y.top+ke-i,width:10,height:Math.max(y.height-ke,5)}:{left:y.left,top:y.top-5-i,width:Math.max(y.width,5),height:10},isNaN(g.left)||isNaN(g.top)||isNaN(g.width)||isNaN(g.height))continue;g.width=Math.max(0,g.width),g.height=Math.max(0,g.height);const v=e=>{e.stopPropagation(),Jr(n,m,a+1,o)};p.push(e("div",{className:"area-separator "+(m?"area-separator--horizontal":""),style:{...g,flexDirection:m?"column":"row",zIndex:m?2001:2e3,cursor:d?void 0:"default"},onMouseDown:d?v:void 0,title:u("area.separator.resize","Resize"),children:d&&t(r,m?{children:[e(lr,{size:32}),e(lr,{size:32})]}:{children:[e(dr,{size:32}),e(dr,{size:32})]})},`sep-${c.id}-${f.id}`))}return e(r,{children:p})},Wr=a.memo((({dimensions:r,setAreaToOpenDimensions:a})=>{const n=Jt((e=>e.setViewports)),i=Jt((e=>e.screens[e.activeScreenId]?.areas.viewports)),{handleDragOver:c,handleDrop:l,areaToOpenTargetId:d,areaToOpenTargetViewport:u,calculatedPlacement:p}=Qt();s((()=>{if(!d||!u)return;const e=Ke.new(u.width,u.height);e.x===r.x&&e.y===r.y||a(e)}),[d,u,r,a]),s((()=>{n(i)}),[i,n]);const f=o((()=>{if(!u)return{lines:[],placementLines:{}};const e=u,t=.25*Math.min(e.width,e.height),r=Ke.new(t,t),a=e.width,n=e.height,o=Ke.new(0,0),i=Ke.new(a,0),s=Ke.new(a,n),c=Ke.new(0,n),l=o.add(r),d=i.add(r.scaleX(-1)),p=s.add(r.scale(-1)),f=c.add(r.scaleY(-1));return{lines:[[o,l],[i,d],[c,f],[s,p],[l,d],[d,p],[p,f],[f,l]],placementLines:{left:[o,l,f,c],top:[o,i,d,l],right:[d,i,s,p],bottom:[c,f,p,s],stack:[l,d,p,f]}}}),[u]),h=o((()=>{if(!u||!f.placementLines||!f.placementLines[p])return"";return f.placementLines[p].map((e=>[e.x,e.y].join(","))).map(((e,t)=>[0===t?"M":"L",e].join(" "))).join(" ")+" Z"}),[u,f.placementLines,p]);return u?e("div",{className:"area-to-open-overlay",onDragOver:c,onDrop:l,children:u&&t("svg",{width:u.width,height:u.height,className:"area-to-open-overlay__placement",style:{left:u.left,top:u.top},children:[f.lines.map((([t,r],a)=>e("line",{x1:t.x,y1:t.y,x2:r.x,y2:r.y},a))),e("path",{d:h})]})}):null})),Gr=a.memo((()=>{const a=Jt((e=>e.screens[e.activeScreenId]?.areas.areaToOpen)),n=o((()=>Ke.new(100,100)),[]),[i,s]=d(n);return a?t(r,{children:[e(Br,{areaToOpen:a,dimensions:i}),e(Wr,{areaToOpen:a,dimensions:i,setAreaToOpenDimensions:s})]}):null})),Xr=r=>{const{viewport:a,movingInDirection:n}=r,{t:o}=Or(),i=Math.min(256,5*Math.min(a.width,a.height));return t("div",{className:"join-area-preview",style:{left:a.left,top:a.top,width:a.width,height:a.height},children:[e("div",{className:`join-area-preview__arrow-container join-area-preview__arrow-container--${n}`,children:e("div",{className:`join-area-preview__arrow join-area-preview__arrow--${n}`,style:{width:i,height:i},children:e(sr,{size:i+"px",style:{color:"transparent"}})})}),e("div",{className:"join-area-preview-content",children:o("area.join.preview","Join areas")})]})},Yr=()=>{const r=Gt((e=>e.isVisible&&"default"===e.menuType)),n=Gt((e=>e.items)),o=Gt((e=>e.position)),i=Gt((e=>e.closeContextMenu)),s=Gt((e=>e.metadata)),c=Gt((e=>e.menuClassName)),{t:l}=Or(),d=(r,n)=>r.map((r=>r.children&&r.children.length>0?e(h,{label:l(`menu.${r.id}.label`,r.label),disabled:r.disabled,children:d(r.children,n)},r.id):"area.separator"===r.actionId||r.label.match(/^[-\u2500]+$/)?e("div",{style:{margin:"4px 0",borderBottom:"1px solid #ccc"}},r.id):t(y,{disabled:r.disabled,onClick:()=>n(r.actionId,r.metadata,r),children:[r.icon&&a.createElement(r.icon),l(`menu.${r.id}.label`,r.label)]},r.id)));return r?e(f,{anchorPoint:o,state:r?"open":"closed",onClose:i,transition:!0,direction:"right",menuClassName:c,children:d(n,((e,t)=>{Yt.executeAction(e,{...s,...t}),i&&i()}))}):null},Zr=({children:a})=>t(r,{children:[a,e(Yr,{}),e(Er,{})]});function Qr(){const e=Jt((e=>e.activeScreenId)),t=Jt((t=>t.screens[e]?.isDetached)),r=Jt((e=>e.removeScreen));return s((()=>{if(!t)return;const a=()=>{r(e)};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)}),[e,t,r]),null}const ea=$((e=>({entries:[],addEntry:t=>e((e=>({entries:[...e.entries,t]}))),clearHistory:()=>e({entries:[]})}))),ta={id:"history",priority:yt.HIGH,actionTypes:["area/addArea","area/removeArea","area/updateArea","area/moveArea","area/resizeArea","composition/update","composition/addElement","composition/removeElement","composition/updateElement","project/update","draw/addLine","draw/updateLine","draw/removeLine","draw/updateStrokeWidth","draw/updateColor","draw/updateZoom","draw/updatePan","draw/clearCanvas"],handler:e=>{const{type:t,payload:r}=e,a={id:`${t}-${Date.now()}`,type:t,payload:r,timestamp:Date.now(),description:ra(t,r)};ea.getState().addEntry(a)}};function ra(e,t){const{t:r}=Or();switch(e){case"area/addArea":return r("action.area.add",`Add area ${t.type||""}`);case"area/removeArea":return r("action.area.remove","Remove area");case"area/updateArea":return r("action.area.update","Update area");case"area/moveArea":return r("action.area.move","Move area");case"area/resizeArea":return r("action.area.resize","Resize area");case"composition/addElement":return r("action.composition.add",`Add element ${t.elementType||""}`);case"composition/removeElement":return r("action.composition.remove","Remove element");case"composition/updateElement":return r("action.composition.update","Update element");case"draw/addLine":return r("action.draw.addLine","Add line");case"draw/updateLine":return r("action.draw.updateLine","Edit line");case"draw/removeLine":return r("action.draw.removeLine","Remove line");case"draw/updateStrokeWidth":return r("action.draw.updateStrokeWidth",`Change stroke width: ${t.oldValue}  ${t.newValue}`);case"draw/updateColor":return r("action.draw.updateColor",`Change color: ${t.oldValue}  ${t.newValue}`);case"draw/clearCanvas":return r("action.draw.clearCanvas","Clear drawing");default:return r("action.unknown",`Action ${e}`)}}function aa(){const{addArea:e,removeArea:t,setActiveArea:r,updateArea:a,getActiveArea:n,getAreaById:o,getAllAreas:s,getAreaErrors:c}=Jt();return{createArea:i(((t,r,a,n)=>{if(!vt.getRegisteredTypes().has(t))throw new Error(`Invalid area type: ${t}`);const o={id:n||"",type:t,state:r,position:a};if((vt._roleMap||{})[t]===mt.LEAD){const e=Rt.getState().spaces,r=Object.keys(e);if(r.length>0){const e=Rt.getState().activeSpaceId;o.spaceId=e||r[0]}else{const e=Rt.getState().addSpace({name:`Space for ${t}`,sharedState:{}});e&&(o.spaceId=e)}}return e(o)}),[e]),removeArea:i((e=>{t(e)}),[t]),setActive:i((e=>{r(e)}),[r]),update:i(((e,t)=>{a({id:e,...t})}),[a]),getActive:i((()=>n()),[n]),getById:i((e=>o(e)),[o]),getAll:i((()=>s()),[s]),getErrors:i((()=>c()),[c])}}const na=({options:t={},children:a,onError:o})=>{const i=n(!1),{createArea:c}=aa();return s((()=>{if(!i.current){i.current=!0;try{const e=[ta],r=t.plugins||[],a=[...e,...r],n=[];a.forEach((e=>{e&&"object"==typeof e&&e.id&&(Yt.registerPlugin(e),n.push(e.id))})),t.validators&&t.validators.forEach((({actionType:e,validator:t})=>{e&&"function"==typeof t&&Yt.registerValidator(e,t)}));const i=Jt.getState(),s=i.activeScreenId,l=i.screens[s]?.areas;if(!(l?.rootId||Object.keys(l?.areas||{}).length>0)){const e=t.initialAreas||[],r=[];if(e.forEach(((e,t)=>{if(!e||"object"!=typeof e){const e=new Error(`Invalid area config at index ${t}`);return console.error("[KarmycInitializer] Invalid area config",e),void o?.(e)}if(!e.type||"string"!=typeof e.type){const e=new Error(`Invalid area type for area at index ${t}`);return console.error("[KarmycInitializer] Invalid area config",e),void o?.(e)}const a=wt(e);if(!a.isValid){const e=new Error(`Invalid area configuration: ${a.errors.join(", ")}`);return console.error("[KarmycInitializer] Invalid area config",e),void o?.(e)}let n;try{n=c(e.type,e.state||{},void 0,e.id)}catch(e){return console.error("[KarmycInitializer] Invalid area config",e),void o?.(e instanceof Error?e:new Error(String(e)))}if(n)r.push(n);else{const e=new Error(`Failed to create area at index ${t}`);console.error("[KarmycInitializer] Invalid area config",e),o?.(e)}})),r.length>0){const e={id:"root",type:"area_row",orientation:"horizontal",areas:r.map((e=>({id:e,size:1/r.length})))};Jt.setState((t=>{if(!t.screens[t.activeScreenId]?.areas){const e=new Error(`Active screen areas ${t.activeScreenId} not found during layout update.`);return o?.(e),t}const a={...t.screens[t.activeScreenId].areas.layout||{},root:e,...r.reduce(((e,t)=>(e[t]||(e[t]={type:"area",id:t}),e)),{})};return{...t,screens:{...t.screens,[t.activeScreenId]:{...t.screens[t.activeScreenId],areas:{...t.screens[t.activeScreenId].areas,rootId:"root",layout:a}}}}}),!1,"KarmycInitializer/setDefaultLayout")}}}catch(e){console.error("[KarmycInitializer] Invalid area config",e),o?.(e instanceof Error?e:new Error(String(e)))}return()=>{try{const e=Jt.getState().options;(e.plugins||[]).map((e=>e.id)).forEach((e=>{e&&Yt.unregisterPlugin(e)}))}catch(e){console.error("[KarmycInitializer] Error during cleanup:",e),o?.(e instanceof Error?e:new Error(String(e)))}}}}),[o]),e(r,{children:a})},oa=new Map,ia=new Map;const sa=(e,t)=>{oa.set(e,t)},ca=e=>oa.get(e)||[],la=e=>{oa.delete(e)},da=()=>{const e=[];for(const t of oa.values())e.push(...t);for(const t of ia.values())e.push(t);return e};const ua=u({options:{}}),pa=({children:t,options:r={},onError:a})=>{const o=n(!0),i=n(!1),c=n(null),l=n(0),d=n([]);s((()=>{var e;qt(r),r.t&&(e=r.t,xr.getState().setTranslationFunction(e))}),[r]),s((()=>{document.addEventListener("contextmenu",(e=>e.preventDefault()),!1)}),[]),s((()=>{const e=new URLSearchParams(window.location.search).get("screen");if(e){if(Jt.getState().screens[e])Jt.setState({activeScreenId:e}),c.current=e;else{console.warn(`[KarmycProvider] Screen ID '${e}' from URL not found in store.`);const t=new URL(window.location.href);t.searchParams.delete("screen"),window.history.replaceState({},"",t.toString())}}const t=setTimeout((()=>{o.current=!1}),0);return()=>clearTimeout(t)}),[]);const u=Jt((e=>e.activeScreenId)),p=Jt((e=>e.screens));return s((()=>{if(o.current||i.current)return;const e=Jt.getState(),t=Object.keys(e.screens).length;if(t!==l.current){const r=Object.keys(e.screens).sort(((e,t)=>parseInt(e)-parseInt(t)));if(0===d.current.length)return d.current=r,void(l.current=t);const a=d.current.find((e=>!r.includes(e)));if(a){const e=d.current.indexOf(a),t=d.current.indexOf(u);if(t>e){const e=r[t-1];e&&(Jt.setState({activeScreenId:e}),c.current=e)}}return d.current=r,void(l.current=t)}if(!e.screens[u])return console.warn(`[KarmycProvider] Invalid active screen ID '${u}', resetting to '1'`),void Jt.setState({activeScreenId:"1"});if(c.current===u)return;const r=new URL(window.location.href),a=r.searchParams.get("screen");u!==a&&(i.current=!0,u?r.searchParams.set("screen",u):r.searchParams.delete("screen"),window.history.replaceState({},"",r.toString()),i.current=!1,c.current=u)}),[u,p]),s((()=>{const e=e=>{const t=Jt.getState();if(!t.options.keyboardShortcutsEnabled)return;if("Control"===e.key||"Alt"===e.key||"Shift"===e.key||"Meta"===e.key)return;const r=new Set;e.ctrlKey&&r.add("Control"),e.altKey&&r.add("Alt"),e.shiftKey&&r.add("Shift"),e.metaKey&&r.add("Command");const a=t.screens[t.activeScreenId]?.areas.activeAreaId,n=a?t.getAreaById(a)?.type:null,o=da().filter((e=>e.isGlobal));for(const t of o)if(t.key.toUpperCase()===e.key.toUpperCase()){const n=new Set(t.modifierKeys||[]);let o=!0;for(const e of n)if(!r.has(e)){o=!1;break}if(o){const e=new Set(t.optionalModifierKeys||[]);for(const t of r)if(!n.has(t)&&!e.has(t)){o=!1;break}}if(o){e.preventDefault(),e.stopPropagation();try{t.fn(a||"",{})}catch(e){console.error(`Error executing global shortcut ${t.name}:`,e)}return}}if(!a||!n)return;const i=ca(n);for(const t of i)if(!t.isGlobal&&t.key.toUpperCase()===e.key.toUpperCase()){const n=new Set(t.modifierKeys||[]);let o=!0;for(const e of n)if(!r.has(e)){o=!1;break}if(o){const e=new Set(t.optionalModifierKeys||[]);for(const t of r)if(!n.has(t)&&!e.has(t)){o=!1;break}}if(o){e.preventDefault(),e.stopPropagation();try{t.fn(a,{})}catch(e){console.error(`Error executing shortcut ${t.name}:`,e)}return}}(function(e,t){const r=da();for(const a of r)if(a.key===e){const e=new Set(a.modifierKeys||[]);let r=!0;for(const a of e)if(!t.has(a)){r=!1;break}if(r){const n=new Set(a.optionalModifierKeys||[]);for(const a of t)if(!e.has(a)&&!n.has(a)){r=!1;break}}if(r)return!0}const a=[{key:"R",modifiers:["Control"]},{key:"S",modifiers:["Control"]},{key:"P",modifiers:["Control"]},{key:"F",modifiers:["Control"]},{key:"L",modifiers:["Control"]},{key:"U",modifiers:["Control"]},{key:"I",modifiers:["Control"]},{key:"J",modifiers:["Control"]},{key:"K",modifiers:["Control"]},{key:"N",modifiers:["Control"]},{key:"T",modifiers:["Control"]},{key:"W",modifiers:["Control"]}];for(const r of a)if(e===r.key){const e=new Set(r.modifiers);let a=!0;for(const r of e)if(!t.has(r)){a=!1;break}if(a&&t.size===e.size)return!0}return!1})(e.key,r)&&(e.preventDefault(),e.stopPropagation())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)}),[]),e(ua.Provider,{value:{options:r},children:e(na,{options:r,onError:e=>{console.error("[KarmycInitializer] Error during initialization:",e),a?.(e)},children:t})})},fa=e=>e.screens[e.activeScreenId]?.areas,ha=({offset:r=0})=>{if(!p(ua))throw new Error("Karmyc must be used within a KarmycProvider");const a=Jt(fa),c=Jt((e=>e.screens[e.activeScreenId]?.isDetached)),l=o((()=>a?.rootId),[a?.rootId]),u=o((()=>a?.layout??{}),[a?.layout]),f=o((()=>a?.joinPreview),[a?.joinPreview]),h=o((()=>a?.areaToOpen),[a?.areaToOpen]),y=n(null),[m,g]=d((()=>c?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:Re())),[v,w]=d(null),S=Jt((e=>e.setViewports));s((()=>{if(!c){const e=document.querySelector(".area-root");if(e){const t=e.getBoundingClientRect();g({left:0,top:0,width:t.width,height:t.height})}}}),[c]),s((()=>{const e=()=>{if(c){const e={left:0,top:0,width:window.innerWidth,height:window.innerHeight};y.current&&e.width===y.current.width&&e.height===y.current.height||g(e)}else{const e=document.querySelector(".area-root");if(e){const t=e.getBoundingClientRect(),r={left:0,top:0,width:t.width,height:t.height};y.current&&r.width===y.current.width&&r.height===y.current.height||g(r)}}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[c]),s((()=>{const e=Object.keys(u).length,t=l?u[l]:null;if(l&&t&&0!==e){if(!(!m||m.width<=0||m.height<=0))try{const e=Ye(u,l,{...m,top:m.top+r}),t=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.viewports;if(!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const a of r){if(!t.hasOwnProperty(a))return!1;const r=e[a],n=t[a];if(r.left!==n.left||r.top!==n.top||r.width!==n.width||r.height!==n.height)return!1}return!0}(t,e)){Object.keys(e).some((r=>{const a=t?.[r],n=e[r];return!a||(Math.abs(a.left-n.left)>1||Math.abs(a.top-n.top)>1||Math.abs(a.width-n.width)>1||Math.abs(a.height-n.height)>1)}))&&(y.current=m,S(e))}}catch(e){console.error("[Karmyc] Erreur lors du calcul du viewportMap:",e)}}else null!==y.current&&(y.current=null,S({}))}),[u,l,m,v,S]);const b=i((e=>{const t=Jt.getState(),r=t.screens[t.activeScreenId],a=r?.areas.viewports||{},n=a[e];if(r?.isDetached)return{...n,left:0,top:0,width:window.innerWidth,height:window.innerHeight};if(!v)return n;let o,i=-1;if(o=Object.values(u).filter((e=>"area_row"===e.type)).find((t=>{const r=t.areas.findIndex((t=>t.id===e));return-1!==r&&(i=r,!0)})),!o||o.id!==v.rowId)return n;const s=v.separatorIndex;if(i===s-1||i===s){const t=i===s-1?s:s-1,r=o.areas[t]?.id;if(!r)return n;const c=a[r];if(!c)return n;const l=i===s-1,d=v.t;if(!a[o.id])return n;const u=l?n:c,p=l?c:n,f={left:u.left,top:u.top,width:u.width+p.width,height:u.height+p.height};if("horizontal"===o.orientation){const t=f.width,r=Math.max(0,Math.floor(t*d)),a=Math.max(0,t-r),o=l?r:a,i=l?f.left:f.left+r;return isNaN(o)||isNaN(i)?(console.warn(`[VisViewport] ${e}: NaN detected in horizontal calc.`),n):{...n,width:o,left:i}}if("vertical"===o.orientation){const t=f.height,r=Math.max(0,Math.floor(t*d)),a=Math.max(0,t-r),o=l?r:a,i=l?f.top:f.top+r;return isNaN(o)||isNaN(i)?(console.warn(`[VisViewport] ${e}: NaN detected in vertical calc.`),n):{...n,height:o,top:i}}if("stack"===o.orientation)return n}return n}),[u,v]);return t(Zr,{children:[e(Qr,{}),t("div",{className:"area-root",children:[Object.values(u).map((t=>{if("area_row"===t.type){const a=t,n=Jt.getState().screens[Jt.getState().activeScreenId]?.areas.viewports||{};if(a.areas.every((e=>n[e.id])))return e(qr,{offset:r,row:a,setResizePreview:w},t.id)}return null})),Object.entries(u).map((([t])=>{const a=b(t);return a?e(Kr,{id:t,viewport:{...a,top:a.top-r},setResizePreview:w},t):null})),f&&f.areaId&&(()=>{const t=(Jt.getState().screens[Jt.getState().activeScreenId]?.areas.viewports||{})[f.areaId];return t?e(Xr,{viewport:t,movingInDirection:f.movingInDirection}):null})(),h&&e(Gr,{})]})]})};function ya(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,a]of e)if(!Object.is(a,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(const a of r)if(!Object.prototype.hasOwnProperty.call(t,a)||!Object.is(e[a],t[a]))return!1;return!0}const{useDebugValue:ma}=a,{useSyncExternalStoreWithSelector:ga}=D,va=e=>e;function wa(e,t=va,r){const a=ga(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return ma(a),a}function Sa(){const e=wa(Rt,(e=>e.spaces),ya),t=wa(Rt,(e=>e.activeSpaceId),ya),r=wa(Rt,(e=>e.openSpaceIds),ya),a=wa(Rt,(e=>e.pilotMode),ya),n=Rt((e=>e.addSpace)),s=Rt((e=>e.removeSpace)),c=Rt((e=>e.setActiveSpace)),l=Rt((e=>e.openSpace)),d=Rt((e=>e.closeSpace)),u=Rt((e=>e.updateSpace)),p=Rt((e=>e.updateSpaceGenericSharedState)),f=o((()=>Object.entries(e).map((([e,t])=>({id:e,name:t.name})))),[e]),h=o((()=>r.map((t=>e[t])).filter((e=>void 0!==e))),[e,r]),y=i(((e,t={})=>n({name:e,sharedState:t})),[n]),m=i((e=>{s(e)}),[s]),g=i((e=>{c(e)}),[c]),v=i((e=>{l(e)}),[l]),w=i((e=>{d(e)}),[d]),S=i(((e,t)=>{p({spaceId:e,changes:t})}),[p]),b=i(((e,t)=>{u({id:e,...t})}),[u]),I=i((e=>Rt.getState().spaces[e]),[]),_=i((e=>{Rt.getState().setPilotMode(e)}),[]);return{spaceList:f,activeSpaceId:t,openSpaces:h,openSpaceIds:r,pilotMode:a,createSpace:y,deleteSpace:m,setActive:g,setPilotMode:_,openSpace:v,closeSpace:w,updateSharedState:S,updateSpaceProperties:b,getSpaceById:I}}const ba=()=>{const{open:a}=Cr(),[n,o]=d(!1),{spaceList:c,activeSpaceId:l,openSpaces:u,createSpace:p,setActive:f,openSpace:h,closeSpace:y,updateSpaceProperties:m}=Sa(),g=i((()=>{const e=c.find((e=>e.id===l));if(!e)return;const t=JSON.stringify(e,null,2),r="data:application/json;charset=utf-8,"+encodeURIComponent(t),a=`${e.name}.json`,n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",a),n.click()}),[c,l]),v=i((()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files?.[0];if(!t)return;const r=new FileReader;r.onload=e=>{try{const t=JSON.parse(e.target?.result),r=p(t.name,t.sharedState);r&&f(r)}catch(e){console.error("Error importing space:",e)}},r.readAsText(t)},e.click()}),[p,f]),w=i((()=>{const e=c.find((e=>e.id===l));if(!e||!l)return;const t=prompt("Nouveau nom du space:",e.name);t&&t!==e.name&&m(l,{name:t})}),[c,l,m]);s((()=>(Yt.registerActionHandler("space.new",(()=>{const e=p("Nouveau Space");e&&f(e)})),Yt.registerActionHandler("space.import",v),Yt.registerActionHandler("space.export",g),Yt.registerActionHandler("space.rename",w),Yt.registerActionHandler("space.close",(e=>{const t=e.spaceId||l;t&&y(t)})),Yt.registerActionHandler("space.open",(e=>{e.spaceId&&(h(e.spaceId),f(e.spaceId))})),()=>{Yt.unregisterActionHandler("space.new"),Yt.unregisterActionHandler("space.import"),Yt.unregisterActionHandler("space.export"),Yt.unregisterActionHandler("space.rename"),Yt.unregisterActionHandler("space.close"),Yt.unregisterActionHandler("space.open")})),[p,v,g,w,y,h,f,l]);const S=i((e=>{e.preventDefault();const t=c.slice(-10).reverse(),r=!!l,n=[{id:"new",label:"Nouveau Space",actionId:"space.new",icon:Sr},{id:"import",label:"Importer Space",actionId:"space.import",icon:fr},{id:"export",label:"Exporter Space",actionId:"space.export",icon:pr,disabled:!r},{id:"rename",label:"Renommer Space",actionId:"space.rename",icon:br,disabled:!r},{id:"close",label:"Fermer Space Actif",actionId:"space.close",icon:_r,disabled:!r}];u.length>0&&n.push({id:"separator1",label:"---",actionId:"area.separator"},{id:"open",label:"Espaces Ouverts",actionId:"space.open",icon:hr,children:u.map((e=>({id:`open-${e.id}`,label:e.name,actionId:"space.open",metadata:{spaceId:e.id}})))}),t.length>0&&n.push({id:"separator2",label:"---",actionId:"area.separator"},{id:"recent",label:"Spaces Rcents",actionId:"space.recent",icon:yr,children:t.map((e=>({id:`recent-${e.id}`,label:e.name,actionId:"space.open",metadata:{spaceId:e.id}})))}),a({position:{x:e.clientX,y:e.clientY},items:n,menuClassName:"space-context-menu"})}),[a,c,l,u]);return t(r,{children:[e("style",{children:"\n                    .space-context-menu {\n                        z-index: 9999 !important;\n                    }\n                "}),e("div",{onContextMenu:S,onClick:S,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:{cursor:"pointer",padding:"8px",color:"white",display:"flex",alignItems:"center",gap:"8px",userSelect:"none",backgroundColor:n?"rgba(255, 255, 255, 0.1)":"transparent",transition:"background-color 0.2s ease"},children:e(hr,{size:26})})]})};function Ia(e,t,r,a){s((()=>(vt.registerComponent(e,t),vt.registerInitialState(e,r),a&&(a.displayName&&vt.registerDisplayName(e,a.displayName),a.icon&&vt.registerIcon(e,a.icon),a.defaultSize&&vt.registerDefaultSize(e,a.defaultSize),a.supportedActions&&vt.registerSupportedActions(e,a.supportedActions),a.role&&(vt._roleMap=vt._roleMap||{},vt._roleMap[e]=a.role),void 0!==a.supportFullscreen&&(vt._supportFullscreenMap=vt._supportFullscreenMap||{},vt._supportFullscreenMap[e]=a.supportFullscreen)),()=>{vt.unregisterAreaType(e)})),[e,t,r,a,a?.displayName,a?.defaultSize,a?.supportedActions,a?.icon,a?.role,a?.supportFullscreen])}function _a(e={}){const t=o((()=>{const t=(e.initialAreas??[]).filter((e=>e.role&&!Object.values(mt).includes(e.role)?(console.warn(`Zone invalide ignore: rle "${e.role}" non reconnu`),!1):!!e.type||(console.warn("Zone invalide ignore: type non dfini"),!1)));return{plugins:e.plugins??[],validators:e.validators??[],initialAreas:t,keyboardShortcutsEnabled:e.keyboardShortcutsEnabled??!0,builtInLayouts:e.builtInLayouts??[],initialLayout:e.initialLayout??"default",options:{resizableAreas:e.resizableAreas??!0,manageableAreas:e.manageableAreas??!0,multiScreen:e.multiScreen??!0,builtInLayouts:e.builtInLayouts??[]}}}),[e.plugins,e.validators,e.initialAreas,e.keyboardShortcutsEnabled,e.builtInLayouts,e.initialLayout,e.resizableAreas,e.manageableAreas,e.multiScreen]);return s((()=>{let e=!0;return(async()=>{try{const r={areas:{types:[],layout:{}},actions:{plugins:t.plugins,validators:t.validators},contextMenu:{actions:[]}};if(Zt.initialize(r),!e)return;const a={...t.options,keyboardShortcutsEnabled:t.keyboardShortcutsEnabled,builtInLayouts:t.builtInLayouts,initialLayout:t.initialLayout};Jt.setState((e=>({...e,options:a})))}catch(t){console.error("[KarmycInitializer] Error during initialization:",t),e&&Jt.setState((e=>({...e,options:{resizableAreas:!0,manageableAreas:!0,multiScreen:!0,builtInLayouts:[]}})))}})(),()=>{e=!1}}),[t]),t}function Aa(e,t=[]){const[r,a]=d(t),[n,o]=d([]);s((()=>{const t=[];return r.forEach((r=>{if(r.onStoreInit&&r.onStoreInit(e),r.onStoreChange){let a=e.getState();const n=e.subscribe((e=>{e!==a&&(r.onStoreChange?.(e,a),a=e)}));t.push(n)}})),()=>{t.forEach((e=>e()))}}),[e,r]),s((()=>{const e=r.filter((e=>e.actions&&Object.keys(e.actions).length>0)).map((e=>({id:e.name,priority:500,actionTypes:null,handler:t=>{e.actions&&t.type in e.actions&&e.actions[t.type](t.payload)}})));return e.forEach((e=>{Yt.registerPlugin(e)})),o(e),()=>{n.forEach((e=>{Yt.unregisterPlugin(e.id)}))}}),[r]);return{plugins:r,registerPlugin:e=>{if(r.find((t=>t.name===e.name)))throw new Error(`Plugin with name "${e.name}" already exists`);a((t=>[...t,e]))},unregisterPlugin:e=>{a((t=>t.filter((t=>t.name!==e))))},applyPluginTransformations:e=>{let t={...e};for(const e of r)if(e.transformState){const r=e.transformState(t);t={...t,...r}}return t}}}function xa(e,t={}){const{enabled:r=!0}=t,a=Rt((e=>e.undoSharedState)),n=Rt((e=>e.redoSharedState)),o=Rt((t=>e?t.spaces[e]:null)),s=Boolean(o?.sharedState?.pastDiffs?.length),c=Boolean(o?.sharedState?.futureDiffs?.length),l=i((()=>{r&&e&&s&&a(e)}),[r,e,s,a]),d=i((()=>{r&&e&&c&&n(e)}),[r,e,c,n]),u=i((()=>{r&&e&&Rt.setState((t=>{const r=t.spaces[e];r&&(r.sharedState.pastDiffs=[],r.sharedState.futureDiffs=[])}))}),[r,e]);return{canUndo:s,canRedo:c,undo:l,redo:d,clearHistory:u,pastDiffs:o?.sharedState?.pastDiffs??[],futureDiffs:o?.sharedState?.futureDiffs??[]}}function Oa(e,t){s((()=>{const r=t.map((t=>({...t,areaType:t.isGlobal?void 0:e})));return sa(e,r),()=>{la(e)}}),[e,t])}export{ze as AREA_BORDER_WIDTH,De as AREA_MIN_CONTENT_WIDTH,Me as AREA_PLACEMENT_TRESHOLD,mt as AREA_ROLE,Te as AREA_TAB_HEIGHT,yt as ActionPriority,Xt as ActionRegistry,Tr as AreaErrorBoundary,Je as AreaIdContext,Br as AreaPreview,qr as AreaRowSeparators,Hr as AreaStack,kr as AreaTabs,Gr as AreaToOpenPreview,Yr as ContextMenu,Zr as ContextMenuProvider,Qr as DetachedWindowCleanup,Wr as DropZone,Xr as JoinAreaPreview,ha as Karmyc,ua as KarmycContext,na as KarmycInitializer,pa as KarmycProvider,Lr as ScreenSwitcher,ba as SpaceMenu,Er as SwitchAreaTypeContextMenu,ke as TOOLBAR_HEIGHT,Ke as Vec2,Ve as _setAreaViewport,Yt as actionRegistry,vt as areaRegistry,He as capToRange,qe as computeAreaRowToMinSize,We as computeAreaToParentRow,Ye as computeAreaToViewport,Zt as coreRegistry,Vt as createInitialScreenState,Ft as findParentRowAndIndices,Re as getAreaRootViewport,Qe as getAreaToOpenPlacementInViewport,Fe as getAreaViewport,Ze as getHoveredAreaId,ht as getRgbaFromCssColor,ut as hexColorRegex,tt as hexRegex,at as hexToBinary,rt as hexToRGB,ot as hexToRGBA,it as hexToRGBAString,dt as hslToRGB,Pt as initialAreaSliceState,qt as initializeKarmycStore,Ue as interpolate,et as joinAreas,nt as rgbToBinary,lt as rgbToHSL,st as rgbToString,ct as rgbaToString,je as setAreaResizing,pt as shortHexColorRegex,aa as useArea,Qt as useAreaDragAndDrop,Oa as useAreaKeyboardShortcuts,Cr as useContextMenu,Gt as useContextMenuStore,_a as useKarmyc,Jt as useKarmycStore,Aa as usePluginSystem,Ar as useRegisterActionHandler,Ia as useRegisterAreaType,Sa as useSpace,xa as useSpaceHistory,Rt as useSpaceStore,Or as useTranslation};
//# sourceMappingURL=index.esm.js.map
